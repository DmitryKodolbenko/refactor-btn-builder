{"ast":null,"code":"const {\n  crc16,\n  hexToBytes,\n  bytesToHex,\n  stringToBytes,\n  base64toString,\n  stringToBase64\n} = require(\"./Utils\");\nconst bounceable_tag = 0x11;\nconst non_bounceable_tag = 0x51;\nconst test_flag = 0x80;\n\n/**\n * @private\n * @param addressString {string}\n * @return {{isTestOnly: boolean, workchain: number, hashPart: Uint8Array, isBounceable: boolean}}\n */\nfunction parseFriendlyAddress(addressString) {\n  const data = stringToBytes(base64toString(addressString));\n  if (data.length !== 36) {\n    // 1byte tag + 1byte workchain + 32 bytes hash + 2 byte crc\n    throw \"Unknown address type: byte length is not equal to 36\";\n  }\n  const addr = data.slice(0, 34);\n  const crc = data.slice(34, 36);\n  const calcedCrc = crc16(addr);\n  if (!(calcedCrc[0] === crc[0] && calcedCrc[1] === crc[1])) {\n    throw \"Wrong crc16 hashsum\";\n  }\n  let tag = addr[0];\n  let isTestOnly = false;\n  let isBounceable = false;\n  if (tag & test_flag) {\n    isTestOnly = true;\n    tag = tag ^ test_flag;\n  }\n  if (tag !== bounceable_tag && tag !== non_bounceable_tag) throw \"Unknown address tag\";\n  isBounceable = tag === bounceable_tag;\n  let workchain = null;\n  if (addr[1] === 0xff) {\n    // TODO we should read signed integer here\n    workchain = -1;\n  } else {\n    workchain = addr[1];\n  }\n  if (workchain !== 0 && workchain !== -1) throw new Error('Invalid address wc ' + workchain);\n  const hashPart = addr.slice(2, 34);\n  return {\n    isTestOnly,\n    isBounceable,\n    workchain,\n    hashPart\n  };\n}\nclass Address {\n  /**\n   * @param anyForm {string | Address}\n   */\n  static isValid(anyForm) {\n    try {\n      new Address(anyForm);\n      return true;\n    } catch (e) {\n      return false;\n    }\n  }\n\n  /**\n   * @param anyForm {string | Address}\n   */\n  constructor(anyForm) {\n    if (anyForm == null) {\n      throw \"Invalid address\";\n    }\n    if (anyForm instanceof Address) {\n      this.wc = anyForm.wc;\n      this.hashPart = anyForm.hashPart;\n      this.isTestOnly = anyForm.isTestOnly;\n      this.isUserFriendly = anyForm.isUserFriendly;\n      this.isBounceable = anyForm.isBounceable;\n      this.isUrlSafe = anyForm.isUrlSafe;\n      return;\n    }\n    if (anyForm.search(/\\-/) > 0 || anyForm.search(/_/) > 0) {\n      this.isUrlSafe = true;\n      anyForm = anyForm.replace(/\\-/g, '+').replace(/_/g, '\\/');\n    } else {\n      this.isUrlSafe = false;\n    }\n    if (anyForm.indexOf(':') > -1) {\n      const arr = anyForm.split(':');\n      if (arr.length !== 2) throw new Error('Invalid address ' + anyForm);\n      const wc = parseInt(arr[0]);\n      if (wc !== 0 && wc !== -1) throw new Error('Invalid address wc ' + anyForm);\n      const hex = arr[1];\n      if (hex.length !== 64) throw new Error('Invalid address hex ' + anyForm);\n      this.isUserFriendly = false;\n      this.wc = wc;\n      this.hashPart = hexToBytes(hex);\n      this.isTestOnly = false;\n      this.isBounceable = false;\n    } else {\n      this.isUserFriendly = true;\n      const parseResult = parseFriendlyAddress(anyForm);\n      this.wc = parseResult.workchain;\n      this.hashPart = parseResult.hashPart;\n      this.isTestOnly = parseResult.isTestOnly;\n      this.isBounceable = parseResult.isBounceable;\n    }\n  }\n\n  /**\n   * @param isUserFriendly? {boolean}\n   * @param isUrlSafe? {boolean}\n   * @param isBounceable? {boolean}\n   * @param isTestOnly? {boolean}\n   * @return {string}\n   */\n  toString(isUserFriendly, isUrlSafe, isBounceable, isTestOnly) {\n    if (isUserFriendly === undefined) isUserFriendly = this.isUserFriendly;\n    if (isUrlSafe === undefined) isUrlSafe = this.isUrlSafe;\n    if (isBounceable === undefined) isBounceable = this.isBounceable;\n    if (isTestOnly === undefined) isTestOnly = this.isTestOnly;\n    if (!isUserFriendly) {\n      return this.wc + \":\" + bytesToHex(this.hashPart);\n    } else {\n      let tag = isBounceable ? bounceable_tag : non_bounceable_tag;\n      if (isTestOnly) {\n        tag |= test_flag;\n      }\n      const addr = new Int8Array(34);\n      addr[0] = tag;\n      addr[1] = this.wc;\n      addr.set(this.hashPart, 2);\n      const addressWithChecksum = new Uint8Array(36);\n      addressWithChecksum.set(addr);\n      addressWithChecksum.set(crc16(addr), 34);\n      let addressBase64 = stringToBase64(String.fromCharCode.apply(null, new Uint8Array(addressWithChecksum)));\n      if (isUrlSafe) {\n        addressBase64 = addressBase64.replace(/\\+/g, '-').replace(/\\//g, '_');\n      }\n      return addressBase64;\n    }\n  }\n}\nmodule.exports.default = Address;","map":{"version":3,"names":["crc16","hexToBytes","bytesToHex","stringToBytes","base64toString","stringToBase64","require","bounceable_tag","non_bounceable_tag","test_flag","parseFriendlyAddress","addressString","data","length","addr","slice","crc","calcedCrc","tag","isTestOnly","isBounceable","workchain","Error","hashPart","Address","isValid","anyForm","e","constructor","wc","isUserFriendly","isUrlSafe","search","replace","indexOf","arr","split","parseInt","hex","parseResult","toString","undefined","Int8Array","set","addressWithChecksum","Uint8Array","addressBase64","String","fromCharCode","apply","module","exports","default"],"sources":["/Users/sepezho/Work/tonana/fe/node_modules/tonweb/src/utils/Address.js"],"sourcesContent":["const {crc16, hexToBytes, bytesToHex, stringToBytes, base64toString, stringToBase64} = require(\"./Utils\");\n\nconst bounceable_tag = 0x11;\nconst non_bounceable_tag = 0x51;\nconst test_flag = 0x80;\n\n/**\n * @private\n * @param addressString {string}\n * @return {{isTestOnly: boolean, workchain: number, hashPart: Uint8Array, isBounceable: boolean}}\n */\nfunction parseFriendlyAddress(addressString) {\n    const data = stringToBytes(base64toString(addressString));\n    if (data.length !== 36) { // 1byte tag + 1byte workchain + 32 bytes hash + 2 byte crc\n        throw \"Unknown address type: byte length is not equal to 36\";\n    }\n    const addr = data.slice(0, 34);\n    const crc = data.slice(34, 36);\n    const calcedCrc = crc16(addr);\n    if (!(calcedCrc[0] === crc[0] && calcedCrc[1] === crc[1])) {\n        throw \"Wrong crc16 hashsum\";\n    }\n    let tag = addr[0];\n    let isTestOnly = false;\n    let isBounceable = false;\n    if (tag & test_flag) {\n        isTestOnly = true;\n        tag = tag ^ test_flag;\n    }\n    if ((tag !== bounceable_tag) && (tag !== non_bounceable_tag))\n        throw \"Unknown address tag\";\n\n    isBounceable = tag === bounceable_tag;\n\n    let workchain = null;\n    if (addr[1] === 0xff) { // TODO we should read signed integer here\n        workchain = -1;\n    } else {\n        workchain = addr[1];\n    }\n    if (workchain !== 0 && workchain !== -1) throw new Error('Invalid address wc ' + workchain);\n\n    const hashPart = addr.slice(2, 34);\n    return {isTestOnly, isBounceable, workchain, hashPart};\n}\n\nclass Address {\n    /**\n     * @param anyForm {string | Address}\n     */\n    static isValid(anyForm) {\n        try {\n            new Address(anyForm);\n            return true;\n        } catch (e) {\n            return false;\n        }\n    }\n\n    /**\n     * @param anyForm {string | Address}\n     */\n    constructor(anyForm) {\n        if (anyForm == null) {\n            throw \"Invalid address\";\n        }\n\n        if (anyForm instanceof Address) {\n            this.wc = anyForm.wc;\n            this.hashPart = anyForm.hashPart;\n            this.isTestOnly = anyForm.isTestOnly;\n            this.isUserFriendly = anyForm.isUserFriendly;\n            this.isBounceable = anyForm.isBounceable;\n            this.isUrlSafe = anyForm.isUrlSafe;\n            return;\n        }\n\n        if (anyForm.search(/\\-/) > 0 || anyForm.search(/_/) > 0) {\n            this.isUrlSafe = true;\n            anyForm = anyForm.replace(/\\-/g, '+').replace(/_/g, '\\/');\n        } else {\n            this.isUrlSafe = false;\n        }\n        if (anyForm.indexOf(':') > -1) {\n            const arr = anyForm.split(':');\n            if (arr.length !== 2) throw new Error('Invalid address ' + anyForm);\n            const wc = parseInt(arr[0]);\n            if (wc !== 0 && wc !== -1) throw new Error('Invalid address wc ' + anyForm);\n            const hex = arr[1];\n            if (hex.length !== 64) throw new Error('Invalid address hex ' + anyForm);\n            this.isUserFriendly = false;\n            this.wc = wc;\n            this.hashPart = hexToBytes(hex);\n            this.isTestOnly = false;\n            this.isBounceable = false;\n        } else {\n            this.isUserFriendly = true;\n            const parseResult = parseFriendlyAddress(anyForm);\n            this.wc = parseResult.workchain;\n            this.hashPart = parseResult.hashPart;\n            this.isTestOnly = parseResult.isTestOnly;\n            this.isBounceable = parseResult.isBounceable;\n        }\n    }\n\n    /**\n     * @param isUserFriendly? {boolean}\n     * @param isUrlSafe? {boolean}\n     * @param isBounceable? {boolean}\n     * @param isTestOnly? {boolean}\n     * @return {string}\n     */\n    toString(isUserFriendly,\n             isUrlSafe,\n             isBounceable,\n             isTestOnly) {\n\n        if (isUserFriendly === undefined) isUserFriendly = this.isUserFriendly;\n        if (isUrlSafe === undefined) isUrlSafe = this.isUrlSafe;\n        if (isBounceable === undefined) isBounceable = this.isBounceable;\n        if (isTestOnly === undefined) isTestOnly = this.isTestOnly;\n\n        if (!isUserFriendly) {\n            return this.wc + \":\" + bytesToHex(this.hashPart);\n        } else {\n            let tag = isBounceable ? bounceable_tag : non_bounceable_tag;\n            if (isTestOnly) {\n                tag |= test_flag;\n            }\n\n            const addr = new Int8Array(34);\n            addr[0] = tag;\n            addr[1] = this.wc;\n            addr.set(this.hashPart, 2);\n\n            const addressWithChecksum = new Uint8Array(36);\n            addressWithChecksum.set(addr);\n            addressWithChecksum.set(crc16(addr), 34);\n            let addressBase64 = stringToBase64(String.fromCharCode.apply(null, new Uint8Array(addressWithChecksum)));\n\n            if (isUrlSafe) {\n                addressBase64 = addressBase64.replace(/\\+/g, '-').replace(/\\//g, '_');\n            }\n            return addressBase64;\n        }\n    }\n}\n\nmodule.exports.default = Address;"],"mappings":"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"},"metadata":{},"sourceType":"script"}