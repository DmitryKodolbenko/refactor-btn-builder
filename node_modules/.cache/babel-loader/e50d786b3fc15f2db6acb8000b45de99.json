{"ast":null,"code":"import _regeneratorRuntime from\"/Users/sepezho/Work/tonana/fe/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/sepezho/Work/tonana/fe/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import{message}from\"antd\";import{transactions}from'near-api-js';import TonWeb from\"tonweb\";import{parseUsnAmount}from\"./formatUsn.js\";var axios=require(\"axios\").default;var MakeUSNTrx=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(activeBtn,setIsload,NEARwalletKey,amount,walletTo,netTo,hexString,openData,add,params){return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!activeBtn){_context.next=6;break;}setIsload(true);//@ts-ignore\n_context.next=4;return window.contract.account._signAndSendTransaction({receiverId:process.env.REACT_APP_USN_CONTRACT,actions:[transactions.functionCall('ft_transfer',Buffer.from(JSON.stringify({receiver_id:process.env.REACT_APP_BACK_NEAR_WALLET,amount:parseUsnAmount(amount),memo:\"\".concat(openData?\"SM#\":\"\").concat(netTo,\"#\").concat(openData?add:walletTo).concat(openData?\"#\".concat(btoa(params)):\"\")})),new TonWeb.utils.BN(40000000000000),new TonWeb.utils.BN(1))],walletCallbackUrl:'https://app.tonana.org/?isusn=true'});case 4:_context.next=7;break;case 6:message.error(\"Fill all forms and connect wallets!\",10);case 7:case\"end\":return _context.stop();}}},_callee);}));return function MakeUSNTrx(_x,_x2,_x3,_x4,_x5,_x6,_x7,_x8,_x9,_x10){return _ref.apply(this,arguments);};}();export var makeUSNTrxAfterLoad=function makeUSNTrxAfterLoad(transactionHashes,setSearchParams,searchParams){if(transactionHashes){fetch(process.env.REACT_APP_STATE===\"dev\"?\"http://localhost:8092\":process.env.REACT_APP_STATE===\"dev-remote\"?\"https://dev.api.tonana.org\":\"https://api.tonana.org/\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({hash:transactionHashes,sourceChain:\"usn\"})}).then(function(e){return e.text();}).then(function(e){if(e===\"Done!\"){searchParams.delete(\"transactionHashes\");searchParams.delete(\"isusn\");setSearchParams(searchParams);}});}};export default MakeUSNTrx;","map":{"version":3,"names":["message","transactions","TonWeb","parseUsnAmount","axios","require","default","MakeUSNTrx","activeBtn","setIsload","NEARwalletKey","amount","walletTo","netTo","hexString","openData","add","params","window","contract","account","_signAndSendTransaction","receiverId","process","env","REACT_APP_USN_CONTRACT","actions","functionCall","Buffer","from","JSON","stringify","receiver_id","REACT_APP_BACK_NEAR_WALLET","memo","btoa","utils","BN","walletCallbackUrl","error","makeUSNTrxAfterLoad","transactionHashes","setSearchParams","searchParams","fetch","REACT_APP_STATE","method","headers","body","hash","sourceChain","then","e","text","delete"],"sources":["/Users/sepezho/Work/tonana/fe/src/logic/transaction/MakeUSNTrx.ts"],"sourcesContent":["import { message } from \"antd\";\nimport { connect,Contract, utils,transactions, keyStores, WalletConnection } from 'near-api-js';\nimport TonWeb from \"tonweb\";\nimport { parseUsnAmount } from \"./formatUsn.js\";\nconst axios = require(\"axios\").default;\n\n\nconst MakeUSNTrx = async (activeBtn: any, setIsload: any, NEARwalletKey: string, amount: any, walletTo: any, netTo: string, hexString: any, openData: boolean, add: string, params: string) => {\n  if (activeBtn) {\n    setIsload(true);\n    //@ts-ignore\n    await window.contract.account._signAndSendTransaction({\n      receiverId: process.env.REACT_APP_USN_CONTRACT,\n      actions: [\n        transactions.functionCall(\n          'ft_transfer',\n          Buffer.from(JSON.stringify({ receiver_id: process.env.REACT_APP_BACK_NEAR_WALLET, amount: parseUsnAmount(amount), memo: `${openData ? \"SM#\" : \"\"}${netTo}#${openData? add : walletTo}${openData ? `#${btoa(params)}` : \"\"}` })),\n          new TonWeb.utils.BN(40000000000000),\n          new TonWeb.utils.BN(1),\n\n        )\n      ],\n      walletCallbackUrl: 'https://app.tonana.org/?isusn=true'\n\n    })\n\n  } else {\n    message.error(\"Fill all forms and connect wallets!\", 10);\n  }\n};\n\nexport const makeUSNTrxAfterLoad = (transactionHashes: any, setSearchParams:any,searchParams: any) => {\n  if (transactionHashes) {\n    fetch(process.env.REACT_APP_STATE === \"dev\" ? \"http://localhost:8092\" : process.env.REACT_APP_STATE === \"dev-remote\" ? \"https://dev.api.tonana.org\"   : \"https://api.tonana.org/\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({\n        hash: transactionHashes,\n        sourceChain: \"usn\",\n      }),\n    })\n      .then((e) => e.text())\n      .then((e) => {\n        if (e === \"Done!\") {\n          searchParams.delete(\"transactionHashes\");\n          searchParams.delete(\"isusn\");\n          setSearchParams(searchParams);\n        }\n      });\n    }\n  }\n\nexport default MakeUSNTrx"],"mappings":"sPAAA,OAASA,OAAO,KAAQ,MAAM,CAC9B,OAAiCC,YAAY,KAAqC,aAAa,CAC/F,MAAOC,OAAM,KAAM,QAAQ,CAC3B,OAASC,cAAc,KAAQ,gBAAgB,CAC/C,GAAMC,MAAK,CAAGC,OAAO,CAAC,OAAO,CAAC,CAACC,OAAO,CAGtC,GAAMC,WAAU,4FAAG,iBAAOC,SAAc,CAAEC,SAAc,CAAEC,aAAqB,CAAEC,MAAW,CAAEC,QAAa,CAAEC,KAAa,CAAEC,SAAc,CAAEC,QAAiB,CAAEC,GAAW,CAAEC,MAAc,wHACpLT,SAAS,yBACXC,SAAS,CAAC,IAAI,CAAC,CACf;AAAA,sBACMS,OAAM,CAACC,QAAQ,CAACC,OAAO,CAACC,uBAAuB,CAAC,CACpDC,UAAU,CAAEC,OAAO,CAACC,GAAG,CAACC,sBAAsB,CAC9CC,OAAO,CAAE,CACPzB,YAAY,CAAC0B,YAAY,CACvB,aAAa,CACbC,MAAM,CAACC,IAAI,CAACC,IAAI,CAACC,SAAS,CAAC,CAAEC,WAAW,CAAET,OAAO,CAACC,GAAG,CAACS,0BAA0B,CAAEtB,MAAM,CAAER,cAAc,CAACQ,MAAM,CAAC,CAAEuB,IAAI,WAAKnB,QAAQ,CAAG,KAAK,CAAG,EAAE,SAAGF,KAAK,aAAIE,QAAQ,CAAEC,GAAG,CAAGJ,QAAQ,SAAGG,QAAQ,YAAOoB,IAAI,CAAClB,MAAM,CAAC,EAAK,EAAE,CAAG,CAAC,CAAC,CAAC,CAC/N,GAAIf,OAAM,CAACkC,KAAK,CAACC,EAAE,CAAC,cAAc,CAAC,CACnC,GAAInC,OAAM,CAACkC,KAAK,CAACC,EAAE,CAAC,CAAC,CAAC,CAEvB,CACF,CACDC,iBAAiB,CAAE,oCAErB,CAAC,CAAC,qCAGFtC,OAAO,CAACuC,KAAK,CAAC,qCAAqC,CAAE,EAAE,CAAC,CAAC,sDAE5D,kBAtBKhC,WAAU,iFAsBf,CAED,MAAO,IAAMiC,oBAAmB,CAAG,QAAtBA,oBAAmB,CAAIC,iBAAsB,CAAEC,eAAmB,CAACC,YAAiB,CAAK,CACpG,GAAIF,iBAAiB,CAAE,CACrBG,KAAK,CAACrB,OAAO,CAACC,GAAG,CAACqB,eAAe,GAAK,KAAK,CAAG,uBAAuB,CAAGtB,OAAO,CAACC,GAAG,CAACqB,eAAe,GAAK,YAAY,CAAG,4BAA4B,CAAK,yBAAyB,CAAE,CACjLC,MAAM,CAAE,MAAM,CACdC,OAAO,CAAE,CAAE,cAAc,CAAE,kBAAmB,CAAC,CAC/CC,IAAI,CAAElB,IAAI,CAACC,SAAS,CAAC,CACnBkB,IAAI,CAAER,iBAAiB,CACvBS,WAAW,CAAE,KACf,CAAC,CACH,CAAC,CAAC,CACCC,IAAI,CAAC,SAACC,CAAC,QAAKA,EAAC,CAACC,IAAI,EAAE,GAAC,CACrBF,IAAI,CAAC,SAACC,CAAC,CAAK,CACX,GAAIA,CAAC,GAAK,OAAO,CAAE,CACjBT,YAAY,CAACW,MAAM,CAAC,mBAAmB,CAAC,CACxCX,YAAY,CAACW,MAAM,CAAC,OAAO,CAAC,CAC5BZ,eAAe,CAACC,YAAY,CAAC,CAC/B,CACF,CAAC,CAAC,CACJ,CACF,CAAC,CAEH,cAAepC,WAAU"},"metadata":{},"sourceType":"module"}