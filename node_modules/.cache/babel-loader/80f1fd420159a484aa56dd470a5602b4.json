{"ast":null,"code":"import _slicedToArray from \"/Users/sepezho/Work/tonana/fe/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport _regeneratorRuntime from \"/Users/sepezho/Work/tonana/fe/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _toConsumableArray from \"/Users/sepezho/Work/tonana/fe/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";\nimport { waitFor } from '@near-wallet-selector/core';\nimport detectEthereumProvider from '@metamask/detect-provider';\nimport { ethers } from 'ethers';\nimport * as nearAPI from 'near-api-js';\nimport { generateSeedPhrase } from 'near-seed-phrase';\nimport BN from 'bn.js';\nimport isMobile from 'is-mobile';\n\n/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\n\nfunction __awaiter(thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n}\nvar nethIcon = \"data:image/png;base64,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\";\n\n/*eslint @typescript-eslint/no-use-before-define: 1*/\nvar Near = nearAPI.Near,\n  Account = nearAPI.Account,\n  KeyPair = nearAPI.KeyPair,\n  BrowserLocalStorageKeyStore = nearAPI.keyStores.BrowserLocalStorageKeyStore,\n  _nearAPI$transactions = nearAPI.transactions,\n  addKey = _nearAPI$transactions.addKey,\n  deleteKey = _nearAPI$transactions.deleteKey,\n  functionCallAccessKey = _nearAPI$transactions.functionCallAccessKey,\n  _nearAPI$utils = nearAPI.utils,\n  PublicKey = _nearAPI$utils.PublicKey,\n  parseNearAmount = _nearAPI$utils.format.parseNearAmount;\nvar NETH_SITE_URL = \"https://neth.app\";\nvar PREV_NETH_SITE_URL = \"neardefi.github.io/neth\";\nvar NETWORK = {\n  testnet: {\n    FUNDING_ACCOUNT_ID: \"neth.testnet\",\n    MAP_ACCOUNT_ID: \"map.neth.testnet\",\n    ROOT_ACCOUNT_ID: \"testnet\"\n  },\n  mainnet: {\n    MAP_ACCOUNT_ID: \"nethmap.near\",\n    ROOT_ACCOUNT_ID: \"near\"\n  }\n};\nvar WS_STORAGE_NAMESPACE = \"near-wallet-selector:neth:\";\nvar REFRESH_MSG = \"Please refresh the page and try again.\";\nvar TX_ARGS_ATTEMPT = \"__TX_ARGS_ATTEMPT\";\nvar ATTEMPT_SECRET_KEY = \"__ATTEMPT_SECRET_KEY\";\nvar ATTEMPT_ACCOUNT_ID = \"__ATTEMPT_ACCOUNT_ID\";\nvar ATTEMPT_ETH_ADDRESS = \"__ATTEMPT_ETH_ADDRESS\";\nvar APP_KEY_SECRET = \"__APP_KEY_SECRET\";\nvar APP_KEY_ACCOUNT_ID = \"__APP_KEY_ACCOUNT_ID\";\nvar defaultGas = \"200000000000000\";\nvar halfGas = \"50000000000000\"; /// this is the new account amount 0.21 for account name, keys, contract and 0.01 for mapping contract storage cost\n\nvar MIN_NEW_ACCOUNT = parseNearAmount(\"0.4\");\nvar MIN_NEW_ACCOUNT_THRESH = parseNearAmount(\"0.49\");\nvar MIN_NEW_ACCOUNT_ASK = parseNearAmount(\"0.5\");\nvar FUNDING_CHECK_TIMEOUT = 5000; /// lkmfawl\n\nvar attachedDepositMapping = parseNearAmount(\"0.05\"); /// Helpers\n\nvar defaultStorage = function defaultStorage() {\n  var prefix = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : \"\";\n  return {\n    getItem: function getItem(k) {\n      var v = localStorage.getItem(prefix + k);\n      if ((v === null || v === void 0 ? void 0 : v.charAt(0)) !== \"{\") {\n        return v;\n      }\n      try {\n        return JSON.parse(v);\n      } catch (e) {//   logger.log(e);\n      }\n    },\n    setItem: function setItem(k, v) {\n      return localStorage.setItem(prefix + k, typeof v === \"string\" ? v : JSON.stringify(v));\n    },\n    removeItem: function removeItem(k) {\n      return localStorage.removeItem(prefix + k);\n    }\n  };\n};\nvar defaultLogger = function defaultLogger() {\n  return {\n    // eslint-disable-next-line\n    log: function log(args) {\n      var _console;\n      return (_console = console).log.apply(_console, _toConsumableArray(args));\n    }\n  };\n}; /// NEAR setup\n\nvar near, gas, keyStore, logger, storage, connection, networkId, contractAccount, accountSuffix;\nvar initConnection = function initConnection(_ref) {\n  var network = _ref.network,\n    _ref$gas = _ref.gas,\n    _gas = _ref$gas === void 0 ? defaultGas : _ref$gas,\n    _ref$logger = _ref.logger,\n    _logger = _ref$logger === void 0 ? defaultLogger() : _ref$logger,\n    _ref$storage = _ref.storage,\n    _storage = _ref$storage === void 0 ? defaultStorage() : _ref$storage;\n  gas = _gas;\n  logger = _logger;\n  storage = _storage;\n  keyStore = new BrowserLocalStorageKeyStore();\n  near = new Near(Object.assign(Object.assign({}, network), {\n    keyStore: keyStore\n  }));\n  connection = near.connection;\n  networkId = network.networkId;\n  contractAccount = new Account(connection, networkId === \"mainnet\" ? \"near\" : networkId);\n  accountSuffix = networkId === \"mainnet\" ? \".near\" : \".\" + networkId;\n  var cover = document.createElement(\"div\");\n  cover.style.display = \"none\";\n  cover.style.width = \"100%\";\n  cover.style.height = \"100vh\";\n  cover.style.zIndex = \"999999\";\n  cover.style.position = \"fixed\";\n  cover.style.top = \"0\";\n  cover.style.background = \"rgba(0, 0, 0, 0.5)\";\n  document.body.appendChild(cover); /// recovery from unbundled TXs that haven't been broadcast yet\n\n  broadcastTXs();\n  return cover;\n};\nvar getConnection = function getConnection() {\n  return {\n    near: near,\n    connection: connection,\n    keyStore: keyStore,\n    networkId: networkId,\n    contractAccount: contractAccount,\n    accountSuffix: accountSuffix\n  };\n}; /// helpers\n\nvar accountExists = function accountExists(accountId) {\n  var ethAddress = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n  return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n    var account, mapAccountId;\n    return _regeneratorRuntime().wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.prev = 0;\n            account = new nearAPI.Account(connection, accountId);\n            _context.next = 4;\n            return account.state();\n          case 4:\n            if (!ethAddress) {\n              _context.next = 10;\n              break;\n            }\n            _context.next = 7;\n            return getNearMap(ethAddress);\n          case 7:\n            mapAccountId = _context.sent;\n            if (!mapAccountId) {\n              _context.next = 10;\n              break;\n            }\n            return _context.abrupt(\"return\", true);\n          case 10:\n            return _context.abrupt(\"return\", true);\n          case 13:\n            _context.prev = 13;\n            _context.t0 = _context[\"catch\"](0);\n            if (/no such file|does not exist/.test(_context.t0.toString())) {\n              _context.next = 17;\n              break;\n            }\n            throw _context.t0;\n          case 17:\n            return _context.abrupt(\"return\", false);\n          case 18:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, null, [[0, 13]]);\n  }));\n};\nvar buf2hex = function buf2hex(buf) {\n  return ethers.utils.hexlify(buf).substring(2);\n};\nvar pub2hex = function pub2hex(publicKey) {\n  return ethers.utils.hexlify(PublicKey.fromString(publicKey).data).substring(2);\n}; /// account creation and connection flow\n\nvar handleCreate = function handleCreate(signer, ethAddress, newAccountId, fundingAccountCB, fundingErrorCB, postFundingCB) {\n  return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n    var _yield$keyPairFromEth, fundingAccountPubKey, new_secret_key;\n    return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            if (!(networkId === \"testnet\" && newAccountId.indexOf(\".near\") > -1 || networkId === \"mainnet\" && newAccountId.indexOf(\".testnet\") > -1)) {\n              _context2.next = 2;\n              break;\n            }\n            return _context2.abrupt(\"return\", alert(\"Invalid account name. You do not need to add any .near or .testnet. Please try again.\"));\n          case 2:\n            _context2.next = 4;\n            return keyPairFromEthSig(signer, fundingKeyPayload());\n          case 4:\n            _yield$keyPairFromEth = _context2.sent;\n            fundingAccountPubKey = _yield$keyPairFromEth.publicKey;\n            new_secret_key = _yield$keyPairFromEth.secretKey;\n            _context2.next = 9;\n            return storage.setItem(ATTEMPT_ACCOUNT_ID, newAccountId);\n          case 9:\n            _context2.next = 11;\n            return storage.setItem(ATTEMPT_SECRET_KEY, new_secret_key);\n          case 11:\n            _context2.next = 13;\n            return storage.setItem(ATTEMPT_ETH_ADDRESS, ethAddress);\n          case 13:\n            _context2.next = 15;\n            return createAccount({\n              signer: signer,\n              newAccountId: newAccountId,\n              fundingAccountPubKey: fundingAccountPubKey,\n              fundingAccountCB: fundingAccountCB,\n              fundingErrorCB: fundingErrorCB,\n              postFundingCB: postFundingCB\n            });\n          case 15:\n            return _context2.abrupt(\"return\", _context2.sent);\n          case 16:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n};\nvar createAccount = function createAccount(_ref2) {\n  var signer = _ref2.signer,\n    newAccountId = _ref2.newAccountId,\n    fundingAccountPubKey = _ref2.fundingAccountPubKey,\n    fundingAccountCB = _ref2.fundingAccountCB,\n    fundingErrorCB = _ref2.fundingErrorCB,\n    postFundingCB = _ref2.postFundingCB;\n  return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee4() {\n    var implicitAccountId, checkImplicitFunded, _yield$setupFromStora, account, ethAddress, _yield$keyPairFromEth2, new_public_key, new_secret_key;\n    return _regeneratorRuntime().wrap(function _callee4$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            // const { publicKey, secretKey } = parseSeedPhrase(process.env.REACT_APP_FUNDING_SEED_PHRASE);\n            /// assumes implicit is funded, otherwise will warn and cycle here\n            implicitAccountId = Buffer.from(PublicKey.from(fundingAccountPubKey).data).toString(\"hex\");\n            if (fundingAccountCB) {\n              fundingAccountCB(implicitAccountId);\n            } /// wait for implicit funding here and then continue to createAccount\n            checkImplicitFunded = function checkImplicitFunded() {\n              return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee3() {\n                var account, balance, available, diff;\n                return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n                  while (1) {\n                    switch (_context3.prev = _context3.next) {\n                      case 0:\n                        logger.log(\"checking for funding of implicit account\", implicitAccountId);\n                        account = new Account(connection, implicitAccountId);\n                        _context3.prev = 2;\n                        _context3.next = 5;\n                        return account.getAccountBalance();\n                      case 5:\n                        balance = _context3.sent;\n                        available = balance.available;\n                        diff = new BN(available).sub(new BN(MIN_NEW_ACCOUNT_THRESH));\n                        if (!diff.lt(new BN(\"0\"))) {\n                          _context3.next = 15;\n                          break;\n                        }\n                        // alert(`There is not enough NEAR (${formatNearAmount(MIN_NEW_ACCOUNT_ASK, 4)} minimum) to create a new account and deploy NETH contract. Please deposit more and try again.`)\n                        if (fundingErrorCB) {\n                          fundingErrorCB(implicitAccountId, diff.abs().toString());\n                        }\n                        _context3.next = 12;\n                        return new Promise(function (r) {\n                          return setTimeout(r, FUNDING_CHECK_TIMEOUT);\n                        });\n                      case 12:\n                        _context3.next = 14;\n                        return checkImplicitFunded();\n                      case 14:\n                        return _context3.abrupt(\"return\", _context3.sent);\n                      case 15:\n                        _context3.next = 27;\n                        break;\n                      case 17:\n                        _context3.prev = 17;\n                        _context3.t0 = _context3[\"catch\"](2);\n                        if (/does not exist/gi.test(_context3.t0.toString())) {\n                          _context3.next = 21;\n                          break;\n                        }\n                        throw _context3.t0;\n                      case 21:\n                        logger.log(\"not funded, checking again\");\n                        _context3.next = 24;\n                        return new Promise(function (r) {\n                          return setTimeout(r, FUNDING_CHECK_TIMEOUT);\n                        });\n                      case 24:\n                        _context3.next = 26;\n                        return checkImplicitFunded();\n                      case 26:\n                        return _context3.abrupt(\"return\", _context3.sent);\n                      case 27:\n                        return _context3.abrupt(\"return\", true);\n                      case 28:\n                      case \"end\":\n                        return _context3.stop();\n                    }\n                  }\n                }, _callee3, null, [[2, 17]]);\n              }));\n            }; /// if not funded properly, return and reload\n            _context4.next = 5;\n            return checkImplicitFunded();\n          case 5:\n            if (_context4.sent) {\n              _context4.next = 7;\n              break;\n            }\n            return _context4.abrupt(\"return\", window.location.reload());\n          case 7:\n            logger.log(\"implicit account funded\", implicitAccountId);\n            if (postFundingCB) {\n              postFundingCB();\n            }\n            _context4.next = 11;\n            return setupFromStorage(implicitAccountId);\n          case 11:\n            _yield$setupFromStora = _context4.sent;\n            account = _yield$setupFromStora.account;\n            ethAddress = _yield$setupFromStora.ethAddress;\n            _context4.next = 16;\n            return accountExists(newAccountId, ethAddress);\n          case 16:\n            if (!_context4.sent) {\n              _context4.next = 21;\n              break;\n            }\n            alert(\"\".concat(newAccountId, \" already exists. Please try another.\"));\n            _context4.next = 20;\n            return handleCancelFunding(implicitAccountId);\n          case 20:\n            return _context4.abrupt(\"return\", _context4.sent);\n          case 21:\n            _context4.next = 23;\n            return keyPairFromEthSig(signer, unlimitedKeyPayload(newAccountId, ethAddress));\n          case 23:\n            _yield$keyPairFromEth2 = _context4.sent;\n            new_public_key = _yield$keyPairFromEth2.publicKey;\n            new_secret_key = _yield$keyPairFromEth2.secretKey;\n            _context4.next = 28;\n            return storage.setItem(ATTEMPT_SECRET_KEY, new_secret_key);\n          case 28:\n            _context4.next = 30;\n            return storage.removeItem(APP_KEY_ACCOUNT_ID);\n          case 30:\n            _context4.next = 32;\n            return storage.removeItem(APP_KEY_SECRET);\n          case 32:\n            _context4.prev = 32;\n            _context4.next = 35;\n            return account.functionCall({\n              contractId: NETWORK[networkId].ROOT_ACCOUNT_ID,\n              methodName: \"create_account\",\n              args: {\n                new_account_id: newAccountId,\n                new_public_key: new_public_key\n              },\n              gas: gas,\n              attachedDeposit: new BN(MIN_NEW_ACCOUNT)\n            });\n          case 35:\n            _context4.next = 42;\n            break;\n          case 37:\n            _context4.prev = 37;\n            _context4.t0 = _context4[\"catch\"](32);\n            if (/be created by/.test(JSON.stringify(_context4.t0))) {\n              _context4.next = 41;\n              break;\n            }\n            throw _context4.t0;\n          case 41:\n            return _context4.abrupt(\"return\", handleCancelFunding(implicitAccountId));\n          case 42:\n            _context4.next = 44;\n            return accountExists(newAccountId);\n          case 44:\n            if (_context4.sent) {\n              _context4.next = 46;\n              break;\n            }\n            return _context4.abrupt(\"return\", logger.log(\"Account \".concat(newAccountId, \" could NOT be created. Please refresh the page and try again.\")));\n          case 46:\n            logger.log(\"Account \".concat(newAccountId, \" created successfully.\")); /// drain implicit\n            _context4.next = 49;\n            return account.deleteAccount(newAccountId);\n          case 49:\n            _context4.next = 51;\n            return handleMapping();\n          case 51:\n            return _context4.abrupt(\"return\", _context4.sent);\n          case 52:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, _callee4, null, [[32, 37]]);\n  }));\n};\nvar handleCancelFunding = function handleCancelFunding(fundingAccountId) {\n  return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee5() {\n    var _yield$setupFromStora2, account, refundAccountId;\n    return _regeneratorRuntime().wrap(function _callee5$(_context5) {\n      while (1) {\n        switch (_context5.prev = _context5.next) {\n          case 0:\n            _context5.next = 2;\n            return setupFromStorage(fundingAccountId);\n          case 2:\n            _yield$setupFromStora2 = _context5.sent;\n            account = _yield$setupFromStora2.account;\n            refundAccountId = window.prompt(\"There was an error creating the account. You need to refund and try again. Please enter the account you funded from. MAKE SURE IT IS CORRECT. THIS CANNOT BE UNDONE.\"); /// drain implicit\n            _context5.prev = 5;\n            _context5.next = 8;\n            return account.deleteAccount(refundAccountId);\n          case 8:\n            _context5.next = 13;\n            break;\n          case 10:\n            _context5.prev = 10;\n            _context5.t0 = _context5[\"catch\"](5);\n            logger.log(\"Cannot delete implicit\");\n          case 13:\n            _context5.prev = 13;\n            _context5.next = 16;\n            return storage.removeItem(ATTEMPT_ACCOUNT_ID);\n          case 16:\n            _context5.next = 18;\n            return storage.removeItem(ATTEMPT_SECRET_KEY);\n          case 18:\n            _context5.next = 20;\n            return storage.removeItem(ATTEMPT_ETH_ADDRESS);\n          case 20:\n            return _context5.finish(13);\n          case 21:\n          case \"end\":\n            return _context5.stop();\n        }\n      }\n    }, _callee5, null, [[5, 10, 13, 21]]);\n  }));\n};\nvar handleMapping = function handleMapping() {\n  return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee6() {\n    var _yield$setupFromStora3, account, ethAddress;\n    return _regeneratorRuntime().wrap(function _callee6$(_context6) {\n      while (1) {\n        switch (_context6.prev = _context6.next) {\n          case 0:\n            _context6.next = 2;\n            return setupFromStorage();\n          case 2:\n            _yield$setupFromStora3 = _context6.sent;\n            account = _yield$setupFromStora3.account;\n            ethAddress = _yield$setupFromStora3.ethAddress;\n            _context6.prev = 5;\n            _context6.next = 8;\n            return account.functionCall({\n              contractId: NETWORK[networkId].MAP_ACCOUNT_ID,\n              methodName: \"set\",\n              args: {\n                eth_address: ethAddress\n              },\n              gas: gas,\n              attachedDeposit: new BN(attachedDepositMapping)\n            });\n          case 8:\n            logger.log(\"Account mapping successful\");\n            _context6.next = 15;\n            break;\n          case 11:\n            _context6.prev = 11;\n            _context6.t0 = _context6[\"catch\"](5);\n            logger.log(_context6.t0);\n            return _context6.abrupt(\"return\", logger.log(\"Account mapping failed\"));\n          case 15:\n            _context6.next = 17;\n            return handleDeployContract();\n          case 17:\n            return _context6.abrupt(\"return\", _context6.sent);\n          case 18:\n          case \"end\":\n            return _context6.stop();\n        }\n      }\n    }, _callee6, null, [[5, 11]]);\n  }));\n};\nvar handleDeployContract = function handleDeployContract() {\n  return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee7() {\n    var _yield$setupFromStora4, account, contractPath, ab, contractBytes;\n    return _regeneratorRuntime().wrap(function _callee7$(_context7) {\n      while (1) {\n        switch (_context7.prev = _context7.next) {\n          case 0:\n            _context7.next = 2;\n            return setupFromStorage();\n          case 2:\n            _yield$setupFromStora4 = _context7.sent;\n            account = _yield$setupFromStora4.account;\n            contractPath = window === null || window === void 0 ? void 0 : window.contractPath; // logger.log(contractPath)\n            _context7.next = 7;\n            return fetch(contractPath).then(function (res) {\n              return res.arrayBuffer();\n            });\n          case 7:\n            ab = _context7.sent;\n            contractBytes = new Uint8Array(ab); // logger.log(\"contractBytes.length\", contractBytes.length);\n            _context7.prev = 9;\n            _context7.next = 12;\n            return account.deployContract(contractBytes);\n          case 12:\n            logger.log(\"Contract deployed successfully.\");\n            _context7.next = 19;\n            break;\n          case 15:\n            _context7.prev = 15;\n            _context7.t0 = _context7[\"catch\"](9);\n            logger.log(_context7.t0);\n            return _context7.abrupt(\"return\", logger.log(\"Contract deployment failed. \".concat(REFRESH_MSG)));\n          case 19:\n            _context7.next = 21;\n            return handleSetupContract();\n          case 21:\n            return _context7.abrupt(\"return\", _context7.sent);\n          case 22:\n          case \"end\":\n            return _context7.stop();\n        }\n      }\n    }, _callee7, null, [[9, 15]]);\n  }));\n};\nvar handleSetupContract = function handleSetupContract() {\n  return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee8() {\n    var _yield$setupFromStora5, account, ethAddress;\n    return _regeneratorRuntime().wrap(function _callee8$(_context8) {\n      while (1) {\n        switch (_context8.prev = _context8.next) {\n          case 0:\n            _context8.next = 2;\n            return setupFromStorage();\n          case 2:\n            _yield$setupFromStora5 = _context8.sent;\n            account = _yield$setupFromStora5.account;\n            ethAddress = _yield$setupFromStora5.ethAddress;\n            _context8.prev = 5;\n            _context8.next = 8;\n            return account.functionCall({\n              contractId: account.accountId,\n              methodName: \"setup\",\n              args: {\n                eth_address: ethAddress\n              },\n              gas: gas\n            });\n          case 8:\n            logger.log(\"Contract setup successfully.\");\n            _context8.next = 15;\n            break;\n          case 11:\n            _context8.prev = 11;\n            _context8.t0 = _context8[\"catch\"](5);\n            logger.log(_context8.t0);\n            return _context8.abrupt(\"return\", logger.log(\"Contract setup failed. \".concat(REFRESH_MSG)));\n          case 15:\n            _context8.next = 17;\n            return handleKeys();\n          case 17:\n            return _context8.abrupt(\"return\", _context8.sent);\n          case 18:\n          case \"end\":\n            return _context8.stop();\n        }\n      }\n    }, _callee8, null, [[5, 11]]);\n  }));\n};\nvar handleKeys = function handleKeys() {\n  return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee9() {\n    var _a, _b, _c, _yield$setupFromStora6, account, newAccountId, ethAddress, accessKeys, publicKey, actions, res;\n    return _regeneratorRuntime().wrap(function _callee9$(_context9) {\n      while (1) {\n        switch (_context9.prev = _context9.next) {\n          case 0:\n            _context9.next = 2;\n            return setupFromStorage();\n          case 2:\n            _yield$setupFromStora6 = _context9.sent;\n            account = _yield$setupFromStora6.account;\n            newAccountId = _yield$setupFromStora6.newAccountId;\n            ethAddress = _yield$setupFromStora6.ethAddress;\n            _context9.next = 8;\n            return account.getAccessKeys();\n          case 8:\n            accessKeys = _context9.sent;\n            if (!(accessKeys.length !== 1 || ((_b = (_a = accessKeys[0]) === null || _a === void 0 ? void 0 : _a.access_key) === null || _b === void 0 ? void 0 : _b.permission) !== \"FullAccess\")) {\n              _context9.next = 11;\n              break;\n            }\n            return _context9.abrupt(\"return\");\n          case 11:\n            publicKey = PublicKey.from(accessKeys[0].public_key);\n            actions = [\n            // delete the full access key\n            deleteKey(publicKey),\n            // limited to execute, unlimited allowance\n            addKey(publicKey, functionCallAccessKey(newAccountId, [\"execute\"]))];\n            _context9.prev = 13;\n            _context9.next = 16;\n            return account.signAndSendTransaction({\n              receiverId: newAccountId,\n              actions: actions\n            });\n          case 16:\n            res = _context9.sent;\n            if (!(((_c = res === null || res === void 0 ? void 0 : res.status) === null || _c === void 0 ? void 0 : _c.SuccessValue) !== \"\")) {\n              _context9.next = 19;\n              break;\n            }\n            return _context9.abrupt(\"return\", logger.log(\"Key rotation failed. \".concat(REFRESH_MSG)));\n          case 19:\n            logger.log(\"Key rotation successful.\");\n            _context9.next = 26;\n            break;\n          case 22:\n            _context9.prev = 22;\n            _context9.t0 = _context9[\"catch\"](13);\n            logger.log(_context9.t0);\n            return _context9.abrupt(\"return\", logger.log(\"Key rotation failed. \".concat(REFRESH_MSG)));\n          case 26:\n            _context9.next = 28;\n            return handleCheckAccount({\n              ethAddress: ethAddress\n            });\n          case 28:\n            return _context9.abrupt(\"return\", _context9.sent);\n          case 29:\n          case \"end\":\n            return _context9.stop();\n        }\n      }\n    }, _callee9, null, [[13, 22]]);\n  }));\n}; /// waterfall check everything about account and fill in missing pieces\n\nvar handleCheckAccount = function handleCheckAccount(_ref3) {\n  var _ref3$signer = _ref3.signer,\n    signer = _ref3$signer === void 0 ? null : _ref3$signer,\n    _ref3$ethAddress = _ref3.ethAddress,\n    ethAddress = _ref3$ethAddress === void 0 ? null : _ref3$ethAddress,\n    _ref3$fundingAccountC = _ref3.fundingAccountCB,\n    fundingAccountCB = _ref3$fundingAccountC === void 0 ? null : _ref3$fundingAccountC,\n    _ref3$fundingErrorCB = _ref3.fundingErrorCB,\n    fundingErrorCB = _ref3$fundingErrorCB === void 0 ? null : _ref3$fundingErrorCB,\n    _ref3$postFundingCB = _ref3.postFundingCB,\n    postFundingCB = _ref3$postFundingCB === void 0 ? null : _ref3$postFundingCB;\n  return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee10() {\n    var _d, _e, setup, newAccountId, newSecretKey, mapAccountId, keyPair, account, mapRes, state, ethRes, accessKeys;\n    return _regeneratorRuntime().wrap(function _callee10$(_context10) {\n      while (1) {\n        switch (_context10.prev = _context10.next) {\n          case 0:\n            _context10.next = 2;\n            return setupFromStorage();\n          case 2:\n            setup = _context10.sent;\n            newAccountId = setup.newAccountId;\n            newSecretKey = setup.newSecretKey;\n            _context10.next = 7;\n            return getNearMap(ethAddress);\n          case 7:\n            mapAccountId = _context10.sent;\n            if (!mapAccountId) {\n              // alert(\"create account first\");\n              logger.log(\"No account mapping exists.\");\n            } else {\n              newAccountId = mapAccountId;\n            }\n            logger.log(\"Checking account created.\");\n            _context10.next = 12;\n            return accountExists(newAccountId);\n          case 12:\n            if (_context10.sent) {\n              _context10.next = 15;\n              break;\n            }\n            keyPair = KeyPair.fromString(newSecretKey);\n            return _context10.abrupt(\"return\", createAccount({\n              signer: signer,\n              newAccountId: newAccountId,\n              fundingAccountPubKey: keyPair.getPublicKey().toString(),\n              fundingAccountCB: fundingAccountCB,\n              fundingErrorCB: fundingErrorCB,\n              postFundingCB: postFundingCB\n            }));\n          case 15:\n            account = new Account(connection, newAccountId);\n            logger.log(\"Checking account address mapping.\");\n            _context10.next = 19;\n            return account.viewFunction(NETWORK[networkId].MAP_ACCOUNT_ID, \"get_eth\", {\n              account_id: newAccountId\n            });\n          case 19:\n            mapRes = _context10.sent;\n            if (!(mapRes === null)) {\n              _context10.next = 22;\n              break;\n            }\n            return _context10.abrupt(\"return\", handleMapping());\n          case 22:\n            logger.log(\"Checking contract deployed.\");\n            _context10.next = 25;\n            return account.state();\n          case 25:\n            state = _context10.sent;\n            if (!(state.code_hash === \"11111111111111111111111111111111\")) {\n              _context10.next = 28;\n              break;\n            }\n            return _context10.abrupt(\"return\", handleDeployContract());\n          case 28:\n            logger.log(\"Checking contract setup.\");\n            _context10.prev = 29;\n            _context10.next = 32;\n            return account.viewFunction(newAccountId, \"get_address\");\n          case 32:\n            ethRes = _context10.sent;\n            if (!(!ethRes || !ethRes.length)) {\n              _context10.next = 35;\n              break;\n            }\n            return _context10.abrupt(\"return\", handleSetupContract());\n          case 35:\n            _context10.next = 41;\n            break;\n          case 37:\n            _context10.prev = 37;\n            _context10.t0 = _context10[\"catch\"](29);\n            // not set at all (wasm error unreachable storage value)\n            logger.log(_context10.t0);\n            return _context10.abrupt(\"return\", handleSetupContract());\n          case 41:\n            logger.log(\"Checking access keys.\");\n            _context10.next = 44;\n            return account.getAccessKeys();\n          case 44:\n            accessKeys = _context10.sent;\n            if (!(accessKeys.length === 1 && ((_e = (_d = accessKeys[0]) === null || _d === void 0 ? void 0 : _d.access_key) === null || _e === void 0 ? void 0 : _e.permission) === \"FullAccess\")) {\n              _context10.next = 47;\n              break;\n            }\n            return _context10.abrupt(\"return\", handleKeys());\n          case 47:\n            logger.log(\"Account created.\");\n            logger.log(\"Contract deployed and setup.\");\n            logger.log(\"Mapping added.\");\n            logger.log(\"Keys rotated.\");\n            _context10.next = 53;\n            return storage.removeItem(ATTEMPT_ACCOUNT_ID);\n          case 53:\n            _context10.next = 55;\n            return storage.removeItem(ATTEMPT_SECRET_KEY);\n          case 55:\n            _context10.next = 57;\n            return storage.removeItem(ATTEMPT_ETH_ADDRESS);\n          case 57:\n            return _context10.abrupt(\"return\", {\n              account: account\n            });\n          case 58:\n          case \"end\":\n            return _context10.stop();\n        }\n      }\n    }, _callee10, null, [[29, 37]]);\n  }));\n}; /// on same domain as setup\n\nvar hasAppKey = function hasAppKey(accessKeys) {\n  return accessKeys.some(function (k) {\n    var _a, _b;\n    var functionCallPermission = (_b = (_a = k === null || k === void 0 ? void 0 : k.access_key) === null || _a === void 0 ? void 0 : _a.permission) === null || _b === void 0 ? void 0 : _b.FunctionCall;\n    return functionCallPermission.allowance !== null && functionCallPermission.method_names[0] === \"execute\";\n  });\n};\nvar handleRefreshAppKey = function handleRefreshAppKey(signer, ethAddress) {\n  return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee11() {\n    var _f, _yield$getUnlimitedKe, account, accountId, nonce, _yield$keyPairFromEth3, publicKey, secretKey, public_key, actions, accessKeys, appKeyNonce, _yield$keyPairFromEth4, oldPublicKey, oldPublicKeyHex, args, res;\n    return _regeneratorRuntime().wrap(function _callee11$(_context11) {\n      while (1) {\n        switch (_context11.prev = _context11.next) {\n          case 0:\n            _context11.next = 2;\n            return getUnlimitedKeyAccount(signer, ethAddress);\n          case 2:\n            _yield$getUnlimitedKe = _context11.sent;\n            account = _yield$getUnlimitedKe.account;\n            accountId = _yield$getUnlimitedKe.accountId;\n            _context11.t0 = parseInt;\n            _context11.next = 8;\n            return account.viewFunction(accountId, \"get_nonce\");\n          case 8:\n            _context11.t1 = _context11.sent;\n            nonce = (0, _context11.t0)(_context11.t1, 16).toString();\n            _context11.next = 12;\n            return keyPairFromEthSig(signer, appKeyPayload(accountId, nonce));\n          case 12:\n            _yield$keyPairFromEth3 = _context11.sent;\n            publicKey = _yield$keyPairFromEth3.publicKey;\n            secretKey = _yield$keyPairFromEth3.secretKey;\n            // logger.log(publicKey);\n            public_key = pub2hex(publicKey);\n            actions = [{\n              type: \"AddKey\",\n              public_key: public_key,\n              allowance: parseNearAmount(\"1\"),\n              receiver_id: accountId,\n              method_names: \"execute\"\n            }]; /// check keys, find old app key, delete that first\n            _context11.next = 19;\n            return account.getAccessKeys();\n          case 19:\n            accessKeys = _context11.sent;\n            if (!hasAppKey(accessKeys)) {\n              _context11.next = 32;\n              break;\n            }\n            _context11.t2 = parseInt;\n            _context11.next = 24;\n            return account.viewFunction(accountId, \"get_app_key_nonce\");\n          case 24:\n            _context11.t3 = _context11.sent;\n            appKeyNonce = (0, _context11.t2)(_context11.t3, 16).toString();\n            _context11.next = 28;\n            return keyPairFromEthSig(signer, appKeyPayload(accountId, appKeyNonce));\n          case 28:\n            _yield$keyPairFromEth4 = _context11.sent;\n            oldPublicKey = _yield$keyPairFromEth4.publicKey;\n            oldPublicKeyHex = pub2hex(oldPublicKey);\n            actions.unshift({\n              type: \"DeleteKey\",\n              public_key: oldPublicKeyHex\n            });\n          case 32:\n            _context11.next = 34;\n            return ethSignJson(signer, {\n              nonce: nonce,\n              receivers: [accountId],\n              transactions: [{\n                actions: actions\n              }]\n            });\n          case 34:\n            args = _context11.sent;\n            _context11.next = 37;\n            return account.functionCall({\n              contractId: accountId,\n              methodName: \"execute\",\n              args: args,\n              gas: gas\n            });\n          case 37:\n            res = _context11.sent;\n            if (!(((_f = res === null || res === void 0 ? void 0 : res.status) === null || _f === void 0 ? void 0 : _f.SuccessValue) !== \"\")) {\n              _context11.next = 40;\n              break;\n            }\n            return _context11.abrupt(\"return\", logger.log(\"App key rotation unsuccessful. \".concat(REFRESH_MSG)));\n          case 40:\n            _context11.next = 42;\n            return storage.removeItem(APP_KEY_SECRET);\n          case 42:\n            _context11.next = 44;\n            return storage.removeItem(APP_KEY_ACCOUNT_ID);\n          case 44:\n            return _context11.abrupt(\"return\", {\n              publicKey: public_key,\n              secretKey: secretKey\n            });\n          case 45:\n          case \"end\":\n            return _context11.stop();\n        }\n      }\n    }, _callee11);\n  }));\n};\nvar handleUpdateContract = function handleUpdateContract(signer, ethAddress) {\n  return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee12() {\n    var _g, _yield$getUnlimitedKe2, account, accountId, contractPath, ab, contractBytes, actions, nonce, args, res;\n    return _regeneratorRuntime().wrap(function _callee12$(_context12) {\n      while (1) {\n        switch (_context12.prev = _context12.next) {\n          case 0:\n            _context12.next = 2;\n            return getUnlimitedKeyAccount(signer, ethAddress);\n          case 2:\n            _yield$getUnlimitedKe2 = _context12.sent;\n            account = _yield$getUnlimitedKe2.account;\n            accountId = _yield$getUnlimitedKe2.accountId;\n            contractPath = window === null || window === void 0 ? void 0 : window.contractPath;\n            _context12.next = 8;\n            return fetch(contractPath).then(function (res) {\n              return res.arrayBuffer();\n            });\n          case 8:\n            ab = _context12.sent;\n            contractBytes = new Uint8Array(ab);\n            actions = [{\n              type: \"DeployContract\",\n              code: buf2hex(contractBytes)\n            }];\n            _context12.t0 = parseInt;\n            _context12.next = 14;\n            return account.viewFunction(accountId, \"get_nonce\");\n          case 14:\n            _context12.t1 = _context12.sent;\n            nonce = (0, _context12.t0)(_context12.t1, 16).toString();\n            _context12.next = 18;\n            return ethSignJson(signer, {\n              nonce: nonce,\n              receivers: [accountId],\n              transactions: [{\n                actions: actions\n              }]\n            });\n          case 18:\n            args = _context12.sent;\n            _context12.next = 21;\n            return account.functionCall({\n              contractId: accountId,\n              methodName: \"execute\",\n              args: args,\n              gas: gas\n            });\n          case 21:\n            res = _context12.sent;\n            if (!(((_g = res === null || res === void 0 ? void 0 : res.status) === null || _g === void 0 ? void 0 : _g.SuccessValue) !== \"\")) {\n              _context12.next = 24;\n              break;\n            }\n            return _context12.abrupt(\"return\", logger.log(\"Redeply contract unsuccessful. \".concat(REFRESH_MSG)));\n          case 24:\n          case \"end\":\n            return _context12.stop();\n        }\n      }\n    }, _callee12);\n  }));\n}; /// account disconnecting flow\n\nvar handleDisconnect = function handleDisconnect(signer, ethAddress) {\n  return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee13() {\n    var _h, _j, _yield$getUnlimitedKe3, account, accountId, secretKey, _generateSeedPhrase, seedPhrase, publicKey, newSecretKey, _seedPhrase, oldUnlimitedKey, actions, accessKeys, appKeyNonce, _yield$keyPairFromEth5, oldPublicKey, oldPublicKeyHex, nonce, args, res, mapRes;\n    return _regeneratorRuntime().wrap(function _callee13$(_context13) {\n      while (1) {\n        switch (_context13.prev = _context13.next) {\n          case 0:\n            _context13.next = 2;\n            return getUnlimitedKeyAccount(signer, ethAddress);\n          case 2:\n            _yield$getUnlimitedKe3 = _context13.sent;\n            account = _yield$getUnlimitedKe3.account;\n            accountId = _yield$getUnlimitedKe3.accountId;\n            secretKey = _yield$getUnlimitedKe3.secretKey;\n            _generateSeedPhrase = generateSeedPhrase(), seedPhrase = _generateSeedPhrase.seedPhrase, publicKey = _generateSeedPhrase.publicKey, newSecretKey = _generateSeedPhrase.secretKey;\n            _seedPhrase = window.prompt(\"Copy this down and keep it safe!!! This is your new seed phrase!!!\", seedPhrase);\n            if (!(seedPhrase !== _seedPhrase)) {\n              _context13.next = 10;\n              break;\n            }\n            return _context13.abrupt(\"return\", alert(\"There was an error copying seed phrase. Nothing has been done. Please try again.\"));\n          case 10:\n            oldUnlimitedKey = KeyPair.fromString(secretKey);\n            actions = [{\n              type: \"DeleteKey\",\n              public_key: pub2hex(oldUnlimitedKey.getPublicKey().toString())\n            }, {\n              type: \"AddKey\",\n              public_key: pub2hex(publicKey),\n              // special case will add full access key\n              allowance: \"0\"\n            }, {\n              type: \"FunctionCall\",\n              method_name: \"remove_storage\",\n              args: \"\",\n              amount: \"0\",\n              gas: halfGas\n            }, {\n              type: \"DeployContract\",\n              code: \"\"\n            }]; /// check keys, find old app key, delete that first\n            _context13.next = 14;\n            return account.getAccessKeys();\n          case 14:\n            accessKeys = _context13.sent;\n            if (!accessKeys.some(function (k) {\n              var _a, _b;\n              var functionCallPermission = (_b = (_a = k === null || k === void 0 ? void 0 : k.access_key) === null || _a === void 0 ? void 0 : _a.permission) === null || _b === void 0 ? void 0 : _b.FunctionCall;\n              return (functionCallPermission === null || functionCallPermission === void 0 ? void 0 : functionCallPermission.allowance) !== null && (functionCallPermission === null || functionCallPermission === void 0 ? void 0 : functionCallPermission.method_names[0]) === \"execute\";\n            })) {\n              _context13.next = 27;\n              break;\n            }\n            _context13.t0 = parseInt;\n            _context13.next = 19;\n            return account.viewFunction(accountId, \"get_app_key_nonce\");\n          case 19:\n            _context13.t1 = _context13.sent;\n            appKeyNonce = (0, _context13.t0)(_context13.t1, 16).toString();\n            _context13.next = 23;\n            return keyPairFromEthSig(signer, appKeyPayload(accountId, appKeyNonce));\n          case 23:\n            _yield$keyPairFromEth5 = _context13.sent;\n            oldPublicKey = _yield$keyPairFromEth5.publicKey;\n            oldPublicKeyHex = pub2hex(oldPublicKey);\n            actions.unshift({\n              type: \"DeleteKey\",\n              public_key: oldPublicKeyHex\n            });\n          case 27:\n            _context13.t2 = parseInt;\n            _context13.next = 30;\n            return account.viewFunction(accountId, \"get_nonce\");\n          case 30:\n            _context13.t3 = _context13.sent;\n            nonce = (0, _context13.t2)(_context13.t3, 16).toString();\n            _context13.next = 34;\n            return ethSignJson(signer, {\n              nonce: nonce,\n              receivers: [accountId],\n              transactions: [{\n                actions: actions\n              }]\n            });\n          case 34:\n            args = _context13.sent;\n            _context13.next = 37;\n            return account.functionCall({\n              contractId: accountId,\n              methodName: \"execute\",\n              args: args,\n              gas: gas\n            });\n          case 37:\n            res = _context13.sent;\n            if (!(((_h = res === null || res === void 0 ? void 0 : res.status) === null || _h === void 0 ? void 0 : _h.SuccessValue) !== \"\")) {\n              _context13.next = 40;\n              break;\n            }\n            return _context13.abrupt(\"return\", logger.log(\"app key rotation unsuccessful\"));\n          case 40:\n            // remove the mapping (can do this later if user has FAK)\n\n            keyStore.setKey(networkId, accountId, newSecretKey);\n            _context13.prev = 41;\n            _context13.next = 44;\n            return account.functionCall({\n              contractId: NETWORK[networkId].MAP_ACCOUNT_ID,\n              methodName: \"del\",\n              args: {},\n              gas: gas\n            });\n          case 44:\n            mapRes = _context13.sent;\n            logger.log(mapRes);\n            if (((_j = mapRes === null || mapRes === void 0 ? void 0 : mapRes.status) === null || _j === void 0 ? void 0 : _j.SuccessValue) !== \"\") {\n              logger.log(\"account mapping removal failed\");\n            }\n            _context13.next = 52;\n            break;\n          case 49:\n            _context13.prev = 49;\n            _context13.t4 = _context13[\"catch\"](41);\n            logger.log(_context13.t4);\n          case 52:\n            return _context13.abrupt(\"return\", {\n              account: account\n            });\n          case 53:\n          case \"end\":\n            return _context13.stop();\n        }\n      }\n    }, _callee13, null, [[41, 49]]);\n  }));\n}; /// helpers for account creation and connection domain\n\nvar setupFromStorage = function setupFromStorage() {\n  var accountId = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : \"\";\n  return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee14() {\n    var newAccountId, newSecretKey, ethAddress, account, keyPair;\n    return _regeneratorRuntime().wrap(function _callee14$(_context14) {\n      while (1) {\n        switch (_context14.prev = _context14.next) {\n          case 0:\n            if (!(accountId.length > 0)) {\n              _context14.next = 4;\n              break;\n            }\n            _context14.t0 = accountId;\n            _context14.next = 7;\n            break;\n          case 4:\n            _context14.next = 6;\n            return storage.getItem(ATTEMPT_ACCOUNT_ID);\n          case 6:\n            _context14.t0 = _context14.sent;\n          case 7:\n            newAccountId = _context14.t0;\n            _context14.next = 10;\n            return storage.getItem(ATTEMPT_SECRET_KEY);\n          case 10:\n            newSecretKey = _context14.sent;\n            _context14.next = 13;\n            return storage.getItem(ATTEMPT_ETH_ADDRESS);\n          case 13:\n            ethAddress = _context14.sent;\n            account = new Account(connection, newAccountId);\n            if (newSecretKey) {\n              keyPair = KeyPair.fromString(newSecretKey);\n              keyStore.setKey(networkId, newAccountId, keyPair);\n            }\n            return _context14.abrupt(\"return\", {\n              newAccountId: newAccountId,\n              newSecretKey: newSecretKey,\n              ethAddress: ethAddress,\n              account: account,\n              keyPair: keyPair\n            });\n          case 17:\n          case \"end\":\n            return _context14.stop();\n        }\n      }\n    }, _callee14);\n  }));\n};\nvar getUnlimitedKeyAccount = function getUnlimitedKeyAccount(signer, ethAddress) {\n  var tryPrevUrl = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n  return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee15() {\n    var accountId, secretKey, _yield$keyPairFromEth6, _secretKey, account, keyPair, publicKey, accessKeys;\n    return _regeneratorRuntime().wrap(function _callee15$(_context15) {\n      while (1) {\n        switch (_context15.prev = _context15.next) {\n          case 0:\n            _context15.next = 2;\n            return storage.getItem(ATTEMPT_SECRET_KEY);\n          case 2:\n            secretKey = _context15.sent;\n            if (secretKey) {\n              _context15.next = 14;\n              break;\n            }\n            _context15.next = 6;\n            return getNearMap(ethAddress);\n          case 6:\n            accountId = _context15.sent;\n            _context15.next = 9;\n            return keyPairFromEthSig(signer, unlimitedKeyPayload(accountId, tryPrevUrl));\n          case 9:\n            _yield$keyPairFromEth6 = _context15.sent;\n            _secretKey = _yield$keyPairFromEth6.secretKey;\n            secretKey = _secretKey;\n            _context15.next = 17;\n            break;\n          case 14:\n            _context15.next = 16;\n            return storage.getItem(ATTEMPT_ACCOUNT_ID);\n          case 16:\n            accountId = _context15.sent;\n          case 17:\n            account = new Account(connection, accountId);\n            keyPair = KeyPair.fromString(secretKey);\n            publicKey = keyPair.getPublicKey().toString(); /// check if access key matches\n            _context15.next = 22;\n            return account.getAccessKeys();\n          case 22:\n            accessKeys = _context15.sent;\n            if (accessKeys.some(function (_ref4) {\n              var public_key = _ref4.public_key;\n              return publicKey === public_key;\n            })) {\n              _context15.next = 27;\n              break;\n            }\n            _context15.next = 26;\n            return getUnlimitedKeyAccount(signer, ethAddress, true);\n          case 26:\n            return _context15.abrupt(\"return\", _context15.sent);\n          case 27:\n            keyStore.setKey(networkId, accountId, keyPair);\n            return _context15.abrupt(\"return\", {\n              account: account,\n              accountId: accountId,\n              secretKey: secretKey\n            });\n          case 29:\n          case \"end\":\n            return _context15.stop();\n        }\n      }\n    }, _callee15);\n  }));\n};\n/**\r\n * The access key payloads, unlimited and limited\r\n */\n\nvar appKeyPayload = function appKeyPayload(accountId, appKeyNonce) {\n  return {\n    WARNING: \"Creating key for: \".concat(accountId),\n    nonce: appKeyNonce,\n    description: \"ONLY sign this on apps you trust! This key CAN use up to 1 N for transactions.\"\n  };\n};\nvar unlimitedKeyPayload = function unlimitedKeyPayload(accountId, tryPrevUrl) {\n  return {\n    WARNING: \"Creates a key with access to your (new) paired NEAR Account: \".concat(accountId),\n    description: \"ONLY sign this message on this website: \".concat(tryPrevUrl ? PREV_NETH_SITE_URL : NETH_SITE_URL)\n  };\n};\nvar fundingKeyPayload = function fundingKeyPayload() {\n  return {\n    WARNING: \"This creates a full access key in your localStorage to a funding account you will be sending NEAR to.\",\n    description: \"ONLY sign this message on this website: \".concat(NETH_SITE_URL)\n  };\n};\n/**\r\n * main domain, types and eth signTypedData method\r\n */\n\nvar domain = {\n  name: \"NETH\",\n  version: \"1\",\n  // chainId: 1, // aurora\n  chainId: 1313161554 // aurora\n};\n\nvar HEADER_OFFSET = \"NETH\";\nvar HEADER_PAD = 8;\nvar RECEIVER_MARKER = \"|~-_NETH~-_-~RECEIVER_-~|\";\nvar PREFIX = \"|NETH_\";\nvar SUFFIX = \"_NETH|\";\nvar pack = function pack(elements) {\n  return elements.map(function (el) {\n    var str = typeof el === \"string\" ? el : Object.entries(el).map(function (_ref5) {\n      var _ref6 = _slicedToArray(_ref5, 2),\n        k = _ref6[0],\n        v = _ref6[1];\n      return \"\".concat(PREFIX).concat(k, \":\").concat(typeof v === \"string\" ? v : JSON.stringify(v)).concat(SUFFIX);\n    }).join(\"\");\n    var len = str.length.toString().padStart(HEADER_PAD, \"0\");\n    return HEADER_OFFSET + len + \"__\" + str;\n  }).join(\"\");\n};\nvar ethSignJson = function ethSignJson(signer, json) {\n  return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee16() {\n    var Transaction, types, numReceivers, sig, args;\n    return _regeneratorRuntime().wrap(function _callee16$(_context16) {\n      while (1) {\n        switch (_context16.prev = _context16.next) {\n          case 0:\n            Transaction = [];\n            types = {\n              Transaction: Transaction\n            };\n            Object.entries(json).forEach(function (_ref7) {\n              var _ref8 = _slicedToArray(_ref7, 1),\n                k = _ref8[0];\n              types.Transaction.push({\n                type: \"string\",\n                name: k\n              });\n            }); /// convenience for devs so they can pass in JSON\n            /// hoist any functionCall args containing receiver|account in their key to top level receivers\n            /// replaces value with marker, contract fills in marker\n\n            if (json.transactions) {\n              Object.values(json.transactions).forEach(function (tx, i) {\n                tx.actions.forEach(function (action) {\n                  if (!action.args) {\n                    return;\n                  }\n                  if (Buffer.isBuffer(action.args)) {\n                    action.args = \"0x\" + action.args.toString(\"hex\");\n                    return;\n                  }\n                  Object.entries(action.args).forEach(function (_ref9) {\n                    var _ref10 = _slicedToArray(_ref9, 2),\n                      key = _ref10[0],\n                      value = _ref10[1];\n                    /// TODO include check on value to determine valid account_id to be replaced\n                    if (/receiver_id|account_id/g.test(key)) {\n                      action.args[key] = RECEIVER_MARKER;\n                      json.receivers.splice(i + 1, 0, value);\n                    }\n                  });\n                });\n              });\n              json.transactions = pack(json.transactions.map(function (_ref11) {\n                var actions = _ref11.actions;\n                return pack(actions);\n              }));\n            }\n            if (json.receivers) {\n              numReceivers = json.receivers.length.toString();\n              json.receivers = HEADER_OFFSET + json.receivers.join(\",\").length.toString().padStart(HEADER_PAD, \"0\") + \"__\" + json.receivers.join(\",\");\n              json.receivers = json.receivers.substring(0, 4) + numReceivers.padStart(3, \"0\") + json.receivers.substring(7);\n            }\n            _context16.next = 7;\n            return signer._signTypedData(domain, types, json);\n          case 7:\n            sig = _context16.sent;\n            args = {\n              sig: sig,\n              msg: json\n            }; // logger.log('\\nargs\\n', JSON.stringify(args, null, 4), '\\n');\n            return _context16.abrupt(\"return\", args);\n          case 10:\n          case \"end\":\n            return _context16.stop();\n        }\n      }\n    }, _callee16);\n  }));\n};\nvar keyPairFromEthSig = function keyPairFromEthSig(signer, json) {\n  return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee17() {\n    var _yield$ethSignJson, sig, sigHash;\n    return _regeneratorRuntime().wrap(function _callee17$(_context17) {\n      while (1) {\n        switch (_context17.prev = _context17.next) {\n          case 0:\n            _context17.next = 2;\n            return ethSignJson(signer, json);\n          case 2:\n            _yield$ethSignJson = _context17.sent;\n            sig = _yield$ethSignJson.sig;\n            sigHash = ethers.utils.id(sig); /// use 32 bytes of entropy from hash of signature to create NEAR keyPair\n            return _context17.abrupt(\"return\", generateSeedPhrase(sigHash.substring(2, 34)));\n          case 6:\n          case \"end\":\n            return _context17.stop();\n        }\n      }\n    }, _callee17);\n  }));\n};\n/**\r\n * Used by apps to signIn and signAndSendTransactions\r\n */\n/// ethereum\n\nvar getEthereum = function getEthereum() {\n  return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee18() {\n    var _k, _l, provider, code, ethersProvider, accounts, signer;\n    return _regeneratorRuntime().wrap(function _callee18$(_context18) {\n      while (1) {\n        switch (_context18.prev = _context18.next) {\n          case 0:\n            _context18.next = 2;\n            return detectEthereumProvider();\n          case 2:\n            provider = _context18.sent;\n            if (provider) {\n              _context18.next = 5;\n              break;\n            }\n            return _context18.abrupt(\"return\", alert(\"Please install/activate MetaMask and try again.\"));\n          case 5:\n            _context18.prev = 5;\n            _context18.next = 8;\n            return window.ethereum.request({\n              method: \"wallet_switchEthereumChain\",\n              params: [{\n                chainId: \"0x\" + domain.chainId.toString(16)\n              }]\n            });\n          case 8:\n            _context18.next = 25;\n            break;\n          case 10:\n            _context18.prev = 10;\n            _context18.t0 = _context18[\"catch\"](5);\n            logger.log(_context18.t0);\n            code = (_context18.t0 === null || _context18.t0 === void 0 ? void 0 : _context18.t0.code) || ((_l = (_k = _context18.t0 === null || _context18.t0 === void 0 ? void 0 : _context18.t0.data) === null || _k === void 0 ? void 0 : _k.originalError) === null || _l === void 0 ? void 0 : _l.code);\n            if (!(code !== 4902)) {\n              _context18.next = 16;\n              break;\n            }\n            throw _context18.t0;\n          case 16:\n            _context18.prev = 16;\n            _context18.next = 19;\n            return window.ethereum.request({\n              method: \"wallet_addEthereumChain\",\n              params: [{\n                chainId: \"0x\" + domain.chainId.toString(16),\n                chainName: \"Aurora Mainnet\",\n                nativeCurrency: {\n                  name: \"Ethereum\",\n                  symbol: \"ETH\",\n                  decimals: 18\n                },\n                blockExplorerUrls: [\"https://explorer.mainnet.aurora.dev/\"],\n                rpcUrls: [\"https://mainnet.aurora.dev\"]\n              }]\n            });\n          case 19:\n            _context18.next = 25;\n            break;\n          case 21:\n            _context18.prev = 21;\n            _context18.t1 = _context18[\"catch\"](16);\n            alert('Error adding chain. Please click \"Choose Ethereum Account\" and add the Aurora Network to continue.');\n            throw _context18.t1;\n          case 25:\n            ethersProvider = new ethers.providers.Web3Provider(window.ethereum);\n            _context18.next = 28;\n            return ethersProvider.listAccounts();\n          case 28:\n            accounts = _context18.sent;\n            if (!(accounts.length === 0)) {\n              _context18.next = 32;\n              break;\n            }\n            _context18.next = 32;\n            return ethersProvider.send(\"eth_requestAccounts\", []);\n          case 32:\n            signer = ethersProvider.getSigner();\n            _context18.t2 = signer;\n            _context18.next = 36;\n            return signer.getAddress();\n          case 36:\n            _context18.t3 = _context18.sent;\n            return _context18.abrupt(\"return\", {\n              signer: _context18.t2,\n              ethAddress: _context18.t3\n            });\n          case 38:\n          case \"end\":\n            return _context18.stop();\n        }\n      }\n    }, _callee18, null, [[5, 10], [16, 21]]);\n  }));\n};\nvar switchEthereum = function switchEthereum() {\n  return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee19() {\n    var provider, ethersProvider, signer;\n    return _regeneratorRuntime().wrap(function _callee19$(_context19) {\n      while (1) {\n        switch (_context19.prev = _context19.next) {\n          case 0:\n            _context19.next = 2;\n            return detectEthereumProvider();\n          case 2:\n            provider = _context19.sent;\n            _context19.next = 5;\n            return provider.send(\"wallet_requestPermissions\", [{\n              eth_accounts: {}\n            }]);\n          case 5:\n            ethersProvider = new ethers.providers.Web3Provider(window.ethereum);\n            signer = ethersProvider.getSigner();\n            _context19.t0 = signer;\n            _context19.next = 10;\n            return signer.getAddress();\n          case 10:\n            _context19.t1 = _context19.sent;\n            return _context19.abrupt(\"return\", {\n              signer: _context19.t0,\n              ethAddress: _context19.t1\n            });\n          case 12:\n          case \"end\":\n            return _context19.stop();\n        }\n      }\n    }, _callee19);\n  }));\n}; /// near\n\nvar getNearMap = function getNearMap(eth_address) {\n  return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee20() {\n    return _regeneratorRuntime().wrap(function _callee20$(_context20) {\n      while (1) {\n        switch (_context20.prev = _context20.next) {\n          case 0:\n            return _context20.abrupt(\"return\", contractAccount.viewFunction(NETWORK[networkId].MAP_ACCOUNT_ID, \"get_near\", {\n              eth_address: eth_address\n            }));\n          case 1:\n          case \"end\":\n            return _context20.stop();\n        }\n      }\n    }, _callee20);\n  }));\n};\nvar getNear = function getNear() {\n  return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee21() {\n    var secretKey, accountId, ethRes, res, account, keyPair;\n    return _regeneratorRuntime().wrap(function _callee21$(_context21) {\n      while (1) {\n        switch (_context21.prev = _context21.next) {\n          case 0:\n            _context21.next = 2;\n            return storage.getItem(APP_KEY_SECRET);\n          case 2:\n            secretKey = _context21.sent;\n            _context21.next = 5;\n            return storage.getItem(APP_KEY_ACCOUNT_ID);\n          case 5:\n            accountId = _context21.sent;\n            if (!(!secretKey || !accountId)) {\n              _context21.next = 18;\n              break;\n            }\n            _context21.next = 9;\n            return getEthereum();\n          case 9:\n            ethRes = _context21.sent;\n            _context21.next = 12;\n            return getAppKey(ethRes);\n          case 12:\n            res = _context21.sent;\n            if (res) {\n              _context21.next = 15;\n              break;\n            }\n            return _context21.abrupt(\"return\", false);\n          case 15:\n            _context21.next = 17;\n            return getNear();\n          case 17:\n            return _context21.abrupt(\"return\", _context21.sent);\n          case 18:\n            account = new Account(connection, accountId);\n            keyPair = KeyPair.fromString(secretKey);\n            keyStore.setKey(networkId, accountId, keyPair);\n            return _context21.abrupt(\"return\", {\n              account: account,\n              accountId: accountId,\n              keyPair: keyPair,\n              secretKey: secretKey\n            });\n          case 22:\n          case \"end\":\n            return _context21.stop();\n        }\n      }\n    }, _callee21);\n  }));\n};\nvar _signIn = getNear;\nvar _signOut = function signOut() {\n  return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee22() {\n    var accountId;\n    return _regeneratorRuntime().wrap(function _callee22$(_context22) {\n      while (1) {\n        switch (_context22.prev = _context22.next) {\n          case 0:\n            _context22.next = 2;\n            return storage.getItem(APP_KEY_ACCOUNT_ID);\n          case 2:\n            accountId = _context22.sent;\n            if (accountId) {\n              _context22.next = 5;\n              break;\n            }\n            return _context22.abrupt(\"return\", logger.log(\"already signed out\"));\n          case 5:\n            _context22.next = 7;\n            return storage.removeItem(APP_KEY_SECRET);\n          case 7:\n            _context22.next = 9;\n            return storage.removeItem(APP_KEY_ACCOUNT_ID);\n          case 9:\n            return _context22.abrupt(\"return\", {\n              accountId: accountId\n            });\n          case 10:\n          case \"end\":\n            return _context22.stop();\n        }\n      }\n    }, _callee22);\n  }));\n};\nvar _verifyOwner = function verifyOwner(_ref12) {\n  var message = _ref12.message,\n    provider = _ref12.provider,\n    account = _ref12.account;\n  return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee23() {\n    var accountId, _yield$getNear, _account, pubKey, publicKey, block, blockId, data, encoded, signed;\n    return _regeneratorRuntime().wrap(function _callee23$(_context23) {\n      while (1) {\n        switch (_context23.prev = _context23.next) {\n          case 0:\n            if (account) {\n              _context23.next = 8;\n              break;\n            }\n            _context23.next = 3;\n            return getNear();\n          case 3:\n            _yield$getNear = _context23.sent;\n            account = _yield$getNear.account;\n            accountId = _yield$getNear.accountId;\n            _context23.next = 10;\n            break;\n          case 8:\n            _account = account;\n            accountId = _account.accountId;\n          case 10:\n            if (account) {\n              _context23.next = 12;\n              break;\n            }\n            throw new Error(\"Wallet not signed in\");\n          case 12:\n            _context23.next = 14;\n            return account.connection.signer.getPublicKey(accountId, networkId);\n          case 14:\n            pubKey = _context23.sent;\n            publicKey = Buffer.from(pubKey.data).toString(\"base64\");\n            _context23.next = 18;\n            return provider.block({\n              finality: \"final\"\n            });\n          case 18:\n            block = _context23.sent;\n            blockId = block.header.hash;\n            data = {\n              accountId: accountId,\n              message: message,\n              blockId: blockId,\n              publicKey: publicKey,\n              keyType: pubKey.keyType\n            };\n            encoded = JSON.stringify(data);\n            _context23.next = 24;\n            return account.connection.signer.signMessage(new Uint8Array(Buffer.from(encoded)), accountId, networkId);\n          case 24:\n            signed = _context23.sent;\n            return _context23.abrupt(\"return\", Object.assign(Object.assign({}, data), {\n              signature: Buffer.from(signed.signature).toString(\"base64\")\n            }));\n          case 26:\n          case \"end\":\n            return _context23.stop();\n        }\n      }\n    }, _callee23);\n  }));\n};\nvar isSignedIn = function isSignedIn() {\n  return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee24() {\n    var tempStorage;\n    return _regeneratorRuntime().wrap(function _callee24$(_context24) {\n      while (1) {\n        switch (_context24.prev = _context24.next) {\n          case 0:\n            /// init defaultStorage here because it's not initialized until initConnection\n            tempStorage = defaultStorage(WS_STORAGE_NAMESPACE);\n            _context24.next = 3;\n            return tempStorage.getItem(APP_KEY_SECRET);\n          case 3:\n            _context24.t0 = !!_context24.sent;\n            if (_context24.t0) {\n              _context24.next = 8;\n              break;\n            }\n            _context24.next = 7;\n            return tempStorage.getItem(APP_KEY_ACCOUNT_ID);\n          case 7:\n            _context24.t0 = !!_context24.sent;\n          case 8:\n            return _context24.abrupt(\"return\", _context24.t0);\n          case 9:\n          case \"end\":\n            return _context24.stop();\n        }\n      }\n    }, _callee24);\n  }));\n}; // const promptValidAccountId = async (msg) => {\n//   const newAccountId = window.prompt(msg);\n//   if (!newAccountId) {\n//     throw new Error(\"NETH Error: failed to pick valid NEAR account name\");\n//   }\n//   if (\n//     newAccountId.length < 2 ||\n//     newAccountId.indexOf(\".\") > -1 ||\n//     !ACCOUNT_REGEX.test(newAccountId) ||\n//     newAccountId.length > 64\n//   ) {\n//     return promptValidAccountId(\n//       `account is invalid (a-z, 0-9 and -,_ only; min 2; max 64; ${accountSuffix} applied automatically)`\n//     );\n//   }\n//   if (await accountExists(newAccountId)) {\n//     return promptValidAccountId(`account already exists`);\n//   }\n//   return newAccountId;\n// };\n\nvar getAppKey = function getAppKey(_ref13) {\n  var signer = _ref13.signer,\n    eth_address = _ref13.ethAddress;\n  return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee25() {\n    var accountId, tryAgain, _yield$switchEthereum, _signer, ethAddress, nethURL, appKeyNonce, _yield$keyPairFromEth7, publicKey, secretKey, account, accessKeys, keyPair;\n    return _regeneratorRuntime().wrap(function _callee25$(_context25) {\n      while (1) {\n        switch (_context25.prev = _context25.next) {\n          case 0:\n            _context25.next = 2;\n            return getNearMap(eth_address);\n          case 2:\n            accountId = _context25.sent;\n            if (accountId) {\n              _context25.next = 23;\n              break;\n            }\n            tryAgain = window.confirm(\"Ethereum account \".concat(eth_address, \" is not connected to a NETH account. Would you like to try another Ethereum account?\"));\n            if (!tryAgain) {\n              _context25.next = 21;\n              break;\n            }\n            _context25.prev = 6;\n            _context25.next = 9;\n            return switchEthereum();\n          case 9:\n            _yield$switchEthereum = _context25.sent;\n            _signer = _yield$switchEthereum.signer;\n            ethAddress = _yield$switchEthereum.ethAddress;\n            _context25.next = 14;\n            return getAppKey({\n              signer: _signer,\n              ethAddress: ethAddress\n            });\n          case 14:\n            return _context25.abrupt(\"return\", _context25.sent);\n          case 17:\n            _context25.prev = 17;\n            _context25.t0 = _context25[\"catch\"](6);\n            logger.log(_context25.t0);\n          case 20:\n            return _context25.abrupt(\"return\");\n          case 21:\n            nethURL = \"\".concat(NETH_SITE_URL, \"/\").concat(networkId === \"testnet\" ? \"?network=testnet\" : \"\");\n            window.prompt(\"We couldn't find a NETH account. To set up a NETH account visit\", nethURL); // throw new Error(`Ethereum account is not connected to a NETH account. To set up a NETH account visit: ${nethURL}`)\n            // /// prompt for near account name and auto deploy\n            // const newAccountId = await promptValidAccountId(\n            // \t`The Ethereum address ${eth_address} is not connected to a NEAR account yet. Select a NEAR account name and we'll create and connect one for you.`,\n            // );\n            // const { account } = await handleCreate(signer, eth_address, newAccountId + accountSuffix);\n            // accountId = account.accountId;\n          case 23:\n            _context25.t1 = parseInt;\n            _context25.next = 26;\n            return contractAccount.viewFunction(accountId, \"get_app_key_nonce\");\n          case 26:\n            _context25.t2 = _context25.sent;\n            appKeyNonce = (0, _context25.t1)(_context25.t2, 16).toString();\n            _context25.next = 30;\n            return keyPairFromEthSig(signer, appKeyPayload(accountId, appKeyNonce));\n          case 30:\n            _yield$keyPairFromEth7 = _context25.sent;\n            publicKey = _yield$keyPairFromEth7.publicKey;\n            secretKey = _yield$keyPairFromEth7.secretKey;\n            account = new Account(connection, accountId); // check that app key exists on account\n            _context25.next = 36;\n            return account.getAccessKeys();\n          case 36:\n            accessKeys = _context25.sent;\n            if (hasAppKey(accessKeys)) {\n              _context25.next = 40;\n              break;\n            }\n            _context25.next = 40;\n            return handleRefreshAppKey(signer, eth_address);\n          case 40:\n            keyPair = KeyPair.fromString(secretKey);\n            keyStore.setKey(networkId, accountId, keyPair);\n            _context25.next = 44;\n            return storage.setItem(APP_KEY_SECRET, secretKey);\n          case 44:\n            _context25.next = 46;\n            return storage.setItem(APP_KEY_ACCOUNT_ID, account.accountId);\n          case 46:\n            return _context25.abrupt(\"return\", {\n              publicKey: publicKey,\n              secretKey: secretKey,\n              account: account\n            });\n          case 47:\n          case \"end\":\n            return _context25.stop();\n        }\n      }\n    }, _callee25, null, [[6, 17]]);\n  }));\n};\nvar broadcastTXs = function broadcastTXs() {\n  return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee26() {\n    var _yield$getNear2, account, accountId, args, res, currentArgs, tx;\n    return _regeneratorRuntime().wrap(function _callee26$(_context26) {\n      while (1) {\n        switch (_context26.prev = _context26.next) {\n          case 0:\n            _context26.next = 2;\n            return getNear();\n          case 2:\n            _yield$getNear2 = _context26.sent;\n            account = _yield$getNear2.account;\n            accountId = _yield$getNear2.accountId;\n            _context26.next = 7;\n            return storage.getItem(TX_ARGS_ATTEMPT);\n          case 7:\n            args = _context26.sent;\n            if (!(!args || args.length === 0)) {\n              _context26.next = 10;\n              break;\n            }\n            return _context26.abrupt(\"return\");\n          case 10:\n            res = [];\n          case 11:\n            if (!(args.length > 0)) {\n              _context26.next = 28;\n              break;\n            }\n            currentArgs = args.shift();\n            logger.log(\"NETH: broadcasting tx\", currentArgs);\n            _context26.prev = 14;\n            _context26.next = 17;\n            return account.functionCall({\n              contractId: accountId,\n              methodName: \"execute\",\n              args: currentArgs,\n              gas: gas\n            });\n          case 17:\n            tx = _context26.sent;\n            _context26.next = 20;\n            return storage.setItem(TX_ARGS_ATTEMPT, args);\n          case 20:\n            res.push(tx);\n            _context26.next = 26;\n            break;\n          case 23:\n            _context26.prev = 23;\n            _context26.t0 = _context26[\"catch\"](14);\n            logger.log(\"NETH: ERROR broadcasting tx\", _context26.t0);\n          case 26:\n            _context26.next = 11;\n            break;\n          case 28:\n            _context26.next = 30;\n            return storage.removeItem(TX_ARGS_ATTEMPT);\n          case 30:\n            return _context26.abrupt(\"return\", res);\n          case 31:\n          case \"end\":\n            return _context26.stop();\n        }\n      }\n    }, _callee26, null, [[14, 23]]);\n  }));\n};\nvar signAndSendTransactions = function signAndSendTransactions(_ref14) {\n  var transactions = _ref14.transactions,\n    bundle = _ref14.bundle;\n  return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee27() {\n    var ethRes, signer, _yield$getNear3, account, accountId, receivers, transformedTxs, nonce, args, i, res;\n    return _regeneratorRuntime().wrap(function _callee27$(_context27) {\n      while (1) {\n        switch (_context27.prev = _context27.next) {\n          case 0:\n            _context27.next = 2;\n            return getEthereum();\n          case 2:\n            ethRes = _context27.sent;\n            signer = ethRes.signer;\n            _context27.next = 6;\n            return getNear();\n          case 6:\n            _yield$getNear3 = _context27.sent;\n            account = _yield$getNear3.account;\n            accountId = _yield$getNear3.accountId;\n            receivers = transactions.map(function (_ref15) {\n              var receiverId = _ref15.receiverId;\n              return receiverId;\n            });\n            transformedTxs = transactions.map(function (_ref16) {\n              var receiverId = _ref16.receiverId,\n                actions = _ref16.actions;\n              return {\n                actions: convertActions(actions, accountId, receiverId)\n              };\n            });\n            _context27.t0 = parseInt;\n            _context27.next = 14;\n            return account.viewFunction(accountId, \"get_nonce\");\n          case 14:\n            _context27.t1 = _context27.sent;\n            nonce = (0, _context27.t0)(_context27.t1, 16);\n            args = [];\n            if (bundle) {\n              _context27.next = 30;\n              break;\n            }\n            i = 0;\n          case 19:\n            if (!(i < transformedTxs.length)) {\n              _context27.next = 28;\n              break;\n            }\n            _context27.t2 = args;\n            _context27.next = 23;\n            return ethSignJson(signer, {\n              nonce: (nonce + i).toString(),\n              receivers: [receivers[i]],\n              transactions: [transformedTxs[i]]\n            });\n          case 23:\n            _context27.t3 = _context27.sent;\n            _context27.t2.push.call(_context27.t2, _context27.t3);\n          case 25:\n            i++;\n            _context27.next = 19;\n            break;\n          case 28:\n            _context27.next = 35;\n            break;\n          case 30:\n            _context27.t4 = args;\n            _context27.next = 33;\n            return ethSignJson(signer, {\n              nonce: nonce.toString(),\n              receivers: receivers,\n              transactions: transformedTxs\n            });\n          case 33:\n            _context27.t5 = _context27.sent;\n            _context27.t4.push.call(_context27.t4, _context27.t5);\n          case 35:\n            _context27.next = 37;\n            return storage.setItem(TX_ARGS_ATTEMPT, args);\n          case 37:\n            _context27.next = 39;\n            return broadcastTXs();\n          case 39:\n            res = _context27.sent;\n            return _context27.abrupt(\"return\", res);\n          case 41:\n          case \"end\":\n            return _context27.stop();\n        }\n      }\n    }, _callee27);\n  }));\n}; /// helpers\n\nvar convertActions = function convertActions(actions, accountId, receiverId) {\n  return actions.map(function (_action) {\n    var type = _action.enum;\n    var _ref17 = _action[type] || _action,\n      _gas = _ref17.gas,\n      publicKey = _ref17.publicKey,\n      methodName = _ref17.methodName,\n      args = _ref17.args,\n      deposit = _ref17.deposit,\n      accessKey = _ref17.accessKey,\n      code = _ref17.code;\n    var action = {\n      type: type && type[0].toUpperCase() + type.substr(1) || \"FunctionCall\",\n      gas: _gas && _gas.toString() || undefined,\n      public_key: publicKey && pub2hex(publicKey) || undefined,\n      method_name: methodName,\n      args: args || undefined,\n      code: code || undefined,\n      amount: deposit && deposit.toString() || undefined,\n      permission: undefined\n    };\n    Object.keys(action).forEach(function (k) {\n      if (action[k] === undefined) {\n        delete action[k];\n      }\n    });\n    if (accessKey) {\n      if (receiverId === accountId) {\n        action.allowance = parseNearAmount(\"1\");\n        action.method_names = \"execute\";\n        action.receiver_id = accountId;\n      } else if (accessKey.permission.enum === \"functionCall\") {\n        var _accessKey$permission = accessKey.permission.functionCall,\n          _receiverId = _accessKey$permission.receiverId,\n          methodNames = _accessKey$permission.methodNames,\n          allowance = _accessKey$permission.allowance;\n        action.receiver_id = _receiverId;\n        action.allowance = allowance && allowance.toString() || parseNearAmount(\"0.25\");\n        action.method_names = methodNames.join(\",\");\n      }\n    }\n    return action;\n  });\n};\nvar isInstalled = function isInstalled() {\n  return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee28() {\n    return _regeneratorRuntime().wrap(function _callee28$(_context28) {\n      while (1) {\n        switch (_context28.prev = _context28.next) {\n          case 0:\n            _context28.next = 2;\n            return detectEthereumProvider();\n          case 2:\n            return _context28.abrupt(\"return\", !!window.ethereum);\n          case 3:\n          case \"end\":\n            return _context28.stop();\n        }\n      }\n    }, _callee28);\n  }));\n};\nvar bundle = true;\nvar useCover = false;\nvar customGas;\nvar Neth = function Neth(_ref18) {\n  var metadata = _ref18.metadata,\n    logger = _ref18.logger,\n    store = _ref18.store,\n    storage = _ref18.storage,\n    options = _ref18.options,\n    provider = _ref18.provider;\n  return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee36() {\n    var cover, isValidActions, transformActions, signTransactions;\n    return _regeneratorRuntime().wrap(function _callee36$(_context36) {\n      while (1) {\n        switch (_context36.prev = _context36.next) {\n          case 0:\n            cover = initConnection({\n              network: options.network,\n              gas: customGas,\n              logger: logger,\n              storage: storage\n            });\n            isValidActions = function isValidActions(actions) {\n              return actions.every(function (x) {\n                return x.type === \"FunctionCall\";\n              });\n            };\n            transformActions = function transformActions(actions) {\n              var validActions = isValidActions(actions);\n              if (!validActions) {\n                throw new Error(\"Only 'FunctionCall' actions types are supported by \".concat(metadata.name));\n              }\n              return actions.map(function (x) {\n                return x.params;\n              });\n            };\n            signTransactions = function signTransactions(transactions) {\n              return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee29() {\n                var _store$getState, contract, transformedTxs, res;\n                return _regeneratorRuntime().wrap(function _callee29$(_context29) {\n                  while (1) {\n                    switch (_context29.prev = _context29.next) {\n                      case 0:\n                        logger.log(\"NETH:signAndSendTransactions\", {\n                          transactions: transactions\n                        });\n                        _store$getState = store.getState(), contract = _store$getState.contract;\n                        _context29.next = 4;\n                        return isSignedIn();\n                      case 4:\n                        _context29.t0 = !_context29.sent;\n                        if (_context29.t0) {\n                          _context29.next = 7;\n                          break;\n                        }\n                        _context29.t0 = !contract;\n                      case 7:\n                        if (!_context29.t0) {\n                          _context29.next = 9;\n                          break;\n                        }\n                        throw new Error(\"Wallet not signed in\");\n                      case 9:\n                        if (useCover) {\n                          cover.style.display = \"block\";\n                        }\n                        transformedTxs = transactions.map(function (_ref19) {\n                          var receiverId = _ref19.receiverId,\n                            actions = _ref19.actions;\n                          return {\n                            receiverId: receiverId || contract.contractId,\n                            actions: transformActions(actions)\n                          };\n                        });\n                        _context29.prev = 11;\n                        _context29.next = 14;\n                        return signAndSendTransactions({\n                          transactions: transformedTxs,\n                          bundle: bundle\n                        });\n                      case 14:\n                        res = _context29.sent;\n                        _context29.next = 21;\n                        break;\n                      case 17:\n                        _context29.prev = 17;\n                        _context29.t1 = _context29[\"catch\"](11);\n                        /// \"user rejected signing\" or near network error\n                        logger.log(\"NETH:signAndSendTransactions Error\", _context29.t1);\n                        throw _context29.t1;\n                      case 21:\n                        if (useCover) {\n                          cover.style.display = \"none\";\n                        }\n                        return _context29.abrupt(\"return\", res);\n                      case 23:\n                      case \"end\":\n                        return _context29.stop();\n                    }\n                  }\n                }, _callee29, null, [[11, 17]]);\n              }));\n            }; // return the wallet interface for wallet-selector\n            return _context36.abrupt(\"return\", {\n              signIn: function signIn() {\n                return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee30() {\n                  var account;\n                  return _regeneratorRuntime().wrap(function _callee30$(_context30) {\n                    while (1) {\n                      switch (_context30.prev = _context30.next) {\n                        case 0:\n                          _context30.prev = 0;\n                          _context30.next = 3;\n                          return _signIn();\n                        case 3:\n                          account = _context30.sent;\n                          if (account) {\n                            _context30.next = 6;\n                            break;\n                          }\n                          return _context30.abrupt(\"return\", []);\n                        case 6:\n                          _context30.next = 12;\n                          break;\n                        case 8:\n                          _context30.prev = 8;\n                          _context30.t0 = _context30[\"catch\"](0);\n                          if (/not connected/.test(_context30.t0.toString())) {\n                            _context30.next = 12;\n                            break;\n                          }\n                          throw _context30.t0;\n                        case 12:\n                          return _context30.abrupt(\"return\", [account]);\n                        case 13:\n                        case \"end\":\n                          return _context30.stop();\n                      }\n                    }\n                  }, _callee30, null, [[0, 8]]);\n                }));\n              },\n              signOut: function signOut() {\n                return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee31() {\n                  return _regeneratorRuntime().wrap(function _callee31$(_context31) {\n                    while (1) {\n                      switch (_context31.prev = _context31.next) {\n                        case 0:\n                          _context31.next = 2;\n                          return _signOut();\n                        case 2:\n                        case \"end\":\n                          return _context31.stop();\n                      }\n                    }\n                  }, _callee31);\n                }));\n              },\n              verifyOwner: function verifyOwner(_ref20) {\n                var message = _ref20.message;\n                return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee32() {\n                  return _regeneratorRuntime().wrap(function _callee32$(_context32) {\n                    while (1) {\n                      switch (_context32.prev = _context32.next) {\n                        case 0:\n                          logger.log(\"NETH:verifyOwner\", {\n                            message: message\n                          });\n                          return _context32.abrupt(\"return\", _verifyOwner({\n                            message: message,\n                            provider: provider,\n                            account: null\n                          }));\n                        case 2:\n                        case \"end\":\n                          return _context32.stop();\n                      }\n                    }\n                  }, _callee32);\n                }));\n              },\n              getAccounts: function getAccounts() {\n                return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee33() {\n                  var _yield$getNear4, accountId;\n                  return _regeneratorRuntime().wrap(function _callee33$(_context33) {\n                    while (1) {\n                      switch (_context33.prev = _context33.next) {\n                        case 0:\n                          _context33.next = 2;\n                          return getNear();\n                        case 2:\n                          _yield$getNear4 = _context33.sent;\n                          accountId = _yield$getNear4.accountId;\n                          return _context33.abrupt(\"return\", [{\n                            accountId: accountId\n                          }]);\n                        case 5:\n                        case \"end\":\n                          return _context33.stop();\n                      }\n                    }\n                  }, _callee33);\n                }));\n              },\n              signAndSendTransaction: function signAndSendTransaction(_ref21) {\n                var receiverId = _ref21.receiverId,\n                  actions = _ref21.actions;\n                return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee34() {\n                  return _regeneratorRuntime().wrap(function _callee34$(_context34) {\n                    while (1) {\n                      switch (_context34.prev = _context34.next) {\n                        case 0:\n                          return _context34.abrupt(\"return\", signTransactions([{\n                            receiverId: receiverId,\n                            actions: actions\n                          }]));\n                        case 1:\n                        case \"end\":\n                          return _context34.stop();\n                      }\n                    }\n                  }, _callee34);\n                }));\n              },\n              signAndSendTransactions: function signAndSendTransactions(_ref22) {\n                var transactions = _ref22.transactions;\n                return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee35() {\n                  return _regeneratorRuntime().wrap(function _callee35$(_context35) {\n                    while (1) {\n                      switch (_context35.prev = _context35.next) {\n                        case 0:\n                          return _context35.abrupt(\"return\", signTransactions(transactions));\n                        case 1:\n                        case \"end\":\n                          return _context35.stop();\n                      }\n                    }\n                  }, _callee35);\n                }));\n              }\n            });\n          case 5:\n          case \"end\":\n            return _context36.stop();\n        }\n      }\n    }, _callee36);\n  }));\n};\nfunction setupNeth() {\n  var _this = this;\n  var _ref23 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n    _ref23$iconUrl = _ref23.iconUrl,\n    iconUrl = _ref23$iconUrl === void 0 ? nethIcon : _ref23$iconUrl,\n    gas = _ref23.gas,\n    _ref23$useModalCover = _ref23.useModalCover,\n    useModalCover = _ref23$useModalCover === void 0 ? false : _ref23$useModalCover,\n    _ref23$bundle = _ref23.bundle,\n    _bundle = _ref23$bundle === void 0 ? true : _ref23$bundle,\n    _ref23$deprecated = _ref23.deprecated,\n    deprecated = _ref23$deprecated === void 0 ? false : _ref23$deprecated;\n  return function () {\n    return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee37() {\n      var mobile, installed;\n      return _regeneratorRuntime().wrap(function _callee37$(_context37) {\n        while (1) {\n          switch (_context37.prev = _context37.next) {\n            case 0:\n              useCover = useModalCover;\n              customGas = gas;\n              bundle = _bundle;\n              mobile = isMobile();\n              _context37.next = 6;\n              return isInstalled();\n            case 6:\n              installed = _context37.sent;\n              _context37.next = 9;\n              return waitFor(function () {\n                return !!isSignedIn();\n              }, {\n                timeout: 300\n              }).catch(function () {\n                return false;\n              });\n            case 9:\n              if (!mobile) {\n                _context37.next = 11;\n                break;\n              }\n              return _context37.abrupt(\"return\", null);\n            case 11:\n              return _context37.abrupt(\"return\", {\n                id: \"neth\",\n                type: \"injected\",\n                metadata: {\n                  name: \"NETH Account\",\n                  description: null,\n                  iconUrl: iconUrl,\n                  downloadUrl: NETH_SITE_URL,\n                  deprecated: false,\n                  available: installed\n                },\n                deprecated: deprecated,\n                init: Neth\n              });\n            case 12:\n            case \"end\":\n              return _context37.stop();\n          }\n        }\n      }, _callee37);\n    }));\n  };\n}\nexport { MIN_NEW_ACCOUNT_ASK, accountExists, getConnection, getEthereum, getNear, getNearMap, handleCancelFunding, handleCheckAccount, handleCreate, handleDisconnect, handleRefreshAppKey, handleUpdateContract, hasAppKey, initConnection, isSignedIn, setupNeth, signAndSendTransactions, _signIn as signIn, _signOut as signOut, switchEthereum, _verifyOwner as verifyOwner };","map":{"version":3,"names":["waitFor","detectEthereumProvider","ethers","nearAPI","generateSeedPhrase","BN","isMobile","__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","nethIcon","Near","Account","KeyPair","BrowserLocalStorageKeyStore","keyStores","transactions","addKey","deleteKey","functionCallAccessKey","utils","PublicKey","parseNearAmount","format","NETH_SITE_URL","PREV_NETH_SITE_URL","NETWORK","testnet","FUNDING_ACCOUNT_ID","MAP_ACCOUNT_ID","ROOT_ACCOUNT_ID","mainnet","WS_STORAGE_NAMESPACE","REFRESH_MSG","TX_ARGS_ATTEMPT","ATTEMPT_SECRET_KEY","ATTEMPT_ACCOUNT_ID","ATTEMPT_ETH_ADDRESS","APP_KEY_SECRET","APP_KEY_ACCOUNT_ID","defaultGas","halfGas","MIN_NEW_ACCOUNT","MIN_NEW_ACCOUNT_THRESH","MIN_NEW_ACCOUNT_ASK","FUNDING_CHECK_TIMEOUT","attachedDepositMapping","defaultStorage","prefix","getItem","k","v","localStorage","charAt","JSON","parse","setItem","stringify","removeItem","defaultLogger","log","args","console","near","gas","keyStore","logger","storage","connection","networkId","contractAccount","accountSuffix","initConnection","network","_gas","_logger","_storage","Object","assign","cover","document","createElement","style","display","width","height","zIndex","position","top","background","body","appendChild","broadcastTXs","getConnection","accountExists","accountId","ethAddress","account","state","getNearMap","mapAccountId","test","toString","buf2hex","buf","hexlify","substring","pub2hex","publicKey","fromString","data","handleCreate","signer","newAccountId","fundingAccountCB","fundingErrorCB","postFundingCB","indexOf","alert","keyPairFromEthSig","fundingKeyPayload","fundingAccountPubKey","new_secret_key","secretKey","createAccount","implicitAccountId","Buffer","from","checkImplicitFunded","getAccountBalance","balance","available","diff","sub","lt","abs","r","setTimeout","window","location","reload","setupFromStorage","handleCancelFunding","unlimitedKeyPayload","new_public_key","functionCall","contractId","methodName","new_account_id","attachedDeposit","deleteAccount","handleMapping","fundingAccountId","refundAccountId","prompt","eth_address","handleDeployContract","contractPath","fetch","res","arrayBuffer","ab","contractBytes","Uint8Array","deployContract","handleSetupContract","handleKeys","getAccessKeys","accessKeys","length","_b","_a","access_key","permission","public_key","actions","signAndSendTransaction","receiverId","_c","status","SuccessValue","handleCheckAccount","setup","newSecretKey","keyPair","getPublicKey","viewFunction","account_id","mapRes","code_hash","ethRes","_e","_d","hasAppKey","some","functionCallPermission","FunctionCall","allowance","method_names","handleRefreshAppKey","getUnlimitedKeyAccount","parseInt","nonce","appKeyPayload","type","receiver_id","appKeyNonce","oldPublicKey","oldPublicKeyHex","unshift","ethSignJson","receivers","_f","handleUpdateContract","code","_g","handleDisconnect","seedPhrase","_seedPhrase","oldUnlimitedKey","method_name","amount","_h","setKey","_j","tryPrevUrl","_secretKey","WARNING","description","domain","name","version","chainId","HEADER_OFFSET","HEADER_PAD","RECEIVER_MARKER","PREFIX","SUFFIX","pack","elements","map","el","str","entries","join","len","padStart","json","Transaction","types","forEach","push","values","tx","i","action","isBuffer","key","splice","numReceivers","_signTypedData","sig","msg","sigHash","id","getEthereum","provider","ethereum","request","method","params","_l","_k","originalError","chainName","nativeCurrency","symbol","decimals","blockExplorerUrls","rpcUrls","ethersProvider","providers","Web3Provider","listAccounts","accounts","send","getSigner","getAddress","switchEthereum","eth_accounts","getNear","getAppKey","signIn","signOut","verifyOwner","message","Error","pubKey","block","finality","blockId","header","hash","keyType","encoded","signMessage","signed","signature","isSignedIn","tempStorage","tryAgain","confirm","_signer","nethURL","currentArgs","shift","signAndSendTransactions","bundle","transformedTxs","convertActions","_action","enum","deposit","accessKey","toUpperCase","substr","undefined","keys","_receiverId","methodNames","isInstalled","useCover","customGas","Neth","metadata","store","options","isValidActions","every","x","transformActions","validActions","signTransactions","getState","contract","getAccounts","setupNeth","iconUrl","useModalCover","_bundle","deprecated","mobile","installed","timeout","catch","downloadUrl","init"],"sources":["/Users/sepezho/Work/tonana/fe/node_modules/@near-wallet-selector/neth/index.js"],"sourcesContent":["import { waitFor } from '@near-wallet-selector/core';\nimport detectEthereumProvider from '@metamask/detect-provider';\nimport { ethers } from 'ethers';\nimport * as nearAPI from 'near-api-js';\nimport { generateSeedPhrase } from 'near-seed-phrase';\nimport BN from 'bn.js';\nimport isMobile from 'is-mobile';\n\n/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n\r\nfunction __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\n\nconst nethIcon = `data:image/png;base64,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`;\n\n/*eslint @typescript-eslint/no-use-before-define: 1*/\nconst {\n  Near,\n  Account,\n  KeyPair,\n  keyStores: {\n    BrowserLocalStorageKeyStore\n  },\n  transactions: {\n    addKey,\n    deleteKey,\n    functionCallAccessKey\n  },\n  utils: {\n    PublicKey,\n    format: {\n      parseNearAmount\n    }\n  }\n} = nearAPI;\nconst NETH_SITE_URL = \"https://neth.app\";\nconst PREV_NETH_SITE_URL = \"neardefi.github.io/neth\";\nconst NETWORK = {\n  testnet: {\n    FUNDING_ACCOUNT_ID: \"neth.testnet\",\n    MAP_ACCOUNT_ID: \"map.neth.testnet\",\n    ROOT_ACCOUNT_ID: \"testnet\"\n  },\n  mainnet: {\n    MAP_ACCOUNT_ID: \"nethmap.near\",\n    ROOT_ACCOUNT_ID: \"near\"\n  }\n};\nconst WS_STORAGE_NAMESPACE = \"near-wallet-selector:neth:\";\nconst REFRESH_MSG = `Please refresh the page and try again.`;\nconst TX_ARGS_ATTEMPT = \"__TX_ARGS_ATTEMPT\";\nconst ATTEMPT_SECRET_KEY = \"__ATTEMPT_SECRET_KEY\";\nconst ATTEMPT_ACCOUNT_ID = \"__ATTEMPT_ACCOUNT_ID\";\nconst ATTEMPT_ETH_ADDRESS = \"__ATTEMPT_ETH_ADDRESS\";\nconst APP_KEY_SECRET = \"__APP_KEY_SECRET\";\nconst APP_KEY_ACCOUNT_ID = \"__APP_KEY_ACCOUNT_ID\";\nconst defaultGas = \"200000000000000\";\nconst halfGas = \"50000000000000\"; /// this is the new account amount 0.21 for account name, keys, contract and 0.01 for mapping contract storage cost\n\nconst MIN_NEW_ACCOUNT = parseNearAmount(\"0.4\");\nconst MIN_NEW_ACCOUNT_THRESH = parseNearAmount(\"0.49\");\nconst MIN_NEW_ACCOUNT_ASK = parseNearAmount(\"0.5\");\nconst FUNDING_CHECK_TIMEOUT = 5000; /// lkmfawl\n\nconst attachedDepositMapping = parseNearAmount(\"0.05\"); /// Helpers\n\nconst defaultStorage = (prefix = \"\") => ({\n  getItem: k => {\n    const v = localStorage.getItem(prefix + k);\n\n    if ((v === null || v === void 0 ? void 0 : v.charAt(0)) !== \"{\") {\n      return v;\n    }\n\n    try {\n      return JSON.parse(v);\n    } catch (e) {//   logger.log(e);\n    }\n  },\n  setItem: (k, v) => localStorage.setItem(prefix + k, typeof v === \"string\" ? v : JSON.stringify(v)),\n  removeItem: k => localStorage.removeItem(prefix + k)\n});\n\nconst defaultLogger = () => ({\n  // eslint-disable-next-line\n  log: args => console.log(...args)\n}); /// NEAR setup\n\n\nlet near, gas, keyStore, logger, storage, connection, networkId, contractAccount, accountSuffix;\nconst initConnection = ({\n  network,\n  gas: _gas = defaultGas,\n  logger: _logger = defaultLogger(),\n  storage: _storage = defaultStorage()\n}) => {\n  gas = _gas;\n  logger = _logger;\n  storage = _storage;\n  keyStore = new BrowserLocalStorageKeyStore();\n  near = new Near(Object.assign(Object.assign({}, network), {\n    keyStore\n  }));\n  connection = near.connection;\n  networkId = network.networkId;\n  contractAccount = new Account(connection, networkId === \"mainnet\" ? \"near\" : networkId);\n  accountSuffix = networkId === \"mainnet\" ? \".near\" : \".\" + networkId;\n  const cover = document.createElement(\"div\");\n  cover.style.display = \"none\";\n  cover.style.width = \"100%\";\n  cover.style.height = \"100vh\";\n  cover.style.zIndex = \"999999\";\n  cover.style.position = \"fixed\";\n  cover.style.top = \"0\";\n  cover.style.background = \"rgba(0, 0, 0, 0.5)\";\n  document.body.appendChild(cover); /// recovery from unbundled TXs that haven't been broadcast yet\n\n  broadcastTXs();\n  return cover;\n};\nconst getConnection = () => {\n  return {\n    near,\n    connection,\n    keyStore,\n    networkId,\n    contractAccount,\n    accountSuffix\n  };\n}; /// helpers\n\nconst accountExists = (accountId, ethAddress = null) => __awaiter(void 0, void 0, void 0, function* () {\n  try {\n    const account = new nearAPI.Account(connection, accountId);\n    yield account.state();\n\n    if (ethAddress) {\n      const mapAccountId = yield getNearMap(ethAddress);\n\n      if (mapAccountId) {\n        return true;\n      }\n    }\n\n    return true;\n  } catch (e) {\n    if (!/no such file|does not exist/.test(e.toString())) {\n      throw e;\n    }\n\n    return false;\n  }\n});\n\nconst buf2hex = buf => ethers.utils.hexlify(buf).substring(2);\n\nconst pub2hex = publicKey => ethers.utils.hexlify(PublicKey.fromString(publicKey).data).substring(2); /// account creation and connection flow\n\n\nconst handleCreate = (signer, ethAddress, newAccountId, fundingAccountCB, fundingErrorCB, postFundingCB) => __awaiter(void 0, void 0, void 0, function* () {\n  if (networkId === \"testnet\" && newAccountId.indexOf(\".near\") > -1 || networkId === \"mainnet\" && newAccountId.indexOf(\".testnet\") > -1) {\n    return alert(\"Invalid account name. You do not need to add any .near or .testnet. Please try again.\");\n  } /// get keypair from eth sig entropy for the near-eth account\n\n\n  const {\n    publicKey: fundingAccountPubKey,\n    secretKey: new_secret_key\n  } = yield keyPairFromEthSig(signer, fundingKeyPayload()); /// store attempt in localStorage so we can recover and retry / resume contract deployment\n\n  yield storage.setItem(ATTEMPT_ACCOUNT_ID, newAccountId);\n  yield storage.setItem(ATTEMPT_SECRET_KEY, new_secret_key);\n  yield storage.setItem(ATTEMPT_ETH_ADDRESS, ethAddress);\n  return yield createAccount({\n    signer,\n    newAccountId,\n    fundingAccountPubKey,\n    fundingAccountCB,\n    fundingErrorCB,\n    postFundingCB\n  });\n});\n\nconst createAccount = ({\n  signer,\n  newAccountId,\n  fundingAccountPubKey,\n  fundingAccountCB,\n  fundingErrorCB,\n  postFundingCB\n}) => __awaiter(void 0, void 0, void 0, function* () {\n  // const { publicKey, secretKey } = parseSeedPhrase(process.env.REACT_APP_FUNDING_SEED_PHRASE);\n  /// assumes implicit is funded, otherwise will warn and cycle here\n  const implicitAccountId = Buffer.from(PublicKey.from(fundingAccountPubKey).data).toString(\"hex\");\n\n  if (fundingAccountCB) {\n    fundingAccountCB(implicitAccountId);\n  } /// wait for implicit funding here and then continue to createAccount\n\n\n  const checkImplicitFunded = () => __awaiter(void 0, void 0, void 0, function* () {\n    logger.log(\"checking for funding of implicit account\", implicitAccountId);\n    const account = new Account(connection, implicitAccountId);\n\n    try {\n      const balance = yield account.getAccountBalance();\n      const {\n        available\n      } = balance;\n      const diff = new BN(available).sub(new BN(MIN_NEW_ACCOUNT_THRESH));\n\n      if (diff.lt(new BN(\"0\"))) {\n        // alert(`There is not enough NEAR (${formatNearAmount(MIN_NEW_ACCOUNT_ASK, 4)} minimum) to create a new account and deploy NETH contract. Please deposit more and try again.`)\n        if (fundingErrorCB) {\n          fundingErrorCB(implicitAccountId, diff.abs().toString());\n        }\n\n        yield new Promise(r => setTimeout(r, FUNDING_CHECK_TIMEOUT));\n        return yield checkImplicitFunded();\n      }\n    } catch (e) {\n      if (!/does not exist/gi.test(e.toString())) {\n        throw e;\n      }\n\n      logger.log(\"not funded, checking again\");\n      yield new Promise(r => setTimeout(r, FUNDING_CHECK_TIMEOUT));\n      return yield checkImplicitFunded();\n    }\n\n    return true;\n  }); /// if not funded properly, return and reload\n\n\n  if (!(yield checkImplicitFunded())) {\n    return window.location.reload();\n  }\n\n  logger.log(\"implicit account funded\", implicitAccountId);\n\n  if (postFundingCB) {\n    postFundingCB();\n  }\n\n  const {\n    account,\n    ethAddress\n  } = yield setupFromStorage(implicitAccountId); /// final checks, last chance to cancel funding if they fail\n\n  if (yield accountExists(newAccountId, ethAddress)) {\n    alert(`${newAccountId} already exists. Please try another.`);\n    return yield handleCancelFunding(implicitAccountId);\n  } /// create account now\n  /// get keypair from eth sig entropy for the near-eth account\n\n\n  const {\n    publicKey: new_public_key,\n    secretKey: new_secret_key\n  } = yield keyPairFromEthSig(signer, unlimitedKeyPayload(newAccountId, ethAddress));\n  yield storage.setItem(ATTEMPT_SECRET_KEY, new_secret_key); // remove any existing app key\n\n  yield storage.removeItem(APP_KEY_ACCOUNT_ID);\n  yield storage.removeItem(APP_KEY_SECRET);\n\n  try {\n    yield account.functionCall({\n      contractId: NETWORK[networkId].ROOT_ACCOUNT_ID,\n      methodName: \"create_account\",\n      args: {\n        new_account_id: newAccountId,\n        new_public_key\n      },\n      gas,\n      attachedDeposit: new BN(MIN_NEW_ACCOUNT)\n    });\n  } catch (e) {\n    if (!/be created by/.test(JSON.stringify(e))) {\n      throw e;\n    }\n\n    return handleCancelFunding(implicitAccountId);\n  } /// check\n\n\n  if (!(yield accountExists(newAccountId))) {\n    return logger.log(`Account ${newAccountId} could NOT be created. Please refresh the page and try again.`);\n  }\n\n  logger.log(`Account ${newAccountId} created successfully.`); /// drain implicit\n\n  yield account.deleteAccount(newAccountId);\n  return yield handleMapping();\n});\n\nconst handleCancelFunding = fundingAccountId => __awaiter(void 0, void 0, void 0, function* () {\n  const {\n    account\n  } = yield setupFromStorage(fundingAccountId);\n  const refundAccountId = window.prompt(`There was an error creating the account. You need to refund and try again. Please enter the account you funded from. MAKE SURE IT IS CORRECT. THIS CANNOT BE UNDONE.`); /// drain implicit\n\n  try {\n    yield account.deleteAccount(refundAccountId);\n  } catch (e) {\n    logger.log(\"Cannot delete implicit\");\n  } finally {\n    /// delete attempt\n    yield storage.removeItem(ATTEMPT_ACCOUNT_ID);\n    yield storage.removeItem(ATTEMPT_SECRET_KEY);\n    yield storage.removeItem(ATTEMPT_ETH_ADDRESS);\n  }\n});\nconst handleMapping = () => __awaiter(void 0, void 0, void 0, function* () {\n  const {\n    account,\n    ethAddress\n  } = yield setupFromStorage();\n\n  try {\n    yield account.functionCall({\n      contractId: NETWORK[networkId].MAP_ACCOUNT_ID,\n      methodName: \"set\",\n      args: {\n        eth_address: ethAddress\n      },\n      gas,\n      attachedDeposit: new BN(attachedDepositMapping)\n    });\n    logger.log(`Account mapping successful`);\n  } catch (e) {\n    logger.log(e);\n    return logger.log(`Account mapping failed`);\n  }\n\n  return yield handleDeployContract();\n});\nconst handleDeployContract = () => __awaiter(void 0, void 0, void 0, function* () {\n  const {\n    account\n  } = yield setupFromStorage();\n  const contractPath = window === null || window === void 0 ? void 0 : window.contractPath; // logger.log(contractPath)\n\n  const ab = yield fetch(contractPath).then(res => res.arrayBuffer());\n  const contractBytes = new Uint8Array(ab); // logger.log(\"contractBytes.length\", contractBytes.length);\n\n  try {\n    yield account.deployContract(contractBytes);\n    logger.log(`Contract deployed successfully.`);\n  } catch (e) {\n    logger.log(e);\n    return logger.log(`Contract deployment failed. ${REFRESH_MSG}`);\n  }\n\n  return yield handleSetupContract();\n});\nconst handleSetupContract = () => __awaiter(void 0, void 0, void 0, function* () {\n  const {\n    account,\n    ethAddress\n  } = yield setupFromStorage();\n\n  try {\n    yield account.functionCall({\n      contractId: account.accountId,\n      methodName: \"setup\",\n      args: {\n        eth_address: ethAddress\n      },\n      gas\n    });\n    logger.log(`Contract setup successfully.`);\n  } catch (e) {\n    logger.log(e);\n    return logger.log(`Contract setup failed. ${REFRESH_MSG}`);\n  }\n\n  return yield handleKeys();\n});\nconst handleKeys = () => __awaiter(void 0, void 0, void 0, function* () {\n  var _a, _b, _c;\n\n  const {\n    account,\n    newAccountId,\n    ethAddress\n  } = yield setupFromStorage();\n  const accessKeys = yield account.getAccessKeys(); // keys are done\n\n  if (accessKeys.length !== 1 || ((_b = (_a = accessKeys[0]) === null || _a === void 0 ? void 0 : _a.access_key) === null || _b === void 0 ? void 0 : _b.permission) !== \"FullAccess\") {\n    return;\n  }\n\n  const publicKey = PublicKey.from(accessKeys[0].public_key);\n  const actions = [// delete the full access key\n  deleteKey(publicKey), // limited to execute, unlimited allowance\n  addKey(publicKey, functionCallAccessKey(newAccountId, [\"execute\"]))];\n\n  try {\n    const res = yield account.signAndSendTransaction({\n      receiverId: newAccountId,\n      actions\n    });\n\n    if (((_c = res === null || res === void 0 ? void 0 : res.status) === null || _c === void 0 ? void 0 : _c.SuccessValue) !== \"\") {\n      return logger.log(`Key rotation failed. ${REFRESH_MSG}`);\n    }\n\n    logger.log(`Key rotation successful.`);\n  } catch (e) {\n    logger.log(e);\n    return logger.log(`Key rotation failed. ${REFRESH_MSG}`);\n  }\n\n  return yield handleCheckAccount({\n    ethAddress\n  });\n}); /// waterfall check everything about account and fill in missing pieces\n\nconst handleCheckAccount = ({\n  signer = null,\n  ethAddress = null,\n  fundingAccountCB = null,\n  fundingErrorCB = null,\n  postFundingCB = null\n}) => __awaiter(void 0, void 0, void 0, function* () {\n  var _d, _e;\n\n  const setup = yield setupFromStorage();\n  let {\n    newAccountId\n  } = setup;\n  const {\n    newSecretKey\n  } = setup;\n  const mapAccountId = yield getNearMap(ethAddress);\n\n  if (!mapAccountId) {\n    // alert(\"create account first\");\n    logger.log(\"No account mapping exists.\");\n  } else {\n    newAccountId = mapAccountId;\n  }\n\n  logger.log(\"Checking account created.\");\n\n  if (!(yield accountExists(newAccountId))) {\n    const keyPair = KeyPair.fromString(newSecretKey);\n    return createAccount({\n      signer,\n      newAccountId,\n      fundingAccountPubKey: keyPair.getPublicKey().toString(),\n      fundingAccountCB,\n      fundingErrorCB,\n      postFundingCB\n    });\n  }\n\n  const account = new Account(connection, newAccountId);\n  logger.log(\"Checking account address mapping.\");\n  const mapRes = yield account.viewFunction(NETWORK[networkId].MAP_ACCOUNT_ID, \"get_eth\", {\n    account_id: newAccountId\n  });\n\n  if (mapRes === null) {\n    return handleMapping();\n  }\n\n  logger.log(\"Checking contract deployed.\");\n  const state = yield account.state();\n\n  if (state.code_hash === \"11111111111111111111111111111111\") {\n    return handleDeployContract();\n  }\n\n  logger.log(\"Checking contract setup.\");\n\n  try {\n    const ethRes = yield account.viewFunction(newAccountId, \"get_address\"); // any reason the address wasn't set properly\n\n    if (!ethRes || !ethRes.length) {\n      return handleSetupContract();\n    }\n  } catch (e) {\n    // not set at all (wasm error unreachable storage value)\n    logger.log(e);\n    return handleSetupContract();\n  }\n\n  logger.log(\"Checking access keys.\");\n  const accessKeys = yield account.getAccessKeys();\n\n  if (accessKeys.length === 1 && ((_e = (_d = accessKeys[0]) === null || _d === void 0 ? void 0 : _d.access_key) === null || _e === void 0 ? void 0 : _e.permission) === \"FullAccess\") {\n    return handleKeys();\n  }\n\n  logger.log(\"Account created.\");\n  logger.log(\"Contract deployed and setup.\");\n  logger.log(\"Mapping added.\");\n  logger.log(\"Keys rotated.\");\n  yield storage.removeItem(ATTEMPT_ACCOUNT_ID);\n  yield storage.removeItem(ATTEMPT_SECRET_KEY);\n  yield storage.removeItem(ATTEMPT_ETH_ADDRESS);\n  return {\n    account\n  };\n}); /// on same domain as setup\n\nconst hasAppKey = accessKeys => accessKeys.some(k => {\n  var _a, _b;\n\n  const functionCallPermission = (_b = (_a = k === null || k === void 0 ? void 0 : k.access_key) === null || _a === void 0 ? void 0 : _a.permission) === null || _b === void 0 ? void 0 : _b.FunctionCall;\n  return functionCallPermission.allowance !== null && functionCallPermission.method_names[0] === \"execute\";\n});\nconst handleRefreshAppKey = (signer, ethAddress) => __awaiter(void 0, void 0, void 0, function* () {\n  var _f;\n\n  const {\n    account,\n    accountId\n  } = yield getUnlimitedKeyAccount(signer, ethAddress); // now refresh app key\n\n  const nonce = parseInt(yield account.viewFunction(accountId, \"get_nonce\"), 16).toString(); // new public key based on current nonce which will become the app_key_nonce in contract after this TX\n\n  const {\n    publicKey,\n    secretKey\n  } = yield keyPairFromEthSig(signer, appKeyPayload(accountId, nonce)); // logger.log(publicKey);\n\n  const public_key = pub2hex(publicKey);\n  const actions = [{\n    type: \"AddKey\",\n    public_key,\n    allowance: parseNearAmount(\"1\"),\n    receiver_id: accountId,\n    method_names: \"execute\"\n  }]; /// check keys, find old app key, delete that first\n\n  const accessKeys = yield account.getAccessKeys();\n\n  if (hasAppKey(accessKeys)) {\n    // old public key based on current app_key_nonce\n    const appKeyNonce = parseInt(yield account.viewFunction(accountId, \"get_app_key_nonce\"), 16).toString();\n    const {\n      publicKey: oldPublicKey\n    } = yield keyPairFromEthSig(signer, appKeyPayload(accountId, appKeyNonce));\n    const oldPublicKeyHex = pub2hex(oldPublicKey);\n    actions.unshift({\n      type: \"DeleteKey\",\n      public_key: oldPublicKeyHex\n    });\n  } /// get args for execute call\n\n\n  const args = yield ethSignJson(signer, {\n    nonce,\n    receivers: [accountId],\n    transactions: [{\n      actions\n    }]\n  });\n  const res = yield account.functionCall({\n    contractId: accountId,\n    methodName: \"execute\",\n    args,\n    gas\n  });\n\n  if (((_f = res === null || res === void 0 ? void 0 : res.status) === null || _f === void 0 ? void 0 : _f.SuccessValue) !== \"\") {\n    return logger.log(`App key rotation unsuccessful. ${REFRESH_MSG}`);\n  }\n\n  yield storage.removeItem(APP_KEY_SECRET);\n  yield storage.removeItem(APP_KEY_ACCOUNT_ID);\n  return {\n    publicKey: public_key,\n    secretKey\n  };\n});\nconst handleUpdateContract = (signer, ethAddress) => __awaiter(void 0, void 0, void 0, function* () {\n  var _g;\n\n  const {\n    account,\n    accountId\n  } = yield getUnlimitedKeyAccount(signer, ethAddress);\n  const contractPath = window === null || window === void 0 ? void 0 : window.contractPath;\n  const ab = yield fetch(contractPath).then(res => res.arrayBuffer());\n  const contractBytes = new Uint8Array(ab);\n  const actions = [{\n    type: \"DeployContract\",\n    code: buf2hex(contractBytes)\n  }];\n  const nonce = parseInt(yield account.viewFunction(accountId, \"get_nonce\"), 16).toString();\n  const args = yield ethSignJson(signer, {\n    nonce,\n    receivers: [accountId],\n    transactions: [{\n      actions\n    }]\n  });\n  const res = yield account.functionCall({\n    contractId: accountId,\n    methodName: \"execute\",\n    args,\n    gas\n  });\n\n  if (((_g = res === null || res === void 0 ? void 0 : res.status) === null || _g === void 0 ? void 0 : _g.SuccessValue) !== \"\") {\n    return logger.log(`Redeply contract unsuccessful. ${REFRESH_MSG}`);\n  }\n}); /// account disconnecting flow\n\nconst handleDisconnect = (signer, ethAddress) => __awaiter(void 0, void 0, void 0, function* () {\n  var _h, _j;\n\n  const {\n    account,\n    accountId,\n    secretKey\n  } = yield getUnlimitedKeyAccount(signer, ethAddress);\n  const {\n    seedPhrase,\n    publicKey,\n    secretKey: newSecretKey\n  } = generateSeedPhrase();\n\n  const _seedPhrase = window.prompt(\"Copy this down and keep it safe!!! This is your new seed phrase!!!\", seedPhrase);\n\n  if (seedPhrase !== _seedPhrase) {\n    return alert(\"There was an error copying seed phrase. Nothing has been done. Please try again.\");\n  }\n\n  const oldUnlimitedKey = KeyPair.fromString(secretKey);\n  const actions = [{\n    type: \"DeleteKey\",\n    public_key: pub2hex(oldUnlimitedKey.getPublicKey().toString())\n  }, {\n    type: \"AddKey\",\n    public_key: pub2hex(publicKey),\n    // special case will add full access key\n    allowance: \"0\"\n  }, {\n    type: \"FunctionCall\",\n    method_name: \"remove_storage\",\n    args: \"\",\n    amount: \"0\",\n    gas: halfGas\n  }, {\n    type: \"DeployContract\",\n    code: \"\"\n  }]; /// check keys, find old app key, delete that first\n\n  const accessKeys = yield account.getAccessKeys();\n\n  if (accessKeys.some(k => {\n    var _a, _b;\n\n    const functionCallPermission = (_b = (_a = k === null || k === void 0 ? void 0 : k.access_key) === null || _a === void 0 ? void 0 : _a.permission) === null || _b === void 0 ? void 0 : _b.FunctionCall;\n    return (functionCallPermission === null || functionCallPermission === void 0 ? void 0 : functionCallPermission.allowance) !== null && (functionCallPermission === null || functionCallPermission === void 0 ? void 0 : functionCallPermission.method_names[0]) === \"execute\";\n  })) {\n    const appKeyNonce = parseInt(yield account.viewFunction(accountId, \"get_app_key_nonce\"), 16).toString();\n    const {\n      publicKey: oldPublicKey\n    } = yield keyPairFromEthSig(signer, appKeyPayload(accountId, appKeyNonce));\n    const oldPublicKeyHex = pub2hex(oldPublicKey);\n    actions.unshift({\n      type: \"DeleteKey\",\n      public_key: oldPublicKeyHex\n    });\n  } /// get args for execute call\n\n\n  const nonce = parseInt(yield account.viewFunction(accountId, \"get_nonce\"), 16).toString();\n  const args = yield ethSignJson(signer, {\n    nonce,\n    receivers: [accountId],\n    transactions: [{\n      actions\n    }]\n  });\n  const res = yield account.functionCall({\n    contractId: accountId,\n    methodName: \"execute\",\n    args,\n    gas\n  });\n\n  if (((_h = res === null || res === void 0 ? void 0 : res.status) === null || _h === void 0 ? void 0 : _h.SuccessValue) !== \"\") {\n    return logger.log(\"app key rotation unsuccessful\");\n  } // remove the mapping (can do this later if user has FAK)\n\n\n  keyStore.setKey(networkId, accountId, newSecretKey);\n\n  try {\n    const mapRes = yield account.functionCall({\n      contractId: NETWORK[networkId].MAP_ACCOUNT_ID,\n      methodName: \"del\",\n      args: {},\n      gas\n    });\n    logger.log(mapRes);\n\n    if (((_j = mapRes === null || mapRes === void 0 ? void 0 : mapRes.status) === null || _j === void 0 ? void 0 : _j.SuccessValue) !== \"\") {\n      logger.log(\"account mapping removal failed\");\n    }\n  } catch (e) {\n    logger.log(e);\n  }\n\n  return {\n    account\n  };\n}); /// helpers for account creation and connection domain\n\nconst setupFromStorage = (accountId = \"\") => __awaiter(void 0, void 0, void 0, function* () {\n  const newAccountId = accountId.length > 0 ? accountId : yield storage.getItem(ATTEMPT_ACCOUNT_ID);\n  const newSecretKey = yield storage.getItem(ATTEMPT_SECRET_KEY);\n  const ethAddress = yield storage.getItem(ATTEMPT_ETH_ADDRESS);\n  const account = new Account(connection, newAccountId);\n  let keyPair;\n\n  if (newSecretKey) {\n    keyPair = KeyPair.fromString(newSecretKey);\n    keyStore.setKey(networkId, newAccountId, keyPair);\n  }\n\n  return {\n    newAccountId,\n    newSecretKey,\n    ethAddress,\n    account,\n    keyPair\n  };\n});\n\nconst getUnlimitedKeyAccount = (signer, ethAddress, tryPrevUrl = false) => __awaiter(void 0, void 0, void 0, function* () {\n  let accountId,\n      secretKey = yield storage.getItem(ATTEMPT_SECRET_KEY); // if unlimited allowance access key is not in localStorage user will have to sign to generate it\n\n  if (!secretKey) {\n    // TODO remove dep on near-utils\n    // use any random near account to check mapping\n    accountId = yield getNearMap(ethAddress);\n    const {\n      secretKey: _secretKey\n    } = yield keyPairFromEthSig(signer, unlimitedKeyPayload(accountId, tryPrevUrl));\n    secretKey = _secretKey;\n  } else {\n    accountId = yield storage.getItem(ATTEMPT_ACCOUNT_ID);\n  }\n\n  const account = new Account(connection, accountId);\n  const keyPair = KeyPair.fromString(secretKey);\n  const publicKey = keyPair.getPublicKey().toString(); /// check if access key matches\n\n  const accessKeys = yield account.getAccessKeys();\n\n  if (!accessKeys.some(({\n    public_key\n  }) => publicKey === public_key)) {\n    return yield getUnlimitedKeyAccount(signer, ethAddress, true);\n  }\n\n  keyStore.setKey(networkId, accountId, keyPair);\n  return {\n    account,\n    accountId,\n    secretKey\n  };\n});\n/**\r\n * The access key payloads, unlimited and limited\r\n */\n\n\nconst appKeyPayload = (accountId, appKeyNonce) => ({\n  WARNING: `Creating key for: ${accountId}`,\n  nonce: appKeyNonce,\n  description: `ONLY sign this on apps you trust! This key CAN use up to 1 N for transactions.`\n});\n\nconst unlimitedKeyPayload = (accountId, tryPrevUrl) => ({\n  WARNING: `Creates a key with access to your (new) paired NEAR Account: ${accountId}`,\n  description: `ONLY sign this message on this website: ${tryPrevUrl ? PREV_NETH_SITE_URL : NETH_SITE_URL}`\n});\n\nconst fundingKeyPayload = () => ({\n  WARNING: `This creates a full access key in your localStorage to a funding account you will be sending NEAR to.`,\n  description: `ONLY sign this message on this website: ${NETH_SITE_URL}`\n});\n/**\r\n * main domain, types and eth signTypedData method\r\n */\n\n\nconst domain = {\n  name: \"NETH\",\n  version: \"1\",\n  // chainId: 1, // aurora\n  chainId: 1313161554 // aurora\n\n};\nconst HEADER_OFFSET = \"NETH\";\nconst HEADER_PAD = 8;\nconst RECEIVER_MARKER = \"|~-_NETH~-_-~RECEIVER_-~|\";\nconst PREFIX = \"|NETH_\";\nconst SUFFIX = \"_NETH|\";\n\nconst pack = elements => elements.map(el => {\n  const str = typeof el === \"string\" ? el : Object.entries(el).map(([k, v]) => `${PREFIX}${k}:${typeof v === \"string\" ? v : JSON.stringify(v)}${SUFFIX}`).join(\"\");\n  const len = str.length.toString().padStart(HEADER_PAD, \"0\");\n  return HEADER_OFFSET + len + \"__\" + str;\n}).join(\"\");\n\nconst ethSignJson = (signer, json) => __awaiter(void 0, void 0, void 0, function* () {\n  const Transaction = [];\n  const types = {\n    Transaction\n  };\n  Object.entries(json).forEach(([k]) => {\n    types.Transaction.push({\n      type: \"string\",\n      name: k\n    });\n  }); /// convenience for devs so they can pass in JSON\n  /// hoist any functionCall args containing receiver|account in their key to top level receivers\n  /// replaces value with marker, contract fills in marker\n\n  if (json.transactions) {\n    Object.values(json.transactions).forEach((tx, i) => {\n      tx.actions.forEach(action => {\n        if (!action.args) {\n          return;\n        }\n\n        if (Buffer.isBuffer(action.args)) {\n          action.args = \"0x\" + action.args.toString(\"hex\");\n          return;\n        }\n\n        Object.entries(action.args).forEach(([key, value]) => {\n          /// TODO include check on value to determine valid account_id to be replaced\n          if (/receiver_id|account_id/g.test(key)) {\n            action.args[key] = RECEIVER_MARKER;\n            json.receivers.splice(i + 1, 0, value);\n          }\n        });\n      });\n    });\n    json.transactions = pack(json.transactions.map(({\n      actions\n    }) => pack(actions)));\n  }\n\n  if (json.receivers) {\n    const numReceivers = json.receivers.length.toString();\n    json.receivers = HEADER_OFFSET + json.receivers.join(\",\").length.toString().padStart(HEADER_PAD, \"0\") + \"__\" + json.receivers.join(\",\");\n    json.receivers = json.receivers.substring(0, 4) + numReceivers.padStart(3, \"0\") + json.receivers.substring(7);\n  }\n\n  const sig = yield signer._signTypedData(domain, types, json);\n  const args = {\n    sig,\n    msg: json\n  }; // logger.log('\\nargs\\n', JSON.stringify(args, null, 4), '\\n');\n\n  return args;\n});\n\nconst keyPairFromEthSig = (signer, json) => __awaiter(void 0, void 0, void 0, function* () {\n  const {\n    sig\n  } = yield ethSignJson(signer, json);\n  const sigHash = ethers.utils.id(sig); /// use 32 bytes of entropy from hash of signature to create NEAR keyPair\n\n  return generateSeedPhrase(sigHash.substring(2, 34));\n});\n/**\r\n * Used by apps to signIn and signAndSendTransactions\r\n */\n/// ethereum\n\n\nconst getEthereum = () => __awaiter(void 0, void 0, void 0, function* () {\n  var _k, _l;\n\n  const provider = yield detectEthereumProvider();\n\n  if (!provider) {\n    return alert(\"Please install/activate MetaMask and try again.\");\n  }\n\n  try {\n    yield window.ethereum.request({\n      method: \"wallet_switchEthereumChain\",\n      params: [{\n        chainId: \"0x\" + domain.chainId.toString(16)\n      }]\n    });\n  } catch (e) {\n    logger.log(e);\n    const code = (e === null || e === void 0 ? void 0 : e.code) || ((_l = (_k = e === null || e === void 0 ? void 0 : e.data) === null || _k === void 0 ? void 0 : _k.originalError) === null || _l === void 0 ? void 0 : _l.code);\n\n    if (code !== 4902) {\n      throw e;\n    }\n\n    try {\n      yield window.ethereum.request({\n        method: \"wallet_addEthereumChain\",\n        params: [{\n          chainId: \"0x\" + domain.chainId.toString(16),\n          chainName: \"Aurora Mainnet\",\n          nativeCurrency: {\n            name: \"Ethereum\",\n            symbol: \"ETH\",\n            decimals: 18\n          },\n          blockExplorerUrls: [\"https://explorer.mainnet.aurora.dev/\"],\n          rpcUrls: [\"https://mainnet.aurora.dev\"]\n        }]\n      });\n    } catch (e2) {\n      alert('Error adding chain. Please click \"Choose Ethereum Account\" and add the Aurora Network to continue.');\n      throw e2;\n    }\n  }\n\n  const ethersProvider = new ethers.providers.Web3Provider(window.ethereum);\n  const accounts = yield ethersProvider.listAccounts();\n\n  if (accounts.length === 0) {\n    yield ethersProvider.send(\"eth_requestAccounts\", []);\n  }\n\n  const signer = ethersProvider.getSigner();\n  return {\n    signer,\n    ethAddress: yield signer.getAddress()\n  };\n});\nconst switchEthereum = () => __awaiter(void 0, void 0, void 0, function* () {\n  const provider = yield detectEthereumProvider();\n  yield provider.send(\"wallet_requestPermissions\", [{\n    eth_accounts: {}\n  }]);\n  const ethersProvider = new ethers.providers.Web3Provider(window.ethereum);\n  const signer = ethersProvider.getSigner();\n  return {\n    signer,\n    ethAddress: yield signer.getAddress()\n  };\n}); /// near\n\nconst getNearMap = eth_address => __awaiter(void 0, void 0, void 0, function* () {\n  return contractAccount.viewFunction(NETWORK[networkId].MAP_ACCOUNT_ID, \"get_near\", {\n    eth_address\n  });\n});\nconst getNear = () => __awaiter(void 0, void 0, void 0, function* () {\n  const secretKey = yield storage.getItem(APP_KEY_SECRET);\n  const accountId = yield storage.getItem(APP_KEY_ACCOUNT_ID);\n\n  if (!secretKey || !accountId) {\n    const ethRes = yield getEthereum();\n    const res = yield getAppKey(ethRes);\n\n    if (!res) {\n      return false;\n    }\n\n    return yield getNear();\n  }\n\n  const account = new Account(connection, accountId);\n  const keyPair = KeyPair.fromString(secretKey);\n  keyStore.setKey(networkId, accountId, keyPair);\n  return {\n    account,\n    accountId,\n    keyPair,\n    secretKey\n  };\n});\nconst signIn = getNear;\nconst signOut = () => __awaiter(void 0, void 0, void 0, function* () {\n  const accountId = yield storage.getItem(APP_KEY_ACCOUNT_ID);\n\n  if (!accountId) {\n    return logger.log(\"already signed out\");\n  }\n\n  yield storage.removeItem(APP_KEY_SECRET);\n  yield storage.removeItem(APP_KEY_ACCOUNT_ID);\n  return {\n    accountId\n  };\n});\nconst verifyOwner = ({\n  message,\n  provider,\n  account\n}) => __awaiter(void 0, void 0, void 0, function* () {\n  let accountId;\n\n  if (!account) {\n    ({\n      account,\n      accountId\n    } = yield getNear());\n  } else {\n    ({\n      accountId\n    } = account);\n  }\n\n  if (!account) {\n    throw new Error(\"Wallet not signed in\");\n  }\n\n  const pubKey = yield account.connection.signer.getPublicKey(accountId, networkId);\n  const publicKey = Buffer.from(pubKey.data).toString(\"base64\");\n  const block = yield provider.block({\n    finality: \"final\"\n  });\n  const blockId = block.header.hash;\n  const data = {\n    accountId,\n    message,\n    blockId,\n    publicKey,\n    keyType: pubKey.keyType\n  };\n  const encoded = JSON.stringify(data);\n  const signed = yield account.connection.signer.signMessage(new Uint8Array(Buffer.from(encoded)), accountId, networkId);\n  return Object.assign(Object.assign({}, data), {\n    signature: Buffer.from(signed.signature).toString(\"base64\")\n  });\n});\nconst isSignedIn = () => __awaiter(void 0, void 0, void 0, function* () {\n  /// init defaultStorage here because it's not initialized until initConnection\n  const tempStorage = defaultStorage(WS_STORAGE_NAMESPACE);\n  return !!(yield tempStorage.getItem(APP_KEY_SECRET)) || !!(yield tempStorage.getItem(APP_KEY_ACCOUNT_ID));\n}); // const promptValidAccountId = async (msg) => {\n//   const newAccountId = window.prompt(msg);\n//   if (!newAccountId) {\n//     throw new Error(\"NETH Error: failed to pick valid NEAR account name\");\n//   }\n//   if (\n//     newAccountId.length < 2 ||\n//     newAccountId.indexOf(\".\") > -1 ||\n//     !ACCOUNT_REGEX.test(newAccountId) ||\n//     newAccountId.length > 64\n//   ) {\n//     return promptValidAccountId(\n//       `account is invalid (a-z, 0-9 and -,_ only; min 2; max 64; ${accountSuffix} applied automatically)`\n//     );\n//   }\n//   if (await accountExists(newAccountId)) {\n//     return promptValidAccountId(`account already exists`);\n//   }\n//   return newAccountId;\n// };\n\nconst getAppKey = ({\n  signer,\n  ethAddress: eth_address\n}) => __awaiter(void 0, void 0, void 0, function* () {\n  const accountId = yield getNearMap(eth_address);\n\n  if (!accountId) {\n    const tryAgain = window.confirm(`Ethereum account ${eth_address} is not connected to a NETH account. Would you like to try another Ethereum account?`);\n\n    if (tryAgain) {\n      try {\n        const {\n          signer: _signer,\n          ethAddress\n        } = yield switchEthereum();\n        return yield getAppKey({\n          signer: _signer,\n          ethAddress\n        });\n      } catch (e) {\n        logger.log(e);\n      }\n\n      return;\n    }\n\n    const nethURL = `${NETH_SITE_URL}/${networkId === \"testnet\" ? \"?network=testnet\" : \"\"}`;\n    window.prompt(`We couldn't find a NETH account. To set up a NETH account visit`, nethURL); // throw new Error(`Ethereum account is not connected to a NETH account. To set up a NETH account visit: ${nethURL}`)\n    // /// prompt for near account name and auto deploy\n    // const newAccountId = await promptValidAccountId(\n    // \t`The Ethereum address ${eth_address} is not connected to a NEAR account yet. Select a NEAR account name and we'll create and connect one for you.`,\n    // );\n    // const { account } = await handleCreate(signer, eth_address, newAccountId + accountSuffix);\n    // accountId = account.accountId;\n  }\n\n  const appKeyNonce = parseInt(yield contractAccount.viewFunction(accountId, \"get_app_key_nonce\"), 16).toString();\n  const {\n    publicKey,\n    secretKey\n  } = yield keyPairFromEthSig(signer, appKeyPayload(accountId, appKeyNonce));\n  const account = new Account(connection, accountId); // check that app key exists on account\n\n  const accessKeys = yield account.getAccessKeys();\n\n  if (!hasAppKey(accessKeys)) {\n    yield handleRefreshAppKey(signer, eth_address);\n  }\n\n  const keyPair = KeyPair.fromString(secretKey);\n  keyStore.setKey(networkId, accountId, keyPair);\n  yield storage.setItem(APP_KEY_SECRET, secretKey);\n  yield storage.setItem(APP_KEY_ACCOUNT_ID, account.accountId);\n  return {\n    publicKey,\n    secretKey,\n    account\n  };\n});\n\nconst broadcastTXs = () => __awaiter(void 0, void 0, void 0, function* () {\n  const {\n    account,\n    accountId\n  } = yield getNear();\n  const args = yield storage.getItem(TX_ARGS_ATTEMPT);\n\n  if (!args || args.length === 0) {\n    return;\n  }\n\n  const res = [];\n\n  while (args.length > 0) {\n    const currentArgs = args.shift();\n    logger.log(\"NETH: broadcasting tx\", currentArgs);\n\n    try {\n      const tx = yield account.functionCall({\n        contractId: accountId,\n        methodName: \"execute\",\n        args: currentArgs,\n        gas\n      });\n      yield storage.setItem(TX_ARGS_ATTEMPT, args);\n      res.push(tx);\n    } catch (e) {\n      logger.log(\"NETH: ERROR broadcasting tx\", e);\n    }\n  }\n\n  yield storage.removeItem(TX_ARGS_ATTEMPT);\n  return res;\n});\n\nconst signAndSendTransactions = ({\n  transactions,\n  bundle\n}) => __awaiter(void 0, void 0, void 0, function* () {\n  const ethRes = yield getEthereum();\n  const {\n    signer\n  } = ethRes;\n  const {\n    account,\n    accountId\n  } = yield getNear();\n  const receivers = transactions.map(({\n    receiverId\n  }) => receiverId);\n  const transformedTxs = transactions.map(({\n    receiverId,\n    actions\n  }) => ({\n    actions: convertActions(actions, accountId, receiverId)\n  }));\n  const nonce = parseInt(yield account.viewFunction(accountId, \"get_nonce\"), 16);\n  const args = [];\n\n  if (!bundle) {\n    for (let i = 0; i < transformedTxs.length; i++) {\n      args.push(yield ethSignJson(signer, {\n        nonce: (nonce + i).toString(),\n        receivers: [receivers[i]],\n        transactions: [transformedTxs[i]]\n      }));\n    }\n  } else {\n    args.push(yield ethSignJson(signer, {\n      nonce: nonce.toString(),\n      receivers,\n      transactions: transformedTxs\n    }));\n  }\n\n  yield storage.setItem(TX_ARGS_ATTEMPT, args);\n  const res = yield broadcastTXs();\n  return res;\n}); /// helpers\n\nconst convertActions = (actions, accountId, receiverId) => actions.map(_action => {\n  const {\n    enum: type\n  } = _action;\n  const {\n    gas: _gas,\n    publicKey,\n    methodName,\n    args,\n    deposit,\n    accessKey,\n    code\n  } = _action[type] || _action;\n  const action = {\n    type: type && type[0].toUpperCase() + type.substr(1) || \"FunctionCall\",\n    gas: _gas && _gas.toString() || undefined,\n    public_key: publicKey && pub2hex(publicKey) || undefined,\n    method_name: methodName,\n    args: args || undefined,\n    code: code || undefined,\n    amount: deposit && deposit.toString() || undefined,\n    permission: undefined\n  };\n  Object.keys(action).forEach(k => {\n    if (action[k] === undefined) {\n      delete action[k];\n    }\n  });\n\n  if (accessKey) {\n    if (receiverId === accountId) {\n      action.allowance = parseNearAmount(\"1\");\n      action.method_names = \"execute\";\n      action.receiver_id = accountId;\n    } else if (accessKey.permission.enum === \"functionCall\") {\n      const {\n        receiverId: _receiverId,\n        methodNames,\n        allowance\n      } = accessKey.permission.functionCall;\n      action.receiver_id = _receiverId;\n      action.allowance = allowance && allowance.toString() || parseNearAmount(\"0.25\");\n      action.method_names = methodNames.join(\",\");\n    }\n  }\n\n  return action;\n});\n\nconst isInstalled = () => __awaiter(void 0, void 0, void 0, function* () {\n  yield detectEthereumProvider();\n  return !!window.ethereum;\n});\n\nlet bundle = true;\nlet useCover = false;\nlet customGas;\n\nconst Neth = ({\n  metadata,\n  logger,\n  store,\n  storage,\n  options,\n  provider\n}) => __awaiter(void 0, void 0, void 0, function* () {\n  const cover = initConnection({\n    network: options.network,\n    gas: customGas,\n    logger,\n    storage\n  });\n\n  const isValidActions = actions => {\n    return actions.every(x => x.type === \"FunctionCall\");\n  };\n\n  const transformActions = actions => {\n    const validActions = isValidActions(actions);\n\n    if (!validActions) {\n      throw new Error(`Only 'FunctionCall' actions types are supported by ${metadata.name}`);\n    }\n\n    return actions.map(x => x.params);\n  };\n\n  const signTransactions = transactions => __awaiter(void 0, void 0, void 0, function* () {\n    logger.log(\"NETH:signAndSendTransactions\", {\n      transactions\n    });\n    const {\n      contract\n    } = store.getState();\n\n    if (!(yield isSignedIn()) || !contract) {\n      throw new Error(\"Wallet not signed in\");\n    }\n\n    if (useCover) {\n      cover.style.display = \"block\";\n    }\n\n    const transformedTxs = transactions.map(({\n      receiverId,\n      actions\n    }) => ({\n      receiverId: receiverId || contract.contractId,\n      actions: transformActions(actions)\n    }));\n    let res;\n\n    try {\n      res = yield signAndSendTransactions({\n        transactions: transformedTxs,\n        bundle\n      });\n    } catch (e) {\n      /// \"user rejected signing\" or near network error\n      logger.log(\"NETH:signAndSendTransactions Error\", e);\n      throw e;\n    }\n\n    if (useCover) {\n      cover.style.display = \"none\";\n    }\n\n    return res;\n  }); // return the wallet interface for wallet-selector\n\n\n  return {\n    signIn() {\n      return __awaiter(this, void 0, void 0, function* () {\n        let account;\n\n        try {\n          account = yield signIn();\n\n          if (!account) {\n            return [];\n          }\n        } catch (e) {\n          if (!/not connected/.test(e.toString())) {\n            throw e;\n          } // console.log(e);\n\n        }\n\n        return [account];\n      });\n    },\n\n    signOut() {\n      return __awaiter(this, void 0, void 0, function* () {\n        yield signOut();\n      });\n    },\n\n    verifyOwner({\n      message\n    }) {\n      return __awaiter(this, void 0, void 0, function* () {\n        logger.log(\"NETH:verifyOwner\", {\n          message\n        });\n        return verifyOwner({\n          message,\n          provider,\n          account: null\n        });\n      });\n    },\n\n    getAccounts() {\n      return __awaiter(this, void 0, void 0, function* () {\n        const {\n          accountId\n        } = yield getNear();\n        return [{\n          accountId\n        }];\n      });\n    },\n\n    signAndSendTransaction: ({\n      receiverId,\n      actions\n    }) => __awaiter(void 0, void 0, void 0, function* () {\n      return signTransactions([{\n        receiverId,\n        actions\n      }]);\n    }),\n    signAndSendTransactions: ({\n      transactions\n    }) => __awaiter(void 0, void 0, void 0, function* () {\n      return signTransactions(transactions);\n    })\n  };\n});\n\nfunction setupNeth({\n  iconUrl = nethIcon,\n  gas,\n  useModalCover = false,\n  bundle: _bundle = true,\n  deprecated = false\n} = {}) {\n  return () => __awaiter(this, void 0, void 0, function* () {\n    useCover = useModalCover;\n    customGas = gas;\n    bundle = _bundle;\n    const mobile = isMobile();\n    const installed = yield isInstalled();\n    yield waitFor(() => !!isSignedIn(), {\n      timeout: 300\n    }).catch(() => false);\n\n    if (mobile) {\n      return null;\n    }\n\n    return {\n      id: \"neth\",\n      type: \"injected\",\n      metadata: {\n        name: \"NETH Account\",\n        description: null,\n        iconUrl,\n        downloadUrl: NETH_SITE_URL,\n        deprecated: false,\n        available: installed\n      },\n      deprecated,\n      init: Neth\n    };\n  });\n}\n\nexport { MIN_NEW_ACCOUNT_ASK, accountExists, getConnection, getEthereum, getNear, getNearMap, handleCancelFunding, handleCheckAccount, handleCreate, handleDisconnect, handleRefreshAppKey, handleUpdateContract, hasAppKey, initConnection, isSignedIn, setupNeth, signAndSendTransactions, signIn, signOut, switchEthereum, verifyOwner };\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}