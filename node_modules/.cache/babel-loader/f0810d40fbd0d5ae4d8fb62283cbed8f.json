{"ast":null,"code":"import _regeneratorRuntime from\"/Users/sepezho/Work/tonana/fe/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _toConsumableArray from\"/Users/sepezho/Work/tonana/fe/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _asyncToGenerator from\"/Users/sepezho/Work/tonana/fe/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/sepezho/Work/tonana/fe/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useCallback,useContext,useEffect,useState}from\"react\";import{map,distinctUntilChanged}from\"rxjs\";import{setupWalletSelector}from\"@near-wallet-selector/core\";import{setupModal}from\"@near-wallet-selector/modal-ui\";import{setupDefaultWallets}from\"@near-wallet-selector/default-wallets\";import{setupNearWallet}from\"@near-wallet-selector/near-wallet\";import{setupHereWallet}from\"@near-wallet-selector/here-wallet\";import{setupSender}from\"@near-wallet-selector/sender\";import{setupMathWallet}from\"@near-wallet-selector/math-wallet\";import{setupNightly}from\"@near-wallet-selector/nightly\";import{setupMeteorWallet}from\"@near-wallet-selector/meteor-wallet\";import{setupWelldoneWallet}from\"@near-wallet-selector/welldone-wallet\";import{setupNightlyConnect}from\"@near-wallet-selector/nightly-connect\";import{setupNearFi}from\"@near-wallet-selector/nearfi\";// import { setupWalletConnect } from \"@near-wallet-selector/wallet-connect\";\nimport{setupCoin98Wallet}from\"@near-wallet-selector/coin98-wallet\";import{setupNeth}from\"@near-wallet-selector/neth\";import{setupOptoWallet}from\"@near-wallet-selector/opto-wallet\";// import { CONTRACT_ID } from \"../constants\";\nimport{jsx as _jsx}from\"react/jsx-runtime\";var CONTRACT_ID=\"tonana.near\";var WalletSelectorContext=/*#__PURE__*/React.createContext(null);export var WalletSelectorContextProvider=function WalletSelectorContextProvider(_ref){var _accounts$find;var children=_ref.children;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),selector=_useState2[0],setSelector=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),modal=_useState4[0],setModal=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),accounts=_useState6[0],setAccounts=_useState6[1];var init=useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var _selector,_modal,state;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.t0=setupWalletSelector;_context.t1=[];_context.t2=_toConsumableArray;_context.next=5;return setupDefaultWallets();case 5:_context.t3=_context.sent;_context.t4=(0,_context.t2)(_context.t3);_context.t5=[setupNearWallet(),setupSender(),setupMathWallet(),setupNightly(),setupMeteorWallet(),setupWelldoneWallet(),setupHereWallet(),setupCoin98Wallet(),setupNearFi(),setupNeth({gas:\"300000000000000\",bundle:false}),setupOptoWallet(),// setupWalletConnect({\n// \tprojectId: \"c4f79cc...\",\n// \tmetadata: {\n// \t\tname: \"NEAR Wallet Selector\",\n// \t\tdescription: \"Example dApp used by NEAR Wallet Selector\",\n// \t\turl: \"https://github.com/near/wallet-selector\",\n// \t\ticons: [\"https://avatars.githubusercontent.com/u/37784886\"],\n// \t},\n// }),\nsetupNightlyConnect({url:\"wss://relay.nightly.app/app\",appMetadata:{additionalInfo:\"\",application:\"NEAR Wallet Selector\",description:\"Example dApp used by NEAR Wallet Selector\",icon:\"https://near.org/wp-content/uploads/2020/09/cropped-favicon-192x192.png\"}})];_context.t6=_context.t1.concat.call(_context.t1,_context.t4,_context.t5);_context.t7={network:\"testnet\",debug:true,modules:_context.t6};_context.next=12;return(0,_context.t0)(_context.t7);case 12:_selector=_context.sent;_modal=setupModal(_selector,{contractId:CONTRACT_ID});state=_selector.store.getState();setAccounts(state.accounts);window.selector=_selector;window.modal=_modal;setSelector(_selector);setModal(_modal);case 20:case\"end\":return _context.stop();}}},_callee);})),[]);useEffect(function(){init().catch(function(err){console.error(err);alert(\"Failed to initialise wallet selector\");});},[init]);useEffect(function(){if(!selector){return;}var subscription=selector.store.observable.pipe(map(function(state){return state.accounts;}),distinctUntilChanged()).subscribe(function(nextAccounts){console.log(\"Accounts Update\",nextAccounts);setAccounts(nextAccounts);});return function(){return subscription.unsubscribe();};},[selector]);if(!selector||!modal){return null;}var accountId=((_accounts$find=accounts.find(function(account){return account.active;}))===null||_accounts$find===void 0?void 0:_accounts$find.accountId)||null;return/*#__PURE__*/_jsx(WalletSelectorContext.Provider,{value:{selector:selector,modal:modal,accounts:accounts,accountId:accountId},children:children});};export function useWalletSelector(){var context=useContext(WalletSelectorContext);if(!context){throw new Error(\"useWalletSelector must be used within a WalletSelectorContextProvider\");}return context;}","map":{"version":3,"names":["React","useCallback","useContext","useEffect","useState","map","distinctUntilChanged","setupWalletSelector","setupModal","setupDefaultWallets","setupNearWallet","setupHereWallet","setupSender","setupMathWallet","setupNightly","setupMeteorWallet","setupWelldoneWallet","setupNightlyConnect","setupNearFi","setupCoin98Wallet","setupNeth","setupOptoWallet","CONTRACT_ID","WalletSelectorContext","createContext","WalletSelectorContextProvider","children","selector","setSelector","modal","setModal","accounts","setAccounts","init","gas","bundle","url","appMetadata","additionalInfo","application","description","icon","network","debug","modules","_selector","_modal","contractId","state","store","getState","window","catch","err","console","error","alert","subscription","observable","pipe","subscribe","nextAccounts","log","unsubscribe","accountId","find","account","active","useWalletSelector","context","Error"],"sources":["/Users/sepezho/Work/tonana/fe/src/contexts/WalletSelectorContext.tsx"],"sourcesContent":["import type { ReactNode } from \"react\";\nimport React, { useCallback, useContext, useEffect, useState } from \"react\";\nimport { map, distinctUntilChanged } from \"rxjs\";\nimport { setupWalletSelector } from \"@near-wallet-selector/core\";\nimport type { WalletSelector, AccountState } from \"@near-wallet-selector/core\";\nimport { setupModal } from \"@near-wallet-selector/modal-ui\";\nimport type { WalletSelectorModal } from \"@near-wallet-selector/modal-ui\";\nimport { setupDefaultWallets } from \"@near-wallet-selector/default-wallets\";\nimport { setupNearWallet } from \"@near-wallet-selector/near-wallet\";\nimport { setupHereWallet } from \"@near-wallet-selector/here-wallet\";\nimport { setupSender } from \"@near-wallet-selector/sender\";\nimport { setupMathWallet } from \"@near-wallet-selector/math-wallet\";\nimport { setupNightly } from \"@near-wallet-selector/nightly\";\nimport { setupMeteorWallet } from \"@near-wallet-selector/meteor-wallet\";\nimport { setupWelldoneWallet } from \"@near-wallet-selector/welldone-wallet\";\nimport { setupNightlyConnect } from \"@near-wallet-selector/nightly-connect\";\nimport { setupNearFi } from \"@near-wallet-selector/nearfi\";\n// import { setupWalletConnect } from \"@near-wallet-selector/wallet-connect\";\nimport { setupCoin98Wallet } from \"@near-wallet-selector/coin98-wallet\";\nimport { setupNeth } from \"@near-wallet-selector/neth\";\nimport { setupOptoWallet } from \"@near-wallet-selector/opto-wallet\";\n// import { CONTRACT_ID } from \"../constants\";\nconst CONTRACT_ID = \"tonana.near\";\ndeclare global {\n\tinterface Window {\n\t\tselector: WalletSelector;\n\t\tmodal: WalletSelectorModal;\n\t}\n}\n\ninterface WalletSelectorContextValue {\n\tselector: WalletSelector;\n\tmodal: WalletSelectorModal;\n\taccounts: Array<AccountState>;\n\taccountId: string | null;\n}\n\nconst WalletSelectorContext =\n\tReact.createContext<WalletSelectorContextValue | null>(null);\n\nexport const WalletSelectorContextProvider: React.FC<{\n\tchildren: ReactNode;\n}> = ({ children }) => {\n\tconst [selector, setSelector] = useState<WalletSelector | null>(null);\n\tconst [modal, setModal] = useState<WalletSelectorModal | null>(null);\n\tconst [accounts, setAccounts] = useState<Array<AccountState>>([]);\n\n\tconst init = useCallback(async () => {\n\t\tconst _selector = await setupWalletSelector({\n\t\t\tnetwork: \"testnet\",\n\t\t\tdebug: true,\n\t\t\tmodules: [\n\t\t\t\t...(await setupDefaultWallets()),\n\t\t\t\tsetupNearWallet(),\n\t\t\t\tsetupSender(),\n\t\t\t\tsetupMathWallet(),\n\t\t\t\tsetupNightly(),\n\t\t\t\tsetupMeteorWallet(),\n\t\t\t\tsetupWelldoneWallet(),\n\t\t\t\tsetupHereWallet(),\n\t\t\t\tsetupCoin98Wallet(),\n\t\t\t\tsetupNearFi(),\n\t\t\t\tsetupNeth({\n\t\t\t\t\tgas: \"300000000000000\",\n\t\t\t\t\tbundle: false,\n\t\t\t\t}),\n\t\t\t\tsetupOptoWallet(),\n\t\t\t\t// setupWalletConnect({\n\t\t\t\t// \tprojectId: \"c4f79cc...\",\n\t\t\t\t// \tmetadata: {\n\t\t\t\t// \t\tname: \"NEAR Wallet Selector\",\n\t\t\t\t// \t\tdescription: \"Example dApp used by NEAR Wallet Selector\",\n\t\t\t\t// \t\turl: \"https://github.com/near/wallet-selector\",\n\t\t\t\t// \t\ticons: [\"https://avatars.githubusercontent.com/u/37784886\"],\n\t\t\t\t// \t},\n\t\t\t\t// }),\n\t\t\t\tsetupNightlyConnect({\n\t\t\t\t\turl: \"wss://relay.nightly.app/app\",\n\t\t\t\t\tappMetadata: {\n\t\t\t\t\t\tadditionalInfo: \"\",\n\t\t\t\t\t\tapplication: \"NEAR Wallet Selector\",\n\t\t\t\t\t\tdescription: \"Example dApp used by NEAR Wallet Selector\",\n\t\t\t\t\t\ticon: \"https://near.org/wp-content/uploads/2020/09/cropped-favicon-192x192.png\",\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t],\n\t\t});\n\t\tconst _modal = setupModal(_selector, { contractId: CONTRACT_ID });\n\t\tconst state = _selector.store.getState();\n\t\tsetAccounts(state.accounts);\n\n\t\twindow.selector = _selector;\n\t\twindow.modal = _modal;\n\n\t\tsetSelector(_selector);\n\t\tsetModal(_modal);\n\t}, []);\n\n\tuseEffect(() => {\n\t\tinit().catch((err) => {\n\t\t\tconsole.error(err);\n\t\t\talert(\"Failed to initialise wallet selector\");\n\t\t});\n\t}, [init]);\n\n\tuseEffect(() => {\n\t\tif (!selector) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst subscription = selector.store.observable\n\t\t\t.pipe(\n\t\t\t\tmap((state) => state.accounts),\n\t\t\t\tdistinctUntilChanged()\n\t\t\t)\n\t\t\t.subscribe((nextAccounts) => {\n\t\t\t\tconsole.log(\"Accounts Update\", nextAccounts);\n\n\t\t\t\tsetAccounts(nextAccounts);\n\t\t\t});\n\n\t\treturn () => subscription.unsubscribe();\n\t}, [selector]);\n\n\tif (!selector || !modal) {\n\t\treturn null;\n\t}\n\n\tconst accountId =\n\t\taccounts.find((account) => account.active)?.accountId || null;\n\n\treturn (\n\t\t<WalletSelectorContext.Provider\n\t\t\tvalue={{\n\t\t\t\tselector,\n\t\t\t\tmodal,\n\t\t\t\taccounts,\n\t\t\t\taccountId,\n\t\t\t}}>\n\t\t\t{children}\n\t\t</WalletSelectorContext.Provider>\n\t);\n};\n\nexport function useWalletSelector() {\n\tconst context = useContext(WalletSelectorContext);\n\n\tif (!context) {\n\t\tthrow new Error(\n\t\t\t\"useWalletSelector must be used within a WalletSelectorContextProvider\"\n\t\t);\n\t}\n\n\treturn context;\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}