{"ast":null,"code":"\"use strict\";\n\nvar _createForOfIteratorHelper = require(\"/Users/sepezho/Work/tonana/fe/node_modules/@babel/runtime/helpers/createForOfIteratorHelper.js\").default;\nvar _toConsumableArray = require(\"/Users/sepezho/Work/tonana/fe/node_modules/@babel/runtime/helpers/toConsumableArray.js\").default;\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.topologicalSort = void 0;\nfunction topologicalSort(src) {\n  var pending = [src];\n  var allCells = new Map();\n  var notPermCells = new Set();\n  var sorted = [];\n  while (pending.length > 0) {\n    var cells = _toConsumableArray(pending);\n    pending = [];\n    var _iterator = _createForOfIteratorHelper(cells),\n      _step;\n    try {\n      for (_iterator.s(); !(_step = _iterator.n()).done;) {\n        var cell = _step.value;\n        var hash = cell.hash().toString('hex');\n        if (allCells.has(hash)) {\n          continue;\n        }\n        notPermCells.add(hash);\n        allCells.set(hash, {\n          cell: cell,\n          refs: cell.refs.map(function (v) {\n            return v.hash().toString('hex');\n          })\n        });\n        var _iterator2 = _createForOfIteratorHelper(cell.refs),\n          _step2;\n        try {\n          for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n            var r = _step2.value;\n            pending.push(r);\n          }\n        } catch (err) {\n          _iterator2.e(err);\n        } finally {\n          _iterator2.f();\n        }\n      }\n    } catch (err) {\n      _iterator.e(err);\n    } finally {\n      _iterator.f();\n    }\n  }\n  var tempMark = new Set();\n  function visit(hash) {\n    if (!notPermCells.has(hash)) {\n      return;\n    }\n    if (tempMark.has(hash)) {\n      throw Error('Not a DAG');\n    }\n    tempMark.add(hash);\n    var _iterator3 = _createForOfIteratorHelper(allCells.get(hash).refs),\n      _step3;\n    try {\n      for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {\n        var c = _step3.value;\n        visit(c);\n      }\n    } catch (err) {\n      _iterator3.e(err);\n    } finally {\n      _iterator3.f();\n    }\n    sorted.unshift(hash);\n    tempMark.delete(hash);\n    notPermCells.delete(hash);\n  }\n  while (notPermCells.size > 0) {\n    var id = Array.from(notPermCells)[0];\n    visit(id);\n  }\n  var indexes = new Map();\n  for (var i = 0; i < sorted.length; i++) {\n    indexes.set(sorted[i], i);\n  }\n  var result = [];\n  for (var _i = 0, _sorted = sorted; _i < _sorted.length; _i++) {\n    var ent = _sorted[_i];\n    var rrr = allCells.get(ent);\n    result.push({\n      cell: rrr.cell,\n      refs: rrr.refs.map(function (v) {\n        return indexes.get(v);\n      })\n    });\n  }\n  return result;\n}\nexports.topologicalSort = topologicalSort;","map":{"version":3,"names":["Object","defineProperty","exports","value","topologicalSort","src","pending","allCells","Map","notPermCells","Set","sorted","length","cells","cell","hash","toString","has","add","set","refs","map","v","r","push","tempMark","visit","Error","get","c","unshift","delete","size","id","Array","from","indexes","i","result","ent","rrr"],"sources":["/Users/sepezho/Work/tonana/fe/node_modules/ton/dist/boc/utils/topologicalSort.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.topologicalSort = void 0;\nfunction topologicalSort(src) {\n    let pending = [src];\n    let allCells = new Map();\n    let notPermCells = new Set();\n    let sorted = [];\n    while (pending.length > 0) {\n        const cells = [...pending];\n        pending = [];\n        for (let cell of cells) {\n            const hash = cell.hash().toString('hex');\n            if (allCells.has(hash)) {\n                continue;\n            }\n            notPermCells.add(hash);\n            allCells.set(hash, { cell: cell, refs: cell.refs.map((v) => v.hash().toString('hex')) });\n            for (let r of cell.refs) {\n                pending.push(r);\n            }\n        }\n    }\n    let tempMark = new Set();\n    function visit(hash) {\n        if (!notPermCells.has(hash)) {\n            return;\n        }\n        if (tempMark.has(hash)) {\n            throw Error('Not a DAG');\n        }\n        tempMark.add(hash);\n        for (let c of allCells.get(hash).refs) {\n            visit(c);\n        }\n        sorted.unshift(hash);\n        tempMark.delete(hash);\n        notPermCells.delete(hash);\n    }\n    while (notPermCells.size > 0) {\n        const id = Array.from(notPermCells)[0];\n        visit(id);\n    }\n    let indexes = new Map();\n    for (let i = 0; i < sorted.length; i++) {\n        indexes.set(sorted[i], i);\n    }\n    let result = [];\n    for (let ent of sorted) {\n        const rrr = allCells.get(ent);\n        result.push({ cell: rrr.cell, refs: rrr.refs.map((v) => indexes.get(v)) });\n    }\n    return result;\n}\nexports.topologicalSort = topologicalSort;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}