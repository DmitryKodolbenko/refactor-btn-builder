{"ast":null,"code":"import _regeneratorRuntime from\"/Users/sepezho/Work/tonana/fe/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/sepezho/Work/tonana/fe/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import{message}from\"antd\";import{utils,transactions}from'near-api-js';import TonWeb from\"tonweb\";var axios=require(\"axios\").default;var MakeNEARTrx=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(activeBtn,setIsload,NEARwalletKey,amount,walletTo,netTo,hexString,openData,add,params){return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!activeBtn){_context.next=6;break;}setIsload(true);//@ts-ignore\n_context.next=4;return window.contract.account._signAndSendTransaction({receiverId:process.env.REACT_APP_NEAR_CONTRACT,actions:[transactions.functionCall('payToWallet',{target:process.env.REACT_APP_BACK_NEAR_WALLET,message:\"\".concat(openData?\"SM#\":\"\").concat(netTo,\"#\").concat(openData?add:walletTo).concat(openData?\"#\".concat(btoa(params)):\"\")},new TonWeb.utils.BN(40000000000000),new TonWeb.utils.BN(utils.format.parseNearAmount(amount)+''))],walletCallbackUrl:'https://app.tonana.org/?isnear=true'});case 4:_context.next=7;break;case 6:message.error(\"Fill all forms and connect wallets!\",10);case 7:case\"end\":return _context.stop();}}},_callee);}));return function MakeNEARTrx(_x,_x2,_x3,_x4,_x5,_x6,_x7,_x8,_x9,_x10){return _ref.apply(this,arguments);};}();export var makeNEARTrxAfterLoad=function makeNEARTrxAfterLoad(transactionHashes,setSearchParams,searchParams){if(transactionHashes){fetch(process.env.REACT_APP_STATE===\"dev\"?\"http://localhost:8092\":process.env.REACT_APP_STATE===\"dev-remote\"?\"https://dev.api.tonana.org\":\"https://api.tonana.org/\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({hash:transactionHashes,sourceChain:\"near\"})}).then(function(e){return e.text();}).then(function(e){if(e===\"Done!\"){searchParams.delete(\"transactionHashes\");searchParams.delete(\"isnear\");setSearchParams(searchParams);}});}};export default MakeNEARTrx;","map":{"version":3,"names":["message","utils","transactions","TonWeb","axios","require","default","MakeNEARTrx","activeBtn","setIsload","NEARwalletKey","amount","walletTo","netTo","hexString","openData","add","params","window","contract","account","_signAndSendTransaction","receiverId","process","env","REACT_APP_NEAR_CONTRACT","actions","functionCall","target","REACT_APP_BACK_NEAR_WALLET","btoa","BN","format","parseNearAmount","walletCallbackUrl","error","makeNEARTrxAfterLoad","transactionHashes","setSearchParams","searchParams","fetch","REACT_APP_STATE","method","headers","body","JSON","stringify","hash","sourceChain","then","e","text","delete"],"sources":["/Users/sepezho/Work/tonana/fe/src/logic/transaction/MakeNEARTrx.ts"],"sourcesContent":["import { message } from \"antd\";\nimport { connect,Contract, utils,transactions, keyStores, WalletConnection } from 'near-api-js';\nimport TonWeb from \"tonweb\";\nconst axios = require(\"axios\").default;\n\nconst MakeNEARTrx = async (activeBtn: any, setIsload: any, NEARwalletKey: string, amount: any, walletTo: any, netTo: string, hexString: any, openData: boolean, add: string, params: string) => {\n  if (activeBtn) {\n    setIsload(true);\n    //@ts-ignore\n    await window.contract.account._signAndSendTransaction({\n      receiverId: process.env.REACT_APP_NEAR_CONTRACT,\n      actions: [\n        transactions.functionCall(\n          'payToWallet',\n          {\n            target: process.env.REACT_APP_BACK_NEAR_WALLET,\n            message: `${openData ? \"SM#\" : \"\"}${netTo}#${openData? add : walletTo}${openData ? `#${btoa(params)}` : \"\"}`\n          },\n          new TonWeb.utils.BN(40000000000000),\n          new TonWeb.utils.BN(utils.format.parseNearAmount(amount)+'')\n        )\n      ],\n      walletCallbackUrl: 'https://app.tonana.org/?isnear=true'\n    })\n\n  } else {\n    message.error(\"Fill all forms and connect wallets!\", 10);\n  }\n};\n\nexport const makeNEARTrxAfterLoad = (transactionHashes: any, setSearchParams:any,searchParams: any) => {\n  if (transactionHashes) {\n    fetch(process.env.REACT_APP_STATE === \"dev\" ? \"http://localhost:8092\" : process.env.REACT_APP_STATE === \"dev-remote\" ? \"https://dev.api.tonana.org\"   : \"https://api.tonana.org/\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({\n        hash: transactionHashes,\n        sourceChain: \"near\",\n      }),\n    })\n      .then((e) => e.text())\n      .then((e) => {\n        if (e === \"Done!\") {\n          searchParams.delete(\"transactionHashes\");\n          searchParams.delete(\"isnear\");\n          setSearchParams(searchParams);\n        }\n      });\n    }\n  }\n\nexport default MakeNEARTrx"],"mappings":"sPAAA,OAASA,OAAO,KAAQ,MAAM,CAC9B,OAA2BC,KAAK,CAACC,YAAY,KAAqC,aAAa,CAC/F,MAAOC,OAAM,KAAM,QAAQ,CAC3B,GAAMC,MAAK,CAAGC,OAAO,CAAC,OAAO,CAAC,CAACC,OAAO,CAEtC,GAAMC,YAAW,4FAAG,iBAAOC,SAAc,CAAEC,SAAc,CAAEC,aAAqB,CAAEC,MAAW,CAAEC,QAAa,CAAEC,KAAa,CAAEC,SAAc,CAAEC,QAAiB,CAAEC,GAAW,CAAEC,MAAc,wHACrLT,SAAS,yBACXC,SAAS,CAAC,IAAI,CAAC,CACf;AAAA,sBACMS,OAAM,CAACC,QAAQ,CAACC,OAAO,CAACC,uBAAuB,CAAC,CACpDC,UAAU,CAAEC,OAAO,CAACC,GAAG,CAACC,uBAAuB,CAC/CC,OAAO,CAAE,CACPxB,YAAY,CAACyB,YAAY,CACvB,aAAa,CACb,CACEC,MAAM,CAAEL,OAAO,CAACC,GAAG,CAACK,0BAA0B,CAC9C7B,OAAO,WAAKe,QAAQ,CAAG,KAAK,CAAG,EAAE,SAAGF,KAAK,aAAIE,QAAQ,CAAEC,GAAG,CAAGJ,QAAQ,SAAGG,QAAQ,YAAOe,IAAI,CAACb,MAAM,CAAC,EAAK,EAAE,CAC5G,CAAC,CACD,GAAId,OAAM,CAACF,KAAK,CAAC8B,EAAE,CAAC,cAAc,CAAC,CACnC,GAAI5B,OAAM,CAACF,KAAK,CAAC8B,EAAE,CAAC9B,KAAK,CAAC+B,MAAM,CAACC,eAAe,CAACtB,MAAM,CAAC,CAAC,EAAE,CAAC,CAC7D,CACF,CACDuB,iBAAiB,CAAE,qCACrB,CAAC,CAAC,qCAGFlC,OAAO,CAACmC,KAAK,CAAC,qCAAqC,CAAE,EAAE,CAAC,CAAC,sDAE5D,kBAvBK5B,YAAW,iFAuBhB,CAED,MAAO,IAAM6B,qBAAoB,CAAG,QAAvBA,qBAAoB,CAAIC,iBAAsB,CAAEC,eAAmB,CAACC,YAAiB,CAAK,CACrG,GAAIF,iBAAiB,CAAE,CACrBG,KAAK,CAACjB,OAAO,CAACC,GAAG,CAACiB,eAAe,GAAK,KAAK,CAAG,uBAAuB,CAAGlB,OAAO,CAACC,GAAG,CAACiB,eAAe,GAAK,YAAY,CAAG,4BAA4B,CAAK,yBAAyB,CAAE,CACjLC,MAAM,CAAE,MAAM,CACdC,OAAO,CAAE,CAAE,cAAc,CAAE,kBAAmB,CAAC,CAC/CC,IAAI,CAAEC,IAAI,CAACC,SAAS,CAAC,CACnBC,IAAI,CAAEV,iBAAiB,CACvBW,WAAW,CAAE,MACf,CAAC,CACH,CAAC,CAAC,CACCC,IAAI,CAAC,SAACC,CAAC,QAAKA,EAAC,CAACC,IAAI,EAAE,GAAC,CACrBF,IAAI,CAAC,SAACC,CAAC,CAAK,CACX,GAAIA,CAAC,GAAK,OAAO,CAAE,CACjBX,YAAY,CAACa,MAAM,CAAC,mBAAmB,CAAC,CACxCb,YAAY,CAACa,MAAM,CAAC,QAAQ,CAAC,CAC7Bd,eAAe,CAACC,YAAY,CAAC,CAC/B,CACF,CAAC,CAAC,CACJ,CACF,CAAC,CAEH,cAAehC,YAAW"},"metadata":{},"sourceType":"module"}