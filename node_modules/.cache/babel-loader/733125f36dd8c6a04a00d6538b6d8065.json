{"ast":null,"code":"'use strict';\n\nvar _toConsumableArray = require(\"/Users/sepezho/Work/tonana/fe/node_modules/@babel/runtime/helpers/toConsumableArray.js\").default;\nvar _createForOfIteratorHelper = require(\"/Users/sepezho/Work/tonana/fe/node_modules/@babel/runtime/helpers/createForOfIteratorHelper.js\").default;\nvar _objectSpread = require(\"/Users/sepezho/Work/tonana/fe/node_modules/@babel/runtime/helpers/objectSpread2.js\").default;\nvar _regeneratorRuntime = require(\"/Users/sepezho/Work/tonana/fe/node_modules/@babel/runtime/helpers/regeneratorRuntime.js\").default;\nvar _asyncToGenerator = require(\"/Users/sepezho/Work/tonana/fe/node_modules/@babel/runtime/helpers/asyncToGenerator.js\").default;\nvar _classCallCheck = require(\"/Users/sepezho/Work/tonana/fe/node_modules/@babel/runtime/helpers/classCallCheck.js\").default;\nvar _createClass = require(\"/Users/sepezho/Work/tonana/fe/node_modules/@babel/runtime/helpers/createClass.js\").default;\nvar _get = require(\"/Users/sepezho/Work/tonana/fe/node_modules/@babel/runtime/helpers/get.js\").default;\nvar _getPrototypeOf = require(\"/Users/sepezho/Work/tonana/fe/node_modules/@babel/runtime/helpers/getPrototypeOf.js\").default;\nvar _inherits = require(\"/Users/sepezho/Work/tonana/fe/node_modules/@babel/runtime/helpers/inherits.js\").default;\nvar _createSuper = require(\"/Users/sepezho/Work/tonana/fe/node_modules/@babel/runtime/helpers/createSuper.js\").default;\nvar _defineProperty = require(\"/Users/sepezho/Work/tonana/fe/node_modules/@babel/runtime/helpers/defineProperty.js\").default;\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Account2FA = exports.AccountMultisig = exports.MultisigStateStatus = exports.MultisigDeleteRequestRejectionError = exports.MULTISIG_CONFIRM_METHODS = exports.MULTISIG_CHANGE_METHODS = exports.MULTISIG_DEPOSIT = exports.MULTISIG_GAS = exports.MULTISIG_ALLOWANCE = exports.MULTISIG_STORAGE_KEY = void 0;\nvar bn_js_1 = __importDefault(require(\"bn.js\"));\nvar depd_1 = __importDefault(require(\"depd\"));\nvar account_1 = require(\"./account\");\nvar format_1 = require(\"./utils/format\");\nvar key_pair_1 = require(\"./utils/key_pair\");\nvar transaction_1 = require(\"./transaction\");\nvar providers_1 = require(\"./providers\");\nvar web_1 = require(\"./utils/web\");\nexports.MULTISIG_STORAGE_KEY = '__multisigRequest';\nexports.MULTISIG_ALLOWANCE = new bn_js_1.default(format_1.parseNearAmount('1'));\n// TODO: Different gas value for different requests (can reduce gas usage dramatically)\nexports.MULTISIG_GAS = new bn_js_1.default('100000000000000');\nexports.MULTISIG_DEPOSIT = new bn_js_1.default('0');\nexports.MULTISIG_CHANGE_METHODS = ['add_request', 'add_request_and_confirm', 'delete_request', 'confirm'];\nexports.MULTISIG_CONFIRM_METHODS = ['confirm'];\nvar MultisigDeleteRequestRejectionError;\n(function (MultisigDeleteRequestRejectionError) {\n  MultisigDeleteRequestRejectionError[\"CANNOT_DESERIALIZE_STATE\"] = \"Cannot deserialize the contract state\";\n  MultisigDeleteRequestRejectionError[\"MULTISIG_NOT_INITIALIZED\"] = \"Smart contract panicked: Multisig contract should be initialized before usage\";\n  MultisigDeleteRequestRejectionError[\"NO_SUCH_REQUEST\"] = \"Smart contract panicked: panicked at 'No such request: either wrong number or already confirmed'\";\n  MultisigDeleteRequestRejectionError[\"REQUEST_COOLDOWN_ERROR\"] = \"Request cannot be deleted immediately after creation.\";\n  MultisigDeleteRequestRejectionError[\"METHOD_NOT_FOUND\"] = \"Contract method is not found\";\n})(MultisigDeleteRequestRejectionError = exports.MultisigDeleteRequestRejectionError || (exports.MultisigDeleteRequestRejectionError = {}));\n;\nvar MultisigStateStatus;\n(function (MultisigStateStatus) {\n  MultisigStateStatus[MultisigStateStatus[\"INVALID_STATE\"] = 0] = \"INVALID_STATE\";\n  MultisigStateStatus[MultisigStateStatus[\"STATE_NOT_INITIALIZED\"] = 1] = \"STATE_NOT_INITIALIZED\";\n  MultisigStateStatus[MultisigStateStatus[\"VALID_STATE\"] = 2] = \"VALID_STATE\";\n  MultisigStateStatus[MultisigStateStatus[\"UNKNOWN_STATE\"] = 3] = \"UNKNOWN_STATE\";\n})(MultisigStateStatus = exports.MultisigStateStatus || (exports.MultisigStateStatus = {}));\nvar MultisigCodeStatus;\n(function (MultisigCodeStatus) {\n  MultisigCodeStatus[MultisigCodeStatus[\"INVALID_CODE\"] = 0] = \"INVALID_CODE\";\n  MultisigCodeStatus[MultisigCodeStatus[\"VALID_CODE\"] = 1] = \"VALID_CODE\";\n  MultisigCodeStatus[MultisigCodeStatus[\"UNKNOWN_CODE\"] = 2] = \"UNKNOWN_CODE\";\n})(MultisigCodeStatus || (MultisigCodeStatus = {}));\n// in memory request cache for node w/o localStorage\nvar storageFallback = _defineProperty({}, exports.MULTISIG_STORAGE_KEY, null);\nvar AccountMultisig = /*#__PURE__*/function (_account_1$Account) {\n  _inherits(AccountMultisig, _account_1$Account);\n  var _super = _createSuper(AccountMultisig);\n  function AccountMultisig(connection, accountId, options) {\n    var _this;\n    _classCallCheck(this, AccountMultisig);\n    _this = _super.call(this, connection, accountId);\n    _this.storage = options.storage;\n    _this.onAddRequestResult = options.onAddRequestResult;\n    return _this;\n  }\n  _createClass(AccountMultisig, [{\n    key: \"signAndSendTransactionWithAccount\",\n    value: function () {\n      var _signAndSendTransactionWithAccount = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(receiverId, actions) {\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                return _context.abrupt(\"return\", _get(_getPrototypeOf(AccountMultisig.prototype), \"signAndSendTransaction\", this).call(this, {\n                  receiverId: receiverId,\n                  actions: actions\n                }));\n              case 1:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n      function signAndSendTransactionWithAccount(_x, _x2) {\n        return _signAndSendTransactionWithAccount.apply(this, arguments);\n      }\n      return signAndSendTransactionWithAccount;\n    }()\n  }, {\n    key: \"signAndSendTransaction\",\n    value: function signAndSendTransaction() {\n      if (typeof (arguments.length <= 0 ? undefined : arguments[0]) === 'string') {\n        return this._signAndSendTransaction({\n          receiverId: arguments.length <= 0 ? undefined : arguments[0],\n          actions: arguments.length <= 1 ? undefined : arguments[1]\n        });\n      }\n      return this._signAndSendTransaction(arguments.length <= 0 ? undefined : arguments[0]);\n    }\n  }, {\n    key: \"_signAndSendTransaction\",\n    value: function () {\n      var _signAndSendTransaction2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2(_ref) {\n        var receiverId, actions, accountId, args, result, status;\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                receiverId = _ref.receiverId, actions = _ref.actions;\n                accountId = this.accountId;\n                args = Buffer.from(JSON.stringify({\n                  request: {\n                    receiver_id: receiverId,\n                    actions: convertActions(actions, accountId, receiverId)\n                  }\n                }));\n                _context2.prev = 3;\n                _context2.next = 6;\n                return _get(_getPrototypeOf(AccountMultisig.prototype), \"signAndSendTransaction\", this).call(this, {\n                  receiverId: accountId,\n                  actions: [transaction_1.functionCall('add_request_and_confirm', args, exports.MULTISIG_GAS, exports.MULTISIG_DEPOSIT)]\n                });\n              case 6:\n                result = _context2.sent;\n                _context2.next = 18;\n                break;\n              case 9:\n                _context2.prev = 9;\n                _context2.t0 = _context2[\"catch\"](3);\n                if (!_context2.t0.toString().includes('Account has too many active requests. Confirm or delete some')) {\n                  _context2.next = 17;\n                  break;\n                }\n                _context2.next = 14;\n                return this.deleteUnconfirmedRequests();\n              case 14:\n                _context2.next = 16;\n                return this.signAndSendTransaction(receiverId, actions);\n              case 16:\n                return _context2.abrupt(\"return\", _context2.sent);\n              case 17:\n                throw _context2.t0;\n              case 18:\n                if (result.status) {\n                  _context2.next = 20;\n                  break;\n                }\n                throw new Error('Request failed');\n              case 20:\n                status = _objectSpread({}, result.status);\n                if (!(!status.SuccessValue || typeof status.SuccessValue !== 'string')) {\n                  _context2.next = 23;\n                  break;\n                }\n                throw new Error('Request failed');\n              case 23:\n                this.setRequest({\n                  accountId: accountId,\n                  actions: actions,\n                  requestId: parseInt(Buffer.from(status.SuccessValue, 'base64').toString('ascii'), 10)\n                });\n                if (!this.onAddRequestResult) {\n                  _context2.next = 27;\n                  break;\n                }\n                _context2.next = 27;\n                return this.onAddRequestResult(result);\n              case 27:\n                // NOTE there is no await on purpose to avoid blocking for 2fa\n                this.deleteUnconfirmedRequests();\n                return _context2.abrupt(\"return\", result);\n              case 29:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this, [[3, 9]]);\n      }));\n      function _signAndSendTransaction(_x3) {\n        return _signAndSendTransaction2.apply(this, arguments);\n      }\n      return _signAndSendTransaction;\n    }()\n    /*\n     * This method submits a canary transaction that is expected to always fail in order to determine whether the contract currently has valid multisig state\n     * and whether it is initialized. The canary transaction attempts to delete a request at index u32_max and will go through if a request exists at that index.\n     * a u32_max + 1 and -1 value cannot be used for the canary due to expected u32 error thrown before deserialization attempt.\n     */\n  }, {\n    key: \"checkMultisigCodeAndStateStatus\",\n    value: function () {\n      var _checkMultisigCodeAndStateStatus = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3(contractBytes) {\n        var u32_max, validCodeStatusIfNoDeploy;\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                u32_max = 4294967295;\n                validCodeStatusIfNoDeploy = contractBytes ? MultisigCodeStatus.UNKNOWN_CODE : MultisigCodeStatus.VALID_CODE;\n                _context3.prev = 2;\n                if (!contractBytes) {\n                  _context3.next = 8;\n                  break;\n                }\n                _context3.next = 6;\n                return _get(_getPrototypeOf(AccountMultisig.prototype), \"signAndSendTransaction\", this).call(this, {\n                  receiverId: this.accountId,\n                  actions: [transaction_1.deployContract(contractBytes), transaction_1.functionCall('delete_request', {\n                    request_id: u32_max\n                  }, exports.MULTISIG_GAS, exports.MULTISIG_DEPOSIT)]\n                });\n              case 6:\n                _context3.next = 10;\n                break;\n              case 8:\n                _context3.next = 10;\n                return this.deleteRequest(u32_max);\n              case 10:\n                return _context3.abrupt(\"return\", {\n                  codeStatus: MultisigCodeStatus.VALID_CODE,\n                  stateStatus: MultisigStateStatus.VALID_STATE\n                });\n              case 13:\n                _context3.prev = 13;\n                _context3.t0 = _context3[\"catch\"](2);\n                if (!new RegExp(MultisigDeleteRequestRejectionError.CANNOT_DESERIALIZE_STATE).test(_context3.t0 && _context3.t0.kind && _context3.t0.kind.ExecutionError)) {\n                  _context3.next = 19;\n                  break;\n                }\n                return _context3.abrupt(\"return\", {\n                  codeStatus: validCodeStatusIfNoDeploy,\n                  stateStatus: MultisigStateStatus.INVALID_STATE\n                });\n              case 19:\n                if (!new RegExp(MultisigDeleteRequestRejectionError.MULTISIG_NOT_INITIALIZED).test(_context3.t0 && _context3.t0.kind && _context3.t0.kind.ExecutionError)) {\n                  _context3.next = 23;\n                  break;\n                }\n                return _context3.abrupt(\"return\", {\n                  codeStatus: validCodeStatusIfNoDeploy,\n                  stateStatus: MultisigStateStatus.STATE_NOT_INITIALIZED\n                });\n              case 23:\n                if (!new RegExp(MultisigDeleteRequestRejectionError.NO_SUCH_REQUEST).test(_context3.t0 && _context3.t0.kind && _context3.t0.kind.ExecutionError)) {\n                  _context3.next = 27;\n                  break;\n                }\n                return _context3.abrupt(\"return\", {\n                  codeStatus: validCodeStatusIfNoDeploy,\n                  stateStatus: MultisigStateStatus.VALID_STATE\n                });\n              case 27:\n                if (!new RegExp(MultisigDeleteRequestRejectionError.METHOD_NOT_FOUND).test(_context3.t0 && _context3.t0.message)) {\n                  _context3.next = 29;\n                  break;\n                }\n                return _context3.abrupt(\"return\", {\n                  codeStatus: MultisigCodeStatus.INVALID_CODE,\n                  stateStatus: MultisigStateStatus.UNKNOWN_STATE\n                });\n              case 29:\n                throw _context3.t0;\n              case 30:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this, [[2, 13]]);\n      }));\n      function checkMultisigCodeAndStateStatus(_x4) {\n        return _checkMultisigCodeAndStateStatus.apply(this, arguments);\n      }\n      return checkMultisigCodeAndStateStatus;\n    }()\n  }, {\n    key: \"deleteRequest\",\n    value: function deleteRequest(request_id) {\n      return _get(_getPrototypeOf(AccountMultisig.prototype), \"signAndSendTransaction\", this).call(this, {\n        receiverId: this.accountId,\n        actions: [transaction_1.functionCall('delete_request', {\n          request_id: request_id\n        }, exports.MULTISIG_GAS, exports.MULTISIG_DEPOSIT)]\n      });\n    }\n  }, {\n    key: \"deleteAllRequests\",\n    value: function () {\n      var _deleteAllRequests = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee4() {\n        var _this2 = this;\n        var request_ids;\n        return _regeneratorRuntime().wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _context4.next = 2;\n                return this.getRequestIds();\n              case 2:\n                request_ids = _context4.sent;\n                if (!request_ids.length) {\n                  _context4.next = 6;\n                  break;\n                }\n                _context4.next = 6;\n                return Promise.all(request_ids.map(function (id) {\n                  return _this2.deleteRequest(id);\n                }));\n              case 6:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n      function deleteAllRequests() {\n        return _deleteAllRequests.apply(this, arguments);\n      }\n      return deleteAllRequests;\n    }()\n  }, {\n    key: \"deleteUnconfirmedRequests\",\n    value: function () {\n      var _deleteUnconfirmedRequests = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee5() {\n        var request_ids, _this$getRequest, requestId, _iterator, _step, requestIdToDelete;\n        return _regeneratorRuntime().wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                _context5.next = 2;\n                return this.getRequestIds();\n              case 2:\n                request_ids = _context5.sent;\n                _this$getRequest = this.getRequest(), requestId = _this$getRequest.requestId;\n                _iterator = _createForOfIteratorHelper(request_ids);\n                _context5.prev = 5;\n                _iterator.s();\n              case 7:\n                if ((_step = _iterator.n()).done) {\n                  _context5.next = 21;\n                  break;\n                }\n                requestIdToDelete = _step.value;\n                if (!(requestIdToDelete == requestId)) {\n                  _context5.next = 11;\n                  break;\n                }\n                return _context5.abrupt(\"continue\", 19);\n              case 11:\n                _context5.prev = 11;\n                _context5.next = 14;\n                return _get(_getPrototypeOf(AccountMultisig.prototype), \"signAndSendTransaction\", this).call(this, {\n                  receiverId: this.accountId,\n                  actions: [transaction_1.functionCall('delete_request', {\n                    request_id: requestIdToDelete\n                  }, exports.MULTISIG_GAS, exports.MULTISIG_DEPOSIT)]\n                });\n              case 14:\n                _context5.next = 19;\n                break;\n              case 16:\n                _context5.prev = 16;\n                _context5.t0 = _context5[\"catch\"](11);\n                console.warn('Attempt to delete an earlier request before 15 minutes failed. Will try again.');\n              case 19:\n                _context5.next = 7;\n                break;\n              case 21:\n                _context5.next = 26;\n                break;\n              case 23:\n                _context5.prev = 23;\n                _context5.t1 = _context5[\"catch\"](5);\n                _iterator.e(_context5.t1);\n              case 26:\n                _context5.prev = 26;\n                _iterator.f();\n                return _context5.finish(26);\n              case 29:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this, [[5, 23, 26, 29], [11, 16]]);\n      }));\n      function deleteUnconfirmedRequests() {\n        return _deleteUnconfirmedRequests.apply(this, arguments);\n      }\n      return deleteUnconfirmedRequests;\n    }() // helpers\n  }, {\n    key: \"getRequestIds\",\n    value: function () {\n      var _getRequestIds = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee6() {\n        return _regeneratorRuntime().wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                return _context6.abrupt(\"return\", this.viewFunction(this.accountId, 'list_request_ids'));\n              case 1:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6, this);\n      }));\n      function getRequestIds() {\n        return _getRequestIds.apply(this, arguments);\n      }\n      return getRequestIds;\n    }()\n  }, {\n    key: \"getRequest\",\n    value: function getRequest() {\n      if (this.storage) {\n        return JSON.parse(this.storage.getItem(exports.MULTISIG_STORAGE_KEY) || '{}');\n      }\n      return storageFallback[exports.MULTISIG_STORAGE_KEY];\n    }\n  }, {\n    key: \"setRequest\",\n    value: function setRequest(data) {\n      if (this.storage) {\n        return this.storage.setItem(exports.MULTISIG_STORAGE_KEY, JSON.stringify(data));\n      }\n      storageFallback[exports.MULTISIG_STORAGE_KEY] = data;\n    }\n  }]);\n  return AccountMultisig;\n}(account_1.Account);\nexports.AccountMultisig = AccountMultisig;\nvar Account2FA = /*#__PURE__*/function (_AccountMultisig) {\n  _inherits(Account2FA, _AccountMultisig);\n  var _super2 = _createSuper(Account2FA);\n  function Account2FA(connection, accountId, options) {\n    var _this3;\n    _classCallCheck(this, Account2FA);\n    _this3 = _super2.call(this, connection, accountId, options);\n    _this3.helperUrl = 'https://helper.testnet.near.org';\n    _this3.helperUrl = options.helperUrl || _this3.helperUrl;\n    _this3.storage = options.storage;\n    _this3.sendCode = options.sendCode || _this3.sendCodeDefault;\n    _this3.getCode = options.getCode || _this3.getCodeDefault;\n    _this3.verifyCode = options.verifyCode || _this3.verifyCodeDefault;\n    _this3.onConfirmResult = options.onConfirmResult;\n    return _this3;\n  }\n  _createClass(Account2FA, [{\n    key: \"signAndSendTransaction\",\n    value: function () {\n      var _signAndSendTransaction3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee7() {\n        var deprecate,\n          _args7 = arguments;\n        return _regeneratorRuntime().wrap(function _callee7$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                if (!(typeof (_args7.length <= 0 ? undefined : _args7[0]) === 'string')) {\n                  _context7.next = 6;\n                  break;\n                }\n                deprecate = depd_1.default('Account.signAndSendTransaction(receiverId, actions');\n                deprecate('use `Account2FA.signAndSendTransaction(SignAndSendTransactionOptions)` instead');\n                return _context7.abrupt(\"return\", this.__signAndSendTransaction({\n                  receiverId: _args7.length <= 0 ? undefined : _args7[0],\n                  actions: _args7.length <= 1 ? undefined : _args7[1]\n                }));\n              case 6:\n                return _context7.abrupt(\"return\", this.__signAndSendTransaction(_args7.length <= 0 ? undefined : _args7[0]));\n              case 7:\n              case \"end\":\n                return _context7.stop();\n            }\n          }\n        }, _callee7, this);\n      }));\n      function signAndSendTransaction() {\n        return _signAndSendTransaction3.apply(this, arguments);\n      }\n      return signAndSendTransaction;\n    }()\n  }, {\n    key: \"__signAndSendTransaction\",\n    value: function () {\n      var _signAndSendTransaction4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee8(_ref2) {\n        var receiverId, actions, result;\n        return _regeneratorRuntime().wrap(function _callee8$(_context8) {\n          while (1) {\n            switch (_context8.prev = _context8.next) {\n              case 0:\n                receiverId = _ref2.receiverId, actions = _ref2.actions;\n                _context8.next = 3;\n                return _get(_getPrototypeOf(Account2FA.prototype), \"signAndSendTransaction\", this).call(this, {\n                  receiverId: receiverId,\n                  actions: actions\n                });\n              case 3:\n                _context8.next = 5;\n                return this.sendCode();\n              case 5:\n                _context8.next = 7;\n                return this.promptAndVerify();\n              case 7:\n                result = _context8.sent;\n                if (!this.onConfirmResult) {\n                  _context8.next = 11;\n                  break;\n                }\n                _context8.next = 11;\n                return this.onConfirmResult(result);\n              case 11:\n                return _context8.abrupt(\"return\", result);\n              case 12:\n              case \"end\":\n                return _context8.stop();\n            }\n          }\n        }, _callee8, this);\n      }));\n      function __signAndSendTransaction(_x5) {\n        return _signAndSendTransaction4.apply(this, arguments);\n      }\n      return __signAndSendTransaction;\n    }() // default helpers for CH deployments of multisig\n  }, {\n    key: \"deployMultisig\",\n    value: function () {\n      var _deployMultisig = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee9(contractBytes) {\n        var accountId, seedOrLedgerKey, fak2lak, confirmOnlyKey, newArgs, actions, newFunctionCallActionBatch, _yield$this$checkMult, multisigStateStatus;\n        return _regeneratorRuntime().wrap(function _callee9$(_context9) {\n          while (1) {\n            switch (_context9.prev = _context9.next) {\n              case 0:\n                accountId = this.accountId;\n                _context9.next = 3;\n                return this.getRecoveryMethods();\n              case 3:\n                seedOrLedgerKey = _context9.sent.data.filter(function (_ref3) {\n                  var kind = _ref3.kind,\n                    publicKey = _ref3.publicKey;\n                  return (kind === 'phrase' || kind === 'ledger') && publicKey !== null;\n                }).map(function (rm) {\n                  return rm.publicKey;\n                });\n                _context9.next = 6;\n                return this.getAccessKeys();\n              case 6:\n                fak2lak = _context9.sent.filter(function (_ref4) {\n                  var public_key = _ref4.public_key,\n                    permission = _ref4.access_key.permission;\n                  return permission === 'FullAccess' && !seedOrLedgerKey.includes(public_key);\n                }).map(function (ak) {\n                  return ak.public_key;\n                }).map(toPK);\n                _context9.t0 = toPK;\n                _context9.next = 10;\n                return this.postSignedJson('/2fa/getAccessKey', {\n                  accountId: accountId\n                });\n              case 10:\n                _context9.t1 = _context9.sent.publicKey;\n                confirmOnlyKey = (0, _context9.t0)(_context9.t1);\n                newArgs = Buffer.from(JSON.stringify({\n                  'num_confirmations': 2\n                }));\n                actions = [].concat(_toConsumableArray(fak2lak.map(function (pk) {\n                  return transaction_1.deleteKey(pk);\n                })), _toConsumableArray(fak2lak.map(function (pk) {\n                  return transaction_1.addKey(pk, transaction_1.functionCallAccessKey(accountId, exports.MULTISIG_CHANGE_METHODS, null));\n                })), [transaction_1.addKey(confirmOnlyKey, transaction_1.functionCallAccessKey(accountId, exports.MULTISIG_CONFIRM_METHODS, null)), transaction_1.deployContract(contractBytes)]);\n                newFunctionCallActionBatch = actions.concat(transaction_1.functionCall('new', newArgs, exports.MULTISIG_GAS, exports.MULTISIG_DEPOSIT));\n                console.log('deploying multisig contract for', accountId);\n                _context9.next = 18;\n                return this.checkMultisigCodeAndStateStatus(contractBytes);\n              case 18:\n                _yield$this$checkMult = _context9.sent;\n                multisigStateStatus = _yield$this$checkMult.stateStatus;\n                _context9.t2 = multisigStateStatus;\n                _context9.next = _context9.t2 === MultisigStateStatus.STATE_NOT_INITIALIZED ? 23 : _context9.t2 === MultisigStateStatus.VALID_STATE ? 26 : _context9.t2 === MultisigStateStatus.INVALID_STATE ? 29 : 30;\n                break;\n              case 23:\n                _context9.next = 25;\n                return _get(_getPrototypeOf(Account2FA.prototype), \"signAndSendTransactionWithAccount\", this).call(this, accountId, newFunctionCallActionBatch);\n              case 25:\n                return _context9.abrupt(\"return\", _context9.sent);\n              case 26:\n                _context9.next = 28;\n                return _get(_getPrototypeOf(Account2FA.prototype), \"signAndSendTransactionWithAccount\", this).call(this, accountId, actions);\n              case 28:\n                return _context9.abrupt(\"return\", _context9.sent);\n              case 29:\n                throw new providers_1.TypedError(\"Can not deploy a contract to account \".concat(this.accountId, \" on network \").concat(this.connection.networkId, \", the account has existing state.\"), 'ContractHasExistingState');\n              case 30:\n                throw new providers_1.TypedError(\"Can not deploy a contract to account \".concat(this.accountId, \" on network \").concat(this.connection.networkId, \", the account state could not be verified.\"), 'ContractStateUnknown');\n              case 31:\n              case \"end\":\n                return _context9.stop();\n            }\n          }\n        }, _callee9, this);\n      }));\n      function deployMultisig(_x6) {\n        return _deployMultisig.apply(this, arguments);\n      }\n      return deployMultisig;\n    }()\n  }, {\n    key: \"disableWithFAK\",\n    value: function () {\n      var _disableWithFAK = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee10(_ref5) {\n        var contractBytes, cleanupContractBytes, cleanupActions, keyConversionActions, actions, accessKeyInfo;\n        return _regeneratorRuntime().wrap(function _callee10$(_context10) {\n          while (1) {\n            switch (_context10.prev = _context10.next) {\n              case 0:\n                contractBytes = _ref5.contractBytes, cleanupContractBytes = _ref5.cleanupContractBytes;\n                cleanupActions = [];\n                if (!cleanupContractBytes) {\n                  _context10.next = 8;\n                  break;\n                }\n                _context10.next = 5;\n                return this.deleteAllRequests().catch(function (e) {\n                  return e;\n                });\n              case 5:\n                _context10.next = 7;\n                return this.get2faDisableCleanupActions(cleanupContractBytes);\n              case 7:\n                cleanupActions = _context10.sent;\n              case 8:\n                _context10.next = 10;\n                return this.get2faDisableKeyConversionActions();\n              case 10:\n                keyConversionActions = _context10.sent;\n                actions = [].concat(_toConsumableArray(cleanupActions), _toConsumableArray(keyConversionActions), [transaction_1.deployContract(contractBytes)]);\n                _context10.next = 14;\n                return this.findAccessKey(this.accountId, actions);\n              case 14:\n                accessKeyInfo = _context10.sent;\n                if (!(accessKeyInfo && accessKeyInfo.accessKey && accessKeyInfo.accessKey.permission !== 'FullAccess')) {\n                  _context10.next = 17;\n                  break;\n                }\n                throw new providers_1.TypedError(\"No full access key found in keystore. Unable to bypass multisig\", 'NoFAKFound');\n              case 17:\n                return _context10.abrupt(\"return\", this.signAndSendTransactionWithAccount(this.accountId, actions));\n              case 18:\n              case \"end\":\n                return _context10.stop();\n            }\n          }\n        }, _callee10, this);\n      }));\n      function disableWithFAK(_x7) {\n        return _disableWithFAK.apply(this, arguments);\n      }\n      return disableWithFAK;\n    }()\n  }, {\n    key: \"get2faDisableCleanupActions\",\n    value: function () {\n      var _get2faDisableCleanupActions = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee11(cleanupContractBytes) {\n        var _this4 = this;\n        var currentAccountState, currentAccountStateKeys;\n        return _regeneratorRuntime().wrap(function _callee11$(_context11) {\n          while (1) {\n            switch (_context11.prev = _context11.next) {\n              case 0:\n                _context11.next = 2;\n                return this.viewState('').catch(function (error) {\n                  var cause = error.cause && error.cause.name;\n                  if (cause == 'NO_CONTRACT_CODE') {\n                    return [];\n                  }\n                  throw cause == 'TOO_LARGE_CONTRACT_STATE' ? new providers_1.TypedError(\"Can not deploy a contract to account \".concat(_this4.accountId, \" on network \").concat(_this4.connection.networkId, \", the account has existing state.\"), 'ContractHasExistingState') : error;\n                });\n              case 2:\n                currentAccountState = _context11.sent;\n                currentAccountStateKeys = currentAccountState.map(function (_ref6) {\n                  var key = _ref6.key;\n                  return key.toString('base64');\n                });\n                return _context11.abrupt(\"return\", currentAccountState.length ? [transaction_1.deployContract(cleanupContractBytes), transaction_1.functionCall('clean', {\n                  keys: currentAccountStateKeys\n                }, exports.MULTISIG_GAS, new bn_js_1.default('0'))] : []);\n              case 5:\n              case \"end\":\n                return _context11.stop();\n            }\n          }\n        }, _callee11, this);\n      }));\n      function get2faDisableCleanupActions(_x8) {\n        return _get2faDisableCleanupActions.apply(this, arguments);\n      }\n      return get2faDisableCleanupActions;\n    }()\n  }, {\n    key: \"get2faDisableKeyConversionActions\",\n    value: function () {\n      var _get2faDisableKeyConversionActions = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee12() {\n        var accountId, accessKeys, lak2fak, confirmOnlyKey;\n        return _regeneratorRuntime().wrap(function _callee12$(_context12) {\n          while (1) {\n            switch (_context12.prev = _context12.next) {\n              case 0:\n                accountId = this.accountId;\n                _context12.next = 3;\n                return this.getAccessKeys();\n              case 3:\n                accessKeys = _context12.sent;\n                lak2fak = accessKeys.filter(function (_ref7) {\n                  var access_key = _ref7.access_key;\n                  return access_key.permission !== 'FullAccess';\n                }).filter(function (_ref8) {\n                  var access_key = _ref8.access_key;\n                  var perm = access_key.permission.FunctionCall;\n                  return perm.receiver_id === accountId && perm.method_names.length === 4 && perm.method_names.includes('add_request_and_confirm');\n                });\n                _context12.t0 = key_pair_1.PublicKey;\n                _context12.next = 8;\n                return this.postSignedJson('/2fa/getAccessKey', {\n                  accountId: accountId\n                });\n              case 8:\n                _context12.t1 = _context12.sent.publicKey;\n                confirmOnlyKey = _context12.t0.from.call(_context12.t0, _context12.t1);\n                return _context12.abrupt(\"return\", [transaction_1.deleteKey(confirmOnlyKey)].concat(_toConsumableArray(lak2fak.map(function (_ref9) {\n                  var public_key = _ref9.public_key;\n                  return transaction_1.deleteKey(key_pair_1.PublicKey.from(public_key));\n                })), _toConsumableArray(lak2fak.map(function (_ref10) {\n                  var public_key = _ref10.public_key;\n                  return transaction_1.addKey(key_pair_1.PublicKey.from(public_key), transaction_1.fullAccessKey());\n                }))));\n              case 11:\n              case \"end\":\n                return _context12.stop();\n            }\n          }\n        }, _callee12, this);\n      }));\n      function get2faDisableKeyConversionActions() {\n        return _get2faDisableKeyConversionActions.apply(this, arguments);\n      }\n      return get2faDisableKeyConversionActions;\n    }()\n    /**\n     * This method converts LAKs back to FAKs, clears state and deploys an 'empty' contract (contractBytes param)\n     * @param [contractBytes]{@link https://github.com/near/near-wallet/blob/master/packages/frontend/src/wasm/main.wasm?raw=true}\n     * @param [cleanupContractBytes]{@link https://github.com/near/core-contracts/blob/master/state-cleanup/res/state_cleanup.wasm?raw=true}\n     */\n  }, {\n    key: \"disable\",\n    value: function () {\n      var _disable = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee13(contractBytes, cleanupContractBytes) {\n        var _yield$this$checkMult2, stateStatus, deleteAllRequestsError, cleanupActions, actions;\n        return _regeneratorRuntime().wrap(function _callee13$(_context13) {\n          while (1) {\n            switch (_context13.prev = _context13.next) {\n              case 0:\n                _context13.next = 2;\n                return this.checkMultisigCodeAndStateStatus();\n              case 2:\n                _yield$this$checkMult2 = _context13.sent;\n                stateStatus = _yield$this$checkMult2.stateStatus;\n                if (!(stateStatus !== MultisigStateStatus.VALID_STATE && stateStatus !== MultisigStateStatus.STATE_NOT_INITIALIZED)) {\n                  _context13.next = 6;\n                  break;\n                }\n                throw new providers_1.TypedError(\"Can not deploy a contract to account \".concat(this.accountId, \" on network \").concat(this.connection.networkId, \", the account state could not be verified.\"), 'ContractStateUnknown');\n              case 6:\n                _context13.next = 8;\n                return this.deleteAllRequests().catch(function (e) {\n                  return deleteAllRequestsError = e;\n                });\n              case 8:\n                _context13.next = 10;\n                return this.get2faDisableCleanupActions(cleanupContractBytes).catch(function (e) {\n                  if (e.type === 'ContractHasExistingState') {\n                    throw deleteAllRequestsError || e;\n                  }\n                  throw e;\n                });\n              case 10:\n                cleanupActions = _context13.sent;\n                _context13.t0 = [];\n                _context13.t1 = _toConsumableArray(cleanupActions);\n                _context13.t2 = _toConsumableArray;\n                _context13.next = 16;\n                return this.get2faDisableKeyConversionActions();\n              case 16:\n                _context13.t3 = _context13.sent;\n                _context13.t4 = (0, _context13.t2)(_context13.t3);\n                _context13.t5 = [transaction_1.deployContract(contractBytes)];\n                actions = _context13.t0.concat.call(_context13.t0, _context13.t1, _context13.t4, _context13.t5);\n                console.log('disabling 2fa for', this.accountId);\n                _context13.next = 23;\n                return this.signAndSendTransaction({\n                  receiverId: this.accountId,\n                  actions: actions\n                });\n              case 23:\n                return _context13.abrupt(\"return\", _context13.sent);\n              case 24:\n              case \"end\":\n                return _context13.stop();\n            }\n          }\n        }, _callee13, this);\n      }));\n      function disable(_x9, _x10) {\n        return _disable.apply(this, arguments);\n      }\n      return disable;\n    }()\n  }, {\n    key: \"sendCodeDefault\",\n    value: function () {\n      var _sendCodeDefault = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee14() {\n        var accountId, _this$getRequest2, requestId, method;\n        return _regeneratorRuntime().wrap(function _callee14$(_context14) {\n          while (1) {\n            switch (_context14.prev = _context14.next) {\n              case 0:\n                accountId = this.accountId;\n                _this$getRequest2 = this.getRequest(), requestId = _this$getRequest2.requestId;\n                _context14.next = 4;\n                return this.get2faMethod();\n              case 4:\n                method = _context14.sent;\n                _context14.next = 7;\n                return this.postSignedJson('/2fa/send', {\n                  accountId: accountId,\n                  method: method,\n                  requestId: requestId\n                });\n              case 7:\n                return _context14.abrupt(\"return\", requestId);\n              case 8:\n              case \"end\":\n                return _context14.stop();\n            }\n          }\n        }, _callee14, this);\n      }));\n      function sendCodeDefault() {\n        return _sendCodeDefault.apply(this, arguments);\n      }\n      return sendCodeDefault;\n    }()\n  }, {\n    key: \"getCodeDefault\",\n    value: function () {\n      var _getCodeDefault = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee15(method) {\n        return _regeneratorRuntime().wrap(function _callee15$(_context15) {\n          while (1) {\n            switch (_context15.prev = _context15.next) {\n              case 0:\n                throw new Error('There is no getCode callback provided. Please provide your own in AccountMultisig constructor options. It has a parameter method where method.kind is \"email\" or \"phone\".');\n              case 1:\n              case \"end\":\n                return _context15.stop();\n            }\n          }\n        }, _callee15);\n      }));\n      function getCodeDefault(_x11) {\n        return _getCodeDefault.apply(this, arguments);\n      }\n      return getCodeDefault;\n    }()\n  }, {\n    key: \"promptAndVerify\",\n    value: function () {\n      var _promptAndVerify = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee16() {\n        var method, securityCode, result;\n        return _regeneratorRuntime().wrap(function _callee16$(_context16) {\n          while (1) {\n            switch (_context16.prev = _context16.next) {\n              case 0:\n                _context16.next = 2;\n                return this.get2faMethod();\n              case 2:\n                method = _context16.sent;\n                _context16.next = 5;\n                return this.getCode(method);\n              case 5:\n                securityCode = _context16.sent;\n                _context16.prev = 6;\n                _context16.next = 9;\n                return this.verifyCode(securityCode);\n              case 9:\n                result = _context16.sent;\n                return _context16.abrupt(\"return\", result);\n              case 13:\n                _context16.prev = 13;\n                _context16.t0 = _context16[\"catch\"](6);\n                console.warn('Error validating security code:', _context16.t0);\n                if (!(_context16.t0.toString().includes('invalid 2fa code provided') || _context16.t0.toString().includes('2fa code not valid'))) {\n                  _context16.next = 20;\n                  break;\n                }\n                _context16.next = 19;\n                return this.promptAndVerify();\n              case 19:\n                return _context16.abrupt(\"return\", _context16.sent);\n              case 20:\n                throw _context16.t0;\n              case 21:\n              case \"end\":\n                return _context16.stop();\n            }\n          }\n        }, _callee16, this, [[6, 13]]);\n      }));\n      function promptAndVerify() {\n        return _promptAndVerify.apply(this, arguments);\n      }\n      return promptAndVerify;\n    }()\n  }, {\n    key: \"verifyCodeDefault\",\n    value: function () {\n      var _verifyCodeDefault = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee17(securityCode) {\n        var accountId, request, requestId;\n        return _regeneratorRuntime().wrap(function _callee17$(_context17) {\n          while (1) {\n            switch (_context17.prev = _context17.next) {\n              case 0:\n                accountId = this.accountId;\n                request = this.getRequest();\n                if (request) {\n                  _context17.next = 4;\n                  break;\n                }\n                throw new Error('no request pending');\n              case 4:\n                requestId = request.requestId;\n                _context17.next = 7;\n                return this.postSignedJson('/2fa/verify', {\n                  accountId: accountId,\n                  securityCode: securityCode,\n                  requestId: requestId\n                });\n              case 7:\n                return _context17.abrupt(\"return\", _context17.sent);\n              case 8:\n              case \"end\":\n                return _context17.stop();\n            }\n          }\n        }, _callee17, this);\n      }));\n      function verifyCodeDefault(_x12) {\n        return _verifyCodeDefault.apply(this, arguments);\n      }\n      return verifyCodeDefault;\n    }()\n  }, {\n    key: \"getRecoveryMethods\",\n    value: function () {\n      var _getRecoveryMethods = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee18() {\n        var accountId;\n        return _regeneratorRuntime().wrap(function _callee18$(_context18) {\n          while (1) {\n            switch (_context18.prev = _context18.next) {\n              case 0:\n                accountId = this.accountId;\n                _context18.t0 = accountId;\n                _context18.next = 4;\n                return this.postSignedJson('/account/recoveryMethods', {\n                  accountId: accountId\n                });\n              case 4:\n                _context18.t1 = _context18.sent;\n                return _context18.abrupt(\"return\", {\n                  accountId: _context18.t0,\n                  data: _context18.t1\n                });\n              case 6:\n              case \"end\":\n                return _context18.stop();\n            }\n          }\n        }, _callee18, this);\n      }));\n      function getRecoveryMethods() {\n        return _getRecoveryMethods.apply(this, arguments);\n      }\n      return getRecoveryMethods;\n    }()\n  }, {\n    key: \"get2faMethod\",\n    value: function () {\n      var _get2faMethod = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee19() {\n        var _yield$this$getRecove, data, _data, kind, detail;\n        return _regeneratorRuntime().wrap(function _callee19$(_context19) {\n          while (1) {\n            switch (_context19.prev = _context19.next) {\n              case 0:\n                _context19.next = 2;\n                return this.getRecoveryMethods();\n              case 2:\n                _yield$this$getRecove = _context19.sent;\n                data = _yield$this$getRecove.data;\n                if (data && data.length) {\n                  data = data.find(function (m) {\n                    return m.kind.indexOf('2fa-') === 0;\n                  });\n                }\n                if (data) {\n                  _context19.next = 7;\n                  break;\n                }\n                return _context19.abrupt(\"return\", null);\n              case 7:\n                _data = data, kind = _data.kind, detail = _data.detail;\n                return _context19.abrupt(\"return\", {\n                  kind: kind,\n                  detail: detail\n                });\n              case 9:\n              case \"end\":\n                return _context19.stop();\n            }\n          }\n        }, _callee19, this);\n      }));\n      function get2faMethod() {\n        return _get2faMethod.apply(this, arguments);\n      }\n      return get2faMethod;\n    }()\n  }, {\n    key: \"signatureFor\",\n    value: function () {\n      var _signatureFor = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee20() {\n        var accountId, block, blockNumber, signed, blockNumberSignature;\n        return _regeneratorRuntime().wrap(function _callee20$(_context20) {\n          while (1) {\n            switch (_context20.prev = _context20.next) {\n              case 0:\n                accountId = this.accountId;\n                _context20.next = 3;\n                return this.connection.provider.block({\n                  finality: 'final'\n                });\n              case 3:\n                block = _context20.sent;\n                blockNumber = block.header.height.toString();\n                _context20.next = 7;\n                return this.connection.signer.signMessage(Buffer.from(blockNumber), accountId, this.connection.networkId);\n              case 7:\n                signed = _context20.sent;\n                blockNumberSignature = Buffer.from(signed.signature).toString('base64');\n                return _context20.abrupt(\"return\", {\n                  blockNumber: blockNumber,\n                  blockNumberSignature: blockNumberSignature\n                });\n              case 10:\n              case \"end\":\n                return _context20.stop();\n            }\n          }\n        }, _callee20, this);\n      }));\n      function signatureFor() {\n        return _signatureFor.apply(this, arguments);\n      }\n      return signatureFor;\n    }()\n  }, {\n    key: \"postSignedJson\",\n    value: function () {\n      var _postSignedJson = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee21(path, body) {\n        return _regeneratorRuntime().wrap(function _callee21$(_context21) {\n          while (1) {\n            switch (_context21.prev = _context21.next) {\n              case 0:\n                _context21.t0 = web_1;\n                _context21.t1 = this.helperUrl + path;\n                _context21.t2 = JSON;\n                _context21.t3 = _objectSpread;\n                _context21.t4 = _objectSpread({}, body);\n                _context21.next = 7;\n                return this.signatureFor();\n              case 7:\n                _context21.t5 = _context21.sent;\n                _context21.t6 = (0, _context21.t3)(_context21.t4, _context21.t5);\n                _context21.t7 = _context21.t2.stringify.call(_context21.t2, _context21.t6);\n                _context21.next = 12;\n                return _context21.t0.fetchJson.call(_context21.t0, _context21.t1, _context21.t7);\n              case 12:\n                return _context21.abrupt(\"return\", _context21.sent);\n              case 13:\n              case \"end\":\n                return _context21.stop();\n            }\n          }\n        }, _callee21, this);\n      }));\n      function postSignedJson(_x13, _x14) {\n        return _postSignedJson.apply(this, arguments);\n      }\n      return postSignedJson;\n    }()\n  }]);\n  return Account2FA;\n}(AccountMultisig);\nexports.Account2FA = Account2FA;\n// helpers\nvar toPK = function toPK(pk) {\n  return key_pair_1.PublicKey.from(pk);\n};\nvar convertPKForContract = function convertPKForContract(pk) {\n  return pk.toString().replace('ed25519:', '');\n};\nvar convertActions = function convertActions(actions, accountId, receiverId) {\n  return actions.map(function (a) {\n    var type = a.enum;\n    var _a$type = a[type],\n      gas = _a$type.gas,\n      publicKey = _a$type.publicKey,\n      methodName = _a$type.methodName,\n      args = _a$type.args,\n      deposit = _a$type.deposit,\n      accessKey = _a$type.accessKey,\n      code = _a$type.code;\n    var action = {\n      type: type[0].toUpperCase() + type.substr(1),\n      gas: gas && gas.toString() || undefined,\n      public_key: publicKey && convertPKForContract(publicKey) || undefined,\n      method_name: methodName,\n      args: args && Buffer.from(args).toString('base64') || undefined,\n      code: code && Buffer.from(code).toString('base64') || undefined,\n      amount: deposit && deposit.toString() || undefined,\n      deposit: deposit && deposit.toString() || '0',\n      permission: undefined\n    };\n    if (accessKey) {\n      if (receiverId === accountId && accessKey.permission.enum !== 'fullAccess') {\n        action.permission = {\n          receiver_id: accountId,\n          allowance: exports.MULTISIG_ALLOWANCE.toString(),\n          method_names: exports.MULTISIG_CHANGE_METHODS\n        };\n      }\n      if (accessKey.permission.enum === 'functionCall') {\n        var _accessKey$permission = accessKey.permission.functionCall,\n          receiver_id = _accessKey$permission.receiverId,\n          method_names = _accessKey$permission.methodNames,\n          allowance = _accessKey$permission.allowance;\n        action.permission = {\n          receiver_id: receiver_id,\n          allowance: allowance && allowance.toString() || undefined,\n          method_names: method_names\n        };\n      }\n    }\n    return action;\n  });\n};","map":{"version":3,"names":["__importDefault","mod","__esModule","Object","defineProperty","exports","value","Account2FA","AccountMultisig","MultisigStateStatus","MultisigDeleteRequestRejectionError","MULTISIG_CONFIRM_METHODS","MULTISIG_CHANGE_METHODS","MULTISIG_DEPOSIT","MULTISIG_GAS","MULTISIG_ALLOWANCE","MULTISIG_STORAGE_KEY","bn_js_1","require","depd_1","account_1","format_1","key_pair_1","transaction_1","providers_1","web_1","default","parseNearAmount","MultisigCodeStatus","storageFallback","connection","accountId","options","storage","onAddRequestResult","receiverId","actions","_signAndSendTransaction","args","Buffer","from","JSON","stringify","request","receiver_id","convertActions","functionCall","result","toString","includes","deleteUnconfirmedRequests","signAndSendTransaction","status","Error","SuccessValue","setRequest","requestId","parseInt","contractBytes","u32_max","validCodeStatusIfNoDeploy","UNKNOWN_CODE","VALID_CODE","deployContract","request_id","deleteRequest","codeStatus","stateStatus","VALID_STATE","RegExp","CANNOT_DESERIALIZE_STATE","test","kind","ExecutionError","INVALID_STATE","MULTISIG_NOT_INITIALIZED","STATE_NOT_INITIALIZED","NO_SUCH_REQUEST","METHOD_NOT_FOUND","message","INVALID_CODE","UNKNOWN_STATE","getRequestIds","request_ids","length","Promise","all","map","id","getRequest","requestIdToDelete","console","warn","viewFunction","parse","getItem","data","setItem","Account","helperUrl","sendCode","sendCodeDefault","getCode","getCodeDefault","verifyCode","verifyCodeDefault","onConfirmResult","deprecate","__signAndSendTransaction","promptAndVerify","getRecoveryMethods","seedOrLedgerKey","filter","publicKey","rm","getAccessKeys","fak2lak","public_key","permission","access_key","ak","toPK","postSignedJson","confirmOnlyKey","newArgs","pk","deleteKey","addKey","functionCallAccessKey","newFunctionCallActionBatch","concat","log","checkMultisigCodeAndStateStatus","multisigStateStatus","TypedError","networkId","cleanupContractBytes","cleanupActions","deleteAllRequests","catch","e","get2faDisableCleanupActions","get2faDisableKeyConversionActions","keyConversionActions","findAccessKey","accessKeyInfo","accessKey","signAndSendTransactionWithAccount","viewState","error","cause","name","currentAccountState","currentAccountStateKeys","key","keys","accessKeys","lak2fak","perm","FunctionCall","method_names","PublicKey","fullAccessKey","deleteAllRequestsError","type","get2faMethod","method","securityCode","find","m","indexOf","detail","provider","block","finality","blockNumber","header","height","signer","signMessage","signed","blockNumberSignature","signature","path","body","signatureFor","fetchJson","convertPKForContract","replace","a","enum","gas","methodName","deposit","code","action","toUpperCase","substr","undefined","method_name","amount","allowance","methodNames"],"sources":["/Users/sepezho/Work/tonana/fe/node_modules/@nightlylabs/connect-near/node_modules/near-api-js/lib/account_multisig.js"],"sourcesContent":["'use strict';\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Account2FA = exports.AccountMultisig = exports.MultisigStateStatus = exports.MultisigDeleteRequestRejectionError = exports.MULTISIG_CONFIRM_METHODS = exports.MULTISIG_CHANGE_METHODS = exports.MULTISIG_DEPOSIT = exports.MULTISIG_GAS = exports.MULTISIG_ALLOWANCE = exports.MULTISIG_STORAGE_KEY = void 0;\nconst bn_js_1 = __importDefault(require(\"bn.js\"));\nconst depd_1 = __importDefault(require(\"depd\"));\nconst account_1 = require(\"./account\");\nconst format_1 = require(\"./utils/format\");\nconst key_pair_1 = require(\"./utils/key_pair\");\nconst transaction_1 = require(\"./transaction\");\nconst providers_1 = require(\"./providers\");\nconst web_1 = require(\"./utils/web\");\nexports.MULTISIG_STORAGE_KEY = '__multisigRequest';\nexports.MULTISIG_ALLOWANCE = new bn_js_1.default(format_1.parseNearAmount('1'));\n// TODO: Different gas value for different requests (can reduce gas usage dramatically)\nexports.MULTISIG_GAS = new bn_js_1.default('100000000000000');\nexports.MULTISIG_DEPOSIT = new bn_js_1.default('0');\nexports.MULTISIG_CHANGE_METHODS = ['add_request', 'add_request_and_confirm', 'delete_request', 'confirm'];\nexports.MULTISIG_CONFIRM_METHODS = ['confirm'];\nvar MultisigDeleteRequestRejectionError;\n(function (MultisigDeleteRequestRejectionError) {\n    MultisigDeleteRequestRejectionError[\"CANNOT_DESERIALIZE_STATE\"] = \"Cannot deserialize the contract state\";\n    MultisigDeleteRequestRejectionError[\"MULTISIG_NOT_INITIALIZED\"] = \"Smart contract panicked: Multisig contract should be initialized before usage\";\n    MultisigDeleteRequestRejectionError[\"NO_SUCH_REQUEST\"] = \"Smart contract panicked: panicked at 'No such request: either wrong number or already confirmed'\";\n    MultisigDeleteRequestRejectionError[\"REQUEST_COOLDOWN_ERROR\"] = \"Request cannot be deleted immediately after creation.\";\n    MultisigDeleteRequestRejectionError[\"METHOD_NOT_FOUND\"] = \"Contract method is not found\";\n})(MultisigDeleteRequestRejectionError = exports.MultisigDeleteRequestRejectionError || (exports.MultisigDeleteRequestRejectionError = {}));\n;\nvar MultisigStateStatus;\n(function (MultisigStateStatus) {\n    MultisigStateStatus[MultisigStateStatus[\"INVALID_STATE\"] = 0] = \"INVALID_STATE\";\n    MultisigStateStatus[MultisigStateStatus[\"STATE_NOT_INITIALIZED\"] = 1] = \"STATE_NOT_INITIALIZED\";\n    MultisigStateStatus[MultisigStateStatus[\"VALID_STATE\"] = 2] = \"VALID_STATE\";\n    MultisigStateStatus[MultisigStateStatus[\"UNKNOWN_STATE\"] = 3] = \"UNKNOWN_STATE\";\n})(MultisigStateStatus = exports.MultisigStateStatus || (exports.MultisigStateStatus = {}));\nvar MultisigCodeStatus;\n(function (MultisigCodeStatus) {\n    MultisigCodeStatus[MultisigCodeStatus[\"INVALID_CODE\"] = 0] = \"INVALID_CODE\";\n    MultisigCodeStatus[MultisigCodeStatus[\"VALID_CODE\"] = 1] = \"VALID_CODE\";\n    MultisigCodeStatus[MultisigCodeStatus[\"UNKNOWN_CODE\"] = 2] = \"UNKNOWN_CODE\";\n})(MultisigCodeStatus || (MultisigCodeStatus = {}));\n// in memory request cache for node w/o localStorage\nconst storageFallback = {\n    [exports.MULTISIG_STORAGE_KEY]: null\n};\nclass AccountMultisig extends account_1.Account {\n    constructor(connection, accountId, options) {\n        super(connection, accountId);\n        this.storage = options.storage;\n        this.onAddRequestResult = options.onAddRequestResult;\n    }\n    async signAndSendTransactionWithAccount(receiverId, actions) {\n        return super.signAndSendTransaction({ receiverId, actions });\n    }\n    signAndSendTransaction(...args) {\n        if (typeof args[0] === 'string') {\n            return this._signAndSendTransaction({ receiverId: args[0], actions: args[1] });\n        }\n        return this._signAndSendTransaction(args[0]);\n    }\n    async _signAndSendTransaction({ receiverId, actions }) {\n        const { accountId } = this;\n        const args = Buffer.from(JSON.stringify({\n            request: {\n                receiver_id: receiverId,\n                actions: convertActions(actions, accountId, receiverId)\n            }\n        }));\n        let result;\n        try {\n            result = await super.signAndSendTransaction({\n                receiverId: accountId,\n                actions: [\n                    transaction_1.functionCall('add_request_and_confirm', args, exports.MULTISIG_GAS, exports.MULTISIG_DEPOSIT)\n                ]\n            });\n        }\n        catch (e) {\n            if (e.toString().includes('Account has too many active requests. Confirm or delete some')) {\n                await this.deleteUnconfirmedRequests();\n                return await this.signAndSendTransaction(receiverId, actions);\n            }\n            throw e;\n        }\n        // TODO: Are following even needed? Seems like it throws on error already\n        if (!result.status) {\n            throw new Error('Request failed');\n        }\n        const status = { ...result.status };\n        if (!status.SuccessValue || typeof status.SuccessValue !== 'string') {\n            throw new Error('Request failed');\n        }\n        this.setRequest({\n            accountId,\n            actions,\n            requestId: parseInt(Buffer.from(status.SuccessValue, 'base64').toString('ascii'), 10)\n        });\n        if (this.onAddRequestResult) {\n            await this.onAddRequestResult(result);\n        }\n        // NOTE there is no await on purpose to avoid blocking for 2fa\n        this.deleteUnconfirmedRequests();\n        return result;\n    }\n    /*\n     * This method submits a canary transaction that is expected to always fail in order to determine whether the contract currently has valid multisig state\n     * and whether it is initialized. The canary transaction attempts to delete a request at index u32_max and will go through if a request exists at that index.\n     * a u32_max + 1 and -1 value cannot be used for the canary due to expected u32 error thrown before deserialization attempt.\n     */\n    async checkMultisigCodeAndStateStatus(contractBytes) {\n        const u32_max = 4294967295;\n        const validCodeStatusIfNoDeploy = contractBytes ? MultisigCodeStatus.UNKNOWN_CODE : MultisigCodeStatus.VALID_CODE;\n        try {\n            if (contractBytes) {\n                await super.signAndSendTransaction({\n                    receiverId: this.accountId, actions: [\n                        transaction_1.deployContract(contractBytes),\n                        transaction_1.functionCall('delete_request', { request_id: u32_max }, exports.MULTISIG_GAS, exports.MULTISIG_DEPOSIT)\n                    ]\n                });\n            }\n            else {\n                await this.deleteRequest(u32_max);\n            }\n            return { codeStatus: MultisigCodeStatus.VALID_CODE, stateStatus: MultisigStateStatus.VALID_STATE };\n        }\n        catch (e) {\n            if (new RegExp(MultisigDeleteRequestRejectionError.CANNOT_DESERIALIZE_STATE).test(e && e.kind && e.kind.ExecutionError)) {\n                return { codeStatus: validCodeStatusIfNoDeploy, stateStatus: MultisigStateStatus.INVALID_STATE };\n            }\n            else if (new RegExp(MultisigDeleteRequestRejectionError.MULTISIG_NOT_INITIALIZED).test(e && e.kind && e.kind.ExecutionError)) {\n                return { codeStatus: validCodeStatusIfNoDeploy, stateStatus: MultisigStateStatus.STATE_NOT_INITIALIZED };\n            }\n            else if (new RegExp(MultisigDeleteRequestRejectionError.NO_SUCH_REQUEST).test(e && e.kind && e.kind.ExecutionError)) {\n                return { codeStatus: validCodeStatusIfNoDeploy, stateStatus: MultisigStateStatus.VALID_STATE };\n            }\n            else if (new RegExp(MultisigDeleteRequestRejectionError.METHOD_NOT_FOUND).test(e && e.message)) {\n                // not reachable if transaction included a deploy\n                return { codeStatus: MultisigCodeStatus.INVALID_CODE, stateStatus: MultisigStateStatus.UNKNOWN_STATE };\n            }\n            throw e;\n        }\n    }\n    deleteRequest(request_id) {\n        return super.signAndSendTransaction({\n            receiverId: this.accountId,\n            actions: [transaction_1.functionCall('delete_request', { request_id }, exports.MULTISIG_GAS, exports.MULTISIG_DEPOSIT)]\n        });\n    }\n    async deleteAllRequests() {\n        const request_ids = await this.getRequestIds();\n        if (request_ids.length) {\n            await Promise.all(request_ids.map((id) => this.deleteRequest(id)));\n        }\n    }\n    async deleteUnconfirmedRequests() {\n        // TODO: Delete in batch, don't delete unexpired\n        // TODO: Delete in batch, don't delete unexpired (can reduce gas usage dramatically)\n        const request_ids = await this.getRequestIds();\n        const { requestId } = this.getRequest();\n        for (const requestIdToDelete of request_ids) {\n            if (requestIdToDelete == requestId) {\n                continue;\n            }\n            try {\n                await super.signAndSendTransaction({\n                    receiverId: this.accountId,\n                    actions: [transaction_1.functionCall('delete_request', { request_id: requestIdToDelete }, exports.MULTISIG_GAS, exports.MULTISIG_DEPOSIT)]\n                });\n            }\n            catch (e) {\n                console.warn('Attempt to delete an earlier request before 15 minutes failed. Will try again.');\n            }\n        }\n    }\n    // helpers\n    async getRequestIds() {\n        // TODO: Read requests from state to allow filtering by expiration time\n        // TODO: https://github.com/near/core-contracts/blob/305d1db4f4f2cf5ce4c1ef3479f7544957381f11/multisig/src/lib.rs#L84\n        return this.viewFunction(this.accountId, 'list_request_ids');\n    }\n    getRequest() {\n        if (this.storage) {\n            return JSON.parse(this.storage.getItem(exports.MULTISIG_STORAGE_KEY) || '{}');\n        }\n        return storageFallback[exports.MULTISIG_STORAGE_KEY];\n    }\n    setRequest(data) {\n        if (this.storage) {\n            return this.storage.setItem(exports.MULTISIG_STORAGE_KEY, JSON.stringify(data));\n        }\n        storageFallback[exports.MULTISIG_STORAGE_KEY] = data;\n    }\n}\nexports.AccountMultisig = AccountMultisig;\nclass Account2FA extends AccountMultisig {\n    constructor(connection, accountId, options) {\n        super(connection, accountId, options);\n        this.helperUrl = 'https://helper.testnet.near.org';\n        this.helperUrl = options.helperUrl || this.helperUrl;\n        this.storage = options.storage;\n        this.sendCode = options.sendCode || this.sendCodeDefault;\n        this.getCode = options.getCode || this.getCodeDefault;\n        this.verifyCode = options.verifyCode || this.verifyCodeDefault;\n        this.onConfirmResult = options.onConfirmResult;\n    }\n    async signAndSendTransaction(...args) {\n        if (typeof args[0] === 'string') {\n            const deprecate = depd_1.default('Account.signAndSendTransaction(receiverId, actions');\n            deprecate('use `Account2FA.signAndSendTransaction(SignAndSendTransactionOptions)` instead');\n            return this.__signAndSendTransaction({ receiverId: args[0], actions: args[1] });\n        }\n        else {\n            return this.__signAndSendTransaction(args[0]);\n        }\n    }\n    async __signAndSendTransaction({ receiverId, actions }) {\n        await super.signAndSendTransaction({ receiverId, actions });\n        // TODO: Should following override onRequestResult in superclass instead of doing custom signAndSendTransaction?\n        await this.sendCode();\n        const result = await this.promptAndVerify();\n        if (this.onConfirmResult) {\n            await this.onConfirmResult(result);\n        }\n        return result;\n    }\n    // default helpers for CH deployments of multisig\n    async deployMultisig(contractBytes) {\n        const { accountId } = this;\n        const seedOrLedgerKey = (await this.getRecoveryMethods()).data\n            .filter(({ kind, publicKey }) => (kind === 'phrase' || kind === 'ledger') && publicKey !== null)\n            .map((rm) => rm.publicKey);\n        const fak2lak = (await this.getAccessKeys())\n            .filter(({ public_key, access_key: { permission } }) => permission === 'FullAccess' && !seedOrLedgerKey.includes(public_key))\n            .map((ak) => ak.public_key)\n            .map(toPK);\n        const confirmOnlyKey = toPK((await this.postSignedJson('/2fa/getAccessKey', { accountId })).publicKey);\n        const newArgs = Buffer.from(JSON.stringify({ 'num_confirmations': 2 }));\n        const actions = [\n            ...fak2lak.map((pk) => transaction_1.deleteKey(pk)),\n            ...fak2lak.map((pk) => transaction_1.addKey(pk, transaction_1.functionCallAccessKey(accountId, exports.MULTISIG_CHANGE_METHODS, null))),\n            transaction_1.addKey(confirmOnlyKey, transaction_1.functionCallAccessKey(accountId, exports.MULTISIG_CONFIRM_METHODS, null)),\n            transaction_1.deployContract(contractBytes),\n        ];\n        const newFunctionCallActionBatch = actions.concat(transaction_1.functionCall('new', newArgs, exports.MULTISIG_GAS, exports.MULTISIG_DEPOSIT));\n        console.log('deploying multisig contract for', accountId);\n        const { stateStatus: multisigStateStatus } = await this.checkMultisigCodeAndStateStatus(contractBytes);\n        switch (multisigStateStatus) {\n            case MultisigStateStatus.STATE_NOT_INITIALIZED:\n                return await super.signAndSendTransactionWithAccount(accountId, newFunctionCallActionBatch);\n            case MultisigStateStatus.VALID_STATE:\n                return await super.signAndSendTransactionWithAccount(accountId, actions);\n            case MultisigStateStatus.INVALID_STATE:\n                throw new providers_1.TypedError(`Can not deploy a contract to account ${this.accountId} on network ${this.connection.networkId}, the account has existing state.`, 'ContractHasExistingState');\n            default:\n                throw new providers_1.TypedError(`Can not deploy a contract to account ${this.accountId} on network ${this.connection.networkId}, the account state could not be verified.`, 'ContractStateUnknown');\n        }\n    }\n    async disableWithFAK({ contractBytes, cleanupContractBytes }) {\n        let cleanupActions = [];\n        if (cleanupContractBytes) {\n            await this.deleteAllRequests().catch(e => e);\n            cleanupActions = await this.get2faDisableCleanupActions(cleanupContractBytes);\n        }\n        const keyConversionActions = await this.get2faDisableKeyConversionActions();\n        const actions = [\n            ...cleanupActions,\n            ...keyConversionActions,\n            transaction_1.deployContract(contractBytes)\n        ];\n        const accessKeyInfo = await this.findAccessKey(this.accountId, actions);\n        if (accessKeyInfo && accessKeyInfo.accessKey && accessKeyInfo.accessKey.permission !== 'FullAccess') {\n            throw new providers_1.TypedError(`No full access key found in keystore. Unable to bypass multisig`, 'NoFAKFound');\n        }\n        return this.signAndSendTransactionWithAccount(this.accountId, actions);\n    }\n    async get2faDisableCleanupActions(cleanupContractBytes) {\n        const currentAccountState = await this.viewState('').catch(error => {\n            const cause = error.cause && error.cause.name;\n            if (cause == 'NO_CONTRACT_CODE') {\n                return [];\n            }\n            throw cause == 'TOO_LARGE_CONTRACT_STATE'\n                ? new providers_1.TypedError(`Can not deploy a contract to account ${this.accountId} on network ${this.connection.networkId}, the account has existing state.`, 'ContractHasExistingState')\n                : error;\n        });\n        const currentAccountStateKeys = currentAccountState.map(({ key }) => key.toString('base64'));\n        return currentAccountState.length ? [\n            transaction_1.deployContract(cleanupContractBytes),\n            transaction_1.functionCall('clean', { keys: currentAccountStateKeys }, exports.MULTISIG_GAS, new bn_js_1.default('0'))\n        ] : [];\n    }\n    async get2faDisableKeyConversionActions() {\n        const { accountId } = this;\n        const accessKeys = await this.getAccessKeys();\n        const lak2fak = accessKeys\n            .filter(({ access_key }) => access_key.permission !== 'FullAccess')\n            .filter(({ access_key }) => {\n            const perm = access_key.permission.FunctionCall;\n            return perm.receiver_id === accountId &&\n                perm.method_names.length === 4 &&\n                perm.method_names.includes('add_request_and_confirm');\n        });\n        const confirmOnlyKey = key_pair_1.PublicKey.from((await this.postSignedJson('/2fa/getAccessKey', { accountId })).publicKey);\n        return [\n            transaction_1.deleteKey(confirmOnlyKey),\n            ...lak2fak.map(({ public_key }) => transaction_1.deleteKey(key_pair_1.PublicKey.from(public_key))),\n            ...lak2fak.map(({ public_key }) => transaction_1.addKey(key_pair_1.PublicKey.from(public_key), transaction_1.fullAccessKey()))\n        ];\n    }\n    /**\n     * This method converts LAKs back to FAKs, clears state and deploys an 'empty' contract (contractBytes param)\n     * @param [contractBytes]{@link https://github.com/near/near-wallet/blob/master/packages/frontend/src/wasm/main.wasm?raw=true}\n     * @param [cleanupContractBytes]{@link https://github.com/near/core-contracts/blob/master/state-cleanup/res/state_cleanup.wasm?raw=true}\n     */\n    async disable(contractBytes, cleanupContractBytes) {\n        const { stateStatus } = await this.checkMultisigCodeAndStateStatus();\n        if (stateStatus !== MultisigStateStatus.VALID_STATE && stateStatus !== MultisigStateStatus.STATE_NOT_INITIALIZED) {\n            throw new providers_1.TypedError(`Can not deploy a contract to account ${this.accountId} on network ${this.connection.networkId}, the account state could not be verified.`, 'ContractStateUnknown');\n        }\n        let deleteAllRequestsError;\n        await this.deleteAllRequests().catch(e => deleteAllRequestsError = e);\n        const cleanupActions = await this.get2faDisableCleanupActions(cleanupContractBytes).catch(e => {\n            if (e.type === 'ContractHasExistingState') {\n                throw deleteAllRequestsError || e;\n            }\n            throw e;\n        });\n        const actions = [\n            ...cleanupActions,\n            ...(await this.get2faDisableKeyConversionActions()),\n            transaction_1.deployContract(contractBytes),\n        ];\n        console.log('disabling 2fa for', this.accountId);\n        return await this.signAndSendTransaction({\n            receiverId: this.accountId,\n            actions\n        });\n    }\n    async sendCodeDefault() {\n        const { accountId } = this;\n        const { requestId } = this.getRequest();\n        const method = await this.get2faMethod();\n        await this.postSignedJson('/2fa/send', {\n            accountId,\n            method,\n            requestId,\n        });\n        return requestId;\n    }\n    async getCodeDefault(method) {\n        throw new Error('There is no getCode callback provided. Please provide your own in AccountMultisig constructor options. It has a parameter method where method.kind is \"email\" or \"phone\".');\n    }\n    async promptAndVerify() {\n        const method = await this.get2faMethod();\n        const securityCode = await this.getCode(method);\n        try {\n            const result = await this.verifyCode(securityCode);\n            // TODO: Parse error from result for real (like in normal account.signAndSendTransaction)\n            return result;\n        }\n        catch (e) {\n            console.warn('Error validating security code:', e);\n            if (e.toString().includes('invalid 2fa code provided') || e.toString().includes('2fa code not valid')) {\n                return await this.promptAndVerify();\n            }\n            throw e;\n        }\n    }\n    async verifyCodeDefault(securityCode) {\n        const { accountId } = this;\n        const request = this.getRequest();\n        if (!request) {\n            throw new Error('no request pending');\n        }\n        const { requestId } = request;\n        return await this.postSignedJson('/2fa/verify', {\n            accountId,\n            securityCode,\n            requestId\n        });\n    }\n    async getRecoveryMethods() {\n        const { accountId } = this;\n        return {\n            accountId,\n            data: await this.postSignedJson('/account/recoveryMethods', { accountId })\n        };\n    }\n    async get2faMethod() {\n        let { data } = await this.getRecoveryMethods();\n        if (data && data.length) {\n            data = data.find((m) => m.kind.indexOf('2fa-') === 0);\n        }\n        if (!data)\n            return null;\n        const { kind, detail } = data;\n        return { kind, detail };\n    }\n    async signatureFor() {\n        const { accountId } = this;\n        const block = await this.connection.provider.block({ finality: 'final' });\n        const blockNumber = block.header.height.toString();\n        const signed = await this.connection.signer.signMessage(Buffer.from(blockNumber), accountId, this.connection.networkId);\n        const blockNumberSignature = Buffer.from(signed.signature).toString('base64');\n        return { blockNumber, blockNumberSignature };\n    }\n    async postSignedJson(path, body) {\n        return await web_1.fetchJson(this.helperUrl + path, JSON.stringify({\n            ...body,\n            ...(await this.signatureFor())\n        }));\n    }\n}\nexports.Account2FA = Account2FA;\n// helpers\nconst toPK = (pk) => key_pair_1.PublicKey.from(pk);\nconst convertPKForContract = (pk) => pk.toString().replace('ed25519:', '');\nconst convertActions = (actions, accountId, receiverId) => actions.map((a) => {\n    const type = a.enum;\n    const { gas, publicKey, methodName, args, deposit, accessKey, code } = a[type];\n    const action = {\n        type: type[0].toUpperCase() + type.substr(1),\n        gas: (gas && gas.toString()) || undefined,\n        public_key: (publicKey && convertPKForContract(publicKey)) || undefined,\n        method_name: methodName,\n        args: (args && Buffer.from(args).toString('base64')) || undefined,\n        code: (code && Buffer.from(code).toString('base64')) || undefined,\n        amount: (deposit && deposit.toString()) || undefined,\n        deposit: (deposit && deposit.toString()) || '0',\n        permission: undefined,\n    };\n    if (accessKey) {\n        if (receiverId === accountId && accessKey.permission.enum !== 'fullAccess') {\n            action.permission = {\n                receiver_id: accountId,\n                allowance: exports.MULTISIG_ALLOWANCE.toString(),\n                method_names: exports.MULTISIG_CHANGE_METHODS,\n            };\n        }\n        if (accessKey.permission.enum === 'functionCall') {\n            const { receiverId: receiver_id, methodNames: method_names, allowance } = accessKey.permission.functionCall;\n            action.permission = {\n                receiver_id,\n                allowance: (allowance && allowance.toString()) || undefined,\n                method_names\n            };\n        }\n    }\n    return action;\n});\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}