{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.stringToPath = exports.pathToString = exports.Slip10 = exports.Slip10RawIndex = exports.slip10CurveFromString = exports.Slip10Curve = void 0;\nconst encoding_1 = require(\"@cosmjs/encoding\");\nconst math_1 = require(\"@cosmjs/math\");\nconst bn_js_1 = __importDefault(require(\"bn.js\"));\nconst elliptic_1 = __importDefault(require(\"elliptic\"));\nconst hmac_1 = require(\"./hmac\");\nconst sha_1 = require(\"./sha\");\n/**\n * Raw values must match the curve string in SLIP-0010 master key generation\n *\n * @see https://github.com/satoshilabs/slips/blob/master/slip-0010.md#master-key-generation\n */\nvar Slip10Curve;\n(function (Slip10Curve) {\n  Slip10Curve[\"Secp256k1\"] = \"Bitcoin seed\";\n  Slip10Curve[\"Ed25519\"] = \"ed25519 seed\";\n})(Slip10Curve = exports.Slip10Curve || (exports.Slip10Curve = {}));\n/**\n * Reverse mapping of Slip10Curve\n */\nfunction slip10CurveFromString(curveString) {\n  switch (curveString) {\n    case Slip10Curve.Ed25519:\n      return Slip10Curve.Ed25519;\n    case Slip10Curve.Secp256k1:\n      return Slip10Curve.Secp256k1;\n    default:\n      throw new Error(`Unknown curve string: '${curveString}'`);\n  }\n}\nexports.slip10CurveFromString = slip10CurveFromString;\nclass Slip10RawIndex extends math_1.Uint32 {\n  static hardened(hardenedIndex) {\n    return new Slip10RawIndex(hardenedIndex + 2 ** 31);\n  }\n  static normal(normalIndex) {\n    return new Slip10RawIndex(normalIndex);\n  }\n  isHardened() {\n    return this.data >= 2 ** 31;\n  }\n}\nexports.Slip10RawIndex = Slip10RawIndex;\nconst secp256k1 = new elliptic_1.default.ec(\"secp256k1\");\n// Universal private key derivation accoring to\n// https://github.com/satoshilabs/slips/blob/master/slip-0010.md\nclass Slip10 {\n  static derivePath(curve, seed, path) {\n    let result = this.master(curve, seed);\n    for (const rawIndex of path) {\n      result = this.child(curve, result.privkey, result.chainCode, rawIndex);\n    }\n    return result;\n  }\n  static master(curve, seed) {\n    const i = new hmac_1.Hmac(sha_1.Sha512, (0, encoding_1.toAscii)(curve)).update(seed).digest();\n    const il = i.slice(0, 32);\n    const ir = i.slice(32, 64);\n    if (curve !== Slip10Curve.Ed25519 && (this.isZero(il) || this.isGteN(curve, il))) {\n      return this.master(curve, i);\n    }\n    return {\n      chainCode: ir,\n      privkey: il\n    };\n  }\n  static child(curve, parentPrivkey, parentChainCode, rawIndex) {\n    let i;\n    if (rawIndex.isHardened()) {\n      const payload = new Uint8Array([0x00, ...parentPrivkey, ...rawIndex.toBytesBigEndian()]);\n      i = new hmac_1.Hmac(sha_1.Sha512, parentChainCode).update(payload).digest();\n    } else {\n      if (curve === Slip10Curve.Ed25519) {\n        throw new Error(\"Normal keys are not allowed with ed25519\");\n      } else {\n        // Step 1 of https://github.com/satoshilabs/slips/blob/master/slip-0010.md#private-parent-key--private-child-key\n        // Calculate I = HMAC-SHA512(Key = c_par, Data = ser_P(point(k_par)) || ser_32(i)).\n        // where the functions point() and ser_p() are defined in BIP-0032\n        const data = new Uint8Array([...Slip10.serializedPoint(curve, new bn_js_1.default(parentPrivkey)), ...rawIndex.toBytesBigEndian()]);\n        i = new hmac_1.Hmac(sha_1.Sha512, parentChainCode).update(data).digest();\n      }\n    }\n    return this.childImpl(curve, parentPrivkey, parentChainCode, rawIndex, i);\n  }\n  /**\n   * Implementation of ser_P(point(k_par)) from BIP-0032\n   *\n   * @see https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki\n   */\n  static serializedPoint(curve, p) {\n    switch (curve) {\n      case Slip10Curve.Secp256k1:\n        return (0, encoding_1.fromHex)(secp256k1.g.mul(p).encodeCompressed(\"hex\"));\n      default:\n        throw new Error(\"curve not supported\");\n    }\n  }\n  static childImpl(curve, parentPrivkey, parentChainCode, rawIndex, i) {\n    // step 2 (of the Private parent key â†’ private child key algorithm)\n    const il = i.slice(0, 32);\n    const ir = i.slice(32, 64);\n    // step 3\n    const returnChainCode = ir;\n    // step 4\n    if (curve === Slip10Curve.Ed25519) {\n      return {\n        chainCode: returnChainCode,\n        privkey: il\n      };\n    }\n    // step 5\n    const n = this.n(curve);\n    const returnChildKeyAsNumber = new bn_js_1.default(il).add(new bn_js_1.default(parentPrivkey)).mod(n);\n    const returnChildKey = Uint8Array.from(returnChildKeyAsNumber.toArray(\"be\", 32));\n    // step 6\n    if (this.isGteN(curve, il) || this.isZero(returnChildKey)) {\n      const newI = new hmac_1.Hmac(sha_1.Sha512, parentChainCode).update(new Uint8Array([0x01, ...ir, ...rawIndex.toBytesBigEndian()])).digest();\n      return this.childImpl(curve, parentPrivkey, parentChainCode, rawIndex, newI);\n    }\n    // step 7\n    return {\n      chainCode: returnChainCode,\n      privkey: returnChildKey\n    };\n  }\n  static isZero(privkey) {\n    return privkey.every(byte => byte === 0);\n  }\n  static isGteN(curve, privkey) {\n    const keyAsNumber = new bn_js_1.default(privkey);\n    return keyAsNumber.gte(this.n(curve));\n  }\n  static n(curve) {\n    switch (curve) {\n      case Slip10Curve.Secp256k1:\n        return new bn_js_1.default(\"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141\", 16);\n      default:\n        throw new Error(\"curve not supported\");\n    }\n  }\n}\nexports.Slip10 = Slip10;\nfunction pathToString(path) {\n  return path.reduce((current, component) => {\n    const componentString = component.isHardened() ? `${component.toNumber() - 2 ** 31}'` : component.toString();\n    return current + \"/\" + componentString;\n  }, \"m\");\n}\nexports.pathToString = pathToString;\nfunction stringToPath(input) {\n  if (!input.startsWith(\"m\")) throw new Error(\"Path string must start with 'm'\");\n  let rest = input.slice(1);\n  const out = new Array();\n  while (rest) {\n    const match = rest.match(/^\\/([0-9]+)('?)/);\n    if (!match) throw new Error(\"Syntax error while reading path component\");\n    const [fullMatch, numberString, apostrophe] = match;\n    const value = math_1.Uint53.fromString(numberString).toNumber();\n    if (value >= 2 ** 31) throw new Error(\"Component value too high. Must not exceed 2**31-1.\");\n    if (apostrophe) out.push(Slip10RawIndex.hardened(value));else out.push(Slip10RawIndex.normal(value));\n    rest = rest.slice(fullMatch.length);\n  }\n  return out;\n}\nexports.stringToPath = stringToPath;","map":{"version":3,"sources":["../src/slip10.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.stringToPath = exports.pathToString = exports.Slip10 = exports.Slip10RawIndex = exports.slip10CurveFromString = exports.Slip10Curve = void 0;\nconst encoding_1 = require(\"@cosmjs/encoding\");\nconst math_1 = require(\"@cosmjs/math\");\nconst bn_js_1 = __importDefault(require(\"bn.js\"));\nconst elliptic_1 = __importDefault(require(\"elliptic\"));\nconst hmac_1 = require(\"./hmac\");\nconst sha_1 = require(\"./sha\");\n/**\n * Raw values must match the curve string in SLIP-0010 master key generation\n *\n * @see https://github.com/satoshilabs/slips/blob/master/slip-0010.md#master-key-generation\n */\nvar Slip10Curve;\n(function (Slip10Curve) {\n    Slip10Curve[\"Secp256k1\"] = \"Bitcoin seed\";\n    Slip10Curve[\"Ed25519\"] = \"ed25519 seed\";\n})(Slip10Curve = exports.Slip10Curve || (exports.Slip10Curve = {}));\n/**\n * Reverse mapping of Slip10Curve\n */\nfunction slip10CurveFromString(curveString) {\n    switch (curveString) {\n        case Slip10Curve.Ed25519:\n            return Slip10Curve.Ed25519;\n        case Slip10Curve.Secp256k1:\n            return Slip10Curve.Secp256k1;\n        default:\n            throw new Error(`Unknown curve string: '${curveString}'`);\n    }\n}\nexports.slip10CurveFromString = slip10CurveFromString;\nclass Slip10RawIndex extends math_1.Uint32 {\n    static hardened(hardenedIndex) {\n        return new Slip10RawIndex(hardenedIndex + 2 ** 31);\n    }\n    static normal(normalIndex) {\n        return new Slip10RawIndex(normalIndex);\n    }\n    isHardened() {\n        return this.data >= 2 ** 31;\n    }\n}\nexports.Slip10RawIndex = Slip10RawIndex;\nconst secp256k1 = new elliptic_1.default.ec(\"secp256k1\");\n// Universal private key derivation accoring to\n// https://github.com/satoshilabs/slips/blob/master/slip-0010.md\nclass Slip10 {\n    static derivePath(curve, seed, path) {\n        let result = this.master(curve, seed);\n        for (const rawIndex of path) {\n            result = this.child(curve, result.privkey, result.chainCode, rawIndex);\n        }\n        return result;\n    }\n    static master(curve, seed) {\n        const i = new hmac_1.Hmac(sha_1.Sha512, (0, encoding_1.toAscii)(curve)).update(seed).digest();\n        const il = i.slice(0, 32);\n        const ir = i.slice(32, 64);\n        if (curve !== Slip10Curve.Ed25519 && (this.isZero(il) || this.isGteN(curve, il))) {\n            return this.master(curve, i);\n        }\n        return {\n            chainCode: ir,\n            privkey: il,\n        };\n    }\n    static child(curve, parentPrivkey, parentChainCode, rawIndex) {\n        let i;\n        if (rawIndex.isHardened()) {\n            const payload = new Uint8Array([0x00, ...parentPrivkey, ...rawIndex.toBytesBigEndian()]);\n            i = new hmac_1.Hmac(sha_1.Sha512, parentChainCode).update(payload).digest();\n        }\n        else {\n            if (curve === Slip10Curve.Ed25519) {\n                throw new Error(\"Normal keys are not allowed with ed25519\");\n            }\n            else {\n                // Step 1 of https://github.com/satoshilabs/slips/blob/master/slip-0010.md#private-parent-key--private-child-key\n                // Calculate I = HMAC-SHA512(Key = c_par, Data = ser_P(point(k_par)) || ser_32(i)).\n                // where the functions point() and ser_p() are defined in BIP-0032\n                const data = new Uint8Array([\n                    ...Slip10.serializedPoint(curve, new bn_js_1.default(parentPrivkey)),\n                    ...rawIndex.toBytesBigEndian(),\n                ]);\n                i = new hmac_1.Hmac(sha_1.Sha512, parentChainCode).update(data).digest();\n            }\n        }\n        return this.childImpl(curve, parentPrivkey, parentChainCode, rawIndex, i);\n    }\n    /**\n     * Implementation of ser_P(point(k_par)) from BIP-0032\n     *\n     * @see https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki\n     */\n    static serializedPoint(curve, p) {\n        switch (curve) {\n            case Slip10Curve.Secp256k1:\n                return (0, encoding_1.fromHex)(secp256k1.g.mul(p).encodeCompressed(\"hex\"));\n            default:\n                throw new Error(\"curve not supported\");\n        }\n    }\n    static childImpl(curve, parentPrivkey, parentChainCode, rawIndex, i) {\n        // step 2 (of the Private parent key â†’ private child key algorithm)\n        const il = i.slice(0, 32);\n        const ir = i.slice(32, 64);\n        // step 3\n        const returnChainCode = ir;\n        // step 4\n        if (curve === Slip10Curve.Ed25519) {\n            return {\n                chainCode: returnChainCode,\n                privkey: il,\n            };\n        }\n        // step 5\n        const n = this.n(curve);\n        const returnChildKeyAsNumber = new bn_js_1.default(il).add(new bn_js_1.default(parentPrivkey)).mod(n);\n        const returnChildKey = Uint8Array.from(returnChildKeyAsNumber.toArray(\"be\", 32));\n        // step 6\n        if (this.isGteN(curve, il) || this.isZero(returnChildKey)) {\n            const newI = new hmac_1.Hmac(sha_1.Sha512, parentChainCode)\n                .update(new Uint8Array([0x01, ...ir, ...rawIndex.toBytesBigEndian()]))\n                .digest();\n            return this.childImpl(curve, parentPrivkey, parentChainCode, rawIndex, newI);\n        }\n        // step 7\n        return {\n            chainCode: returnChainCode,\n            privkey: returnChildKey,\n        };\n    }\n    static isZero(privkey) {\n        return privkey.every((byte) => byte === 0);\n    }\n    static isGteN(curve, privkey) {\n        const keyAsNumber = new bn_js_1.default(privkey);\n        return keyAsNumber.gte(this.n(curve));\n    }\n    static n(curve) {\n        switch (curve) {\n            case Slip10Curve.Secp256k1:\n                return new bn_js_1.default(\"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141\", 16);\n            default:\n                throw new Error(\"curve not supported\");\n        }\n    }\n}\nexports.Slip10 = Slip10;\nfunction pathToString(path) {\n    return path.reduce((current, component) => {\n        const componentString = component.isHardened()\n            ? `${component.toNumber() - 2 ** 31}'`\n            : component.toString();\n        return current + \"/\" + componentString;\n    }, \"m\");\n}\nexports.pathToString = pathToString;\nfunction stringToPath(input) {\n    if (!input.startsWith(\"m\"))\n        throw new Error(\"Path string must start with 'm'\");\n    let rest = input.slice(1);\n    const out = new Array();\n    while (rest) {\n        const match = rest.match(/^\\/([0-9]+)('?)/);\n        if (!match)\n            throw new Error(\"Syntax error while reading path component\");\n        const [fullMatch, numberString, apostrophe] = match;\n        const value = math_1.Uint53.fromString(numberString).toNumber();\n        if (value >= 2 ** 31)\n            throw new Error(\"Component value too high. Must not exceed 2**31-1.\");\n        if (apostrophe)\n            out.push(Slip10RawIndex.hardened(value));\n        else\n            out.push(Slip10RawIndex.normal(value));\n        rest = rest.slice(fullMatch.length);\n    }\n    return out;\n}\nexports.stringToPath = stringToPath;\n//# sourceMappingURL=slip10.js.map"]},"metadata":{},"sourceType":"script"}